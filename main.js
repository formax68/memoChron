/*
THIS IS A GENERATED/BUNDLED FILE BY ESBUILD
if you want to view the source, please visit the github repository of this plugin
*/

var ue=Object.create;var q=Object.defineProperty;var he=Object.getOwnPropertyDescriptor;var le=Object.getOwnPropertyNames;var ce=Object.getPrototypeOf,fe=Object.prototype.hasOwnProperty;var de=(u,r)=>()=>(r||u((r={exports:{}}).exports,r),r.exports),me=(u,r)=>{for(var e in r)q(u,e,{get:r[e],enumerable:!0})},ee=(u,r,e,i)=>{if(r&&typeof r=="object"||typeof r=="function")for(let t of le(r))!fe.call(u,t)&&t!==e&&q(u,t,{get:()=>r[t],enumerable:!(i=he(r,t))||i.enumerable});return u};var pe=(u,r,e)=>(e=u!=null?ue(ce(u)):{},ee(r||!u||!u.__esModule?q(e,"default",{value:u,enumerable:!0}):e,u)),ye=u=>ee(q({},"__esModule",{value:!0}),u);var te=de((Te,Q)=>{var s;(function(){typeof Q=="object"?s=Q.exports:typeof HTMLScriptElement!="undefined"&&"noModule"in HTMLScriptElement.prototype?window.ICAL=s={}:typeof s!="object"&&(s={})})();s.foldLength=75;s.newLineChar=`\r
`;s.helpers={updateTimezones:function(u){var r,e,i,t,n,a;if(!u||u.name!=="vcalendar")return u;for(r=u.getAllSubcomponents(),e=[],i={},n=0;n<r.length;n++)r[n].name==="vtimezone"?(a=r[n].getFirstProperty("tzid").getFirstValue(),i[a]=r[n]):e=e.concat(r[n].getAllProperties());for(t={},n=0;n<e.length;n++)(a=e[n].getParameter("tzid"))&&(t[a]=!0);for(n in i)i.hasOwnProperty(n)&&!t[n]&&u.removeSubcomponent(i[n]);for(n in t)t.hasOwnProperty(n)&&!i[n]&&s.TimezoneService.has(n)&&u.addSubcomponent(s.TimezoneService.get(n).component);return u},isStrictlyNaN:function(u){return typeof u=="number"&&isNaN(u)},strictParseInt:function(u){var r=parseInt(u,10);if(s.helpers.isStrictlyNaN(r))throw new Error('Could not extract integer from "'+u+'"');return r},formatClassType:function(r,e){if(typeof r!="undefined")return r instanceof e?r:new e(r)},unescapedIndexOf:function(u,r,e){for(;(e=u.indexOf(r,e))!==-1;)if(e>0&&u[e-1]==="\\")e+=1;else return e;return-1},binsearchInsert:function(u,r,e){if(!u.length)return 0;for(var i=0,t=u.length-1,n,a;i<=t;)if(n=i+Math.floor((t-i)/2),a=e(r,u[n]),a<0)t=n-1;else if(a>0)i=n+1;else break;return a<0?n:a>0?n+1:n},dumpn:function(){s.debug&&(typeof console!="undefined"&&"log"in console?s.helpers.dumpn=function(r){console.log(r)}:s.helpers.dumpn=function(r){dump(r+`
`)},s.helpers.dumpn(arguments[0]))},clone:function(u,r){if(!u||typeof u!="object")return u;if(u instanceof Date)return new Date(u.getTime());if("clone"in u)return u.clone();if(Array.isArray(u)){for(var e=[],i=0;i<u.length;i++)e.push(r?s.helpers.clone(u[i],!0):u[i]);return e}else{var t={};for(var n in u)Object.prototype.hasOwnProperty.call(u,n)&&(r?t[n]=s.helpers.clone(u[n],!0):t[n]=u[n]);return t}},foldline:function(r){for(var e="",i=r||"",t=0,n=0;i.length;){var a=i.codePointAt(t);a<128?++n:a<2048?n+=2:a<65536?n+=3:n+=4,n<s.foldLength+1?t+=a>65535?2:1:(e+=s.newLineChar+" "+i.substring(0,t),i=i.substring(t),t=n=0)}return e.substr(s.newLineChar.length+1)},pad2:function(r){typeof r!="string"&&(typeof r=="number"&&(r=parseInt(r)),r=String(r));var e=r.length;switch(e){case 0:return"00";case 1:return"0"+r;default:return r}},trunc:function(r){return r<0?Math.ceil(r):Math.floor(r)},inherits:function(u,r,e){function i(){}i.prototype=u.prototype,r.prototype=new i,e&&s.helpers.extend(e,r.prototype)},extend:function(u,r){for(var e in u){var i=Object.getOwnPropertyDescriptor(u,e);i&&!Object.getOwnPropertyDescriptor(r,e)&&Object.defineProperty(r,e,i)}return r}};s.design=function(){"use strict";var u=/\\\\|\\;|\\,|\\[Nn]/g,r=/\\|;|,|\n/g,e=/\\\\|\\,|\\[Nn]/g,i=/\\|,|\n/g;function t(h,T){var b={matches:/.*/,fromICAL:function(D,R){return _(D,h,R)},toICAL:function(D,R){var M=T;return R&&(M=new RegExp(M.source+"|"+R)),D.replace(M,function(H){switch(H){case"\\":return"\\\\";case";":return"\\;";case",":return"\\,";case`
`:return"\\n";default:return H}})}};return b}var n={defaultType:"text"},a={defaultType:"text",multiValue:","},o={defaultType:"text",structuredValue:";"},f={defaultType:"integer"},v={defaultType:"date-time",allowedTypes:["date-time","date"]},l={defaultType:"date-time"},d={defaultType:"uri"},c={defaultType:"utc-offset"},m={defaultType:"recur"},y={defaultType:"date-and-or-time",allowedTypes:["date-time","date","text"]};function p(h){switch(h){case"\\\\":return"\\";case"\\;":return";";case"\\,":return",";case"\\n":case"\\N":return`
`;default:return h}}function _(h,T,b){return h.indexOf("\\")===-1?h:(b&&(T=new RegExp(T.source+"|\\\\"+b)),h.replace(T,p))}var w={categories:a,url:d,version:n,uid:n},E={boolean:{values:["TRUE","FALSE"],fromICAL:function(h){switch(h){case"TRUE":return!0;case"FALSE":return!1;default:return!1}},toICAL:function(h){return h?"TRUE":"FALSE"}},float:{matches:/^[+-]?\d+\.\d+$/,fromICAL:function(h){var T=parseFloat(h);return s.helpers.isStrictlyNaN(T)?0:T},toICAL:function(h){return String(h)}},integer:{fromICAL:function(h){var T=parseInt(h);return s.helpers.isStrictlyNaN(T)?0:T},toICAL:function(h){return String(h)}},"utc-offset":{toICAL:function(h){return h.length<7?h.substr(0,3)+h.substr(4,2):h.substr(0,3)+h.substr(4,2)+h.substr(7,2)},fromICAL:function(h){return h.length<6?h.substr(0,3)+":"+h.substr(3,2):h.substr(0,3)+":"+h.substr(3,2)+":"+h.substr(5,2)},decorate:function(h){return s.UtcOffset.fromString(h)},undecorate:function(h){return h.toString()}}},Y={cutype:{values:["INDIVIDUAL","GROUP","RESOURCE","ROOM","UNKNOWN"],allowXName:!0,allowIanaToken:!0},"delegated-from":{valueType:"cal-address",multiValue:",",multiValueSeparateDQuote:!0},"delegated-to":{valueType:"cal-address",multiValue:",",multiValueSeparateDQuote:!0},encoding:{values:["8BIT","BASE64"]},fbtype:{values:["FREE","BUSY","BUSY-UNAVAILABLE","BUSY-TENTATIVE"],allowXName:!0,allowIanaToken:!0},member:{valueType:"cal-address",multiValue:",",multiValueSeparateDQuote:!0},partstat:{values:["NEEDS-ACTION","ACCEPTED","DECLINED","TENTATIVE","DELEGATED","COMPLETED","IN-PROCESS"],allowXName:!0,allowIanaToken:!0},range:{values:["THISANDFUTURE"]},related:{values:["START","END"]},reltype:{values:["PARENT","CHILD","SIBLING"],allowXName:!0,allowIanaToken:!0},role:{values:["REQ-PARTICIPANT","CHAIR","OPT-PARTICIPANT","NON-PARTICIPANT"],allowXName:!0,allowIanaToken:!0},rsvp:{values:["TRUE","FALSE"]},"sent-by":{valueType:"cal-address"},tzid:{matches:/^\//},value:{values:["binary","boolean","cal-address","date","date-time","duration","float","integer","period","recur","text","time","uri","utc-offset"],allowXName:!0,allowIanaToken:!0}},g=s.helpers.extend(E,{text:t(u,r),uri:{},binary:{decorate:function(h){return s.Binary.fromString(h)},undecorate:function(h){return h.toString()}},"cal-address":{},date:{decorate:function(h,T){return P.strict?s.Time.fromDateString(h,T):s.Time.fromString(h,T)},undecorate:function(h){return h.toString()},fromICAL:function(h){return!P.strict&&h.length>=15?g["date-time"].fromICAL(h):h.substr(0,4)+"-"+h.substr(4,2)+"-"+h.substr(6,2)},toICAL:function(h){var T=h.length;return T==10?h.substr(0,4)+h.substr(5,2)+h.substr(8,2):T>=19?g["date-time"].toICAL(h):h}},"date-time":{fromICAL:function(h){if(!P.strict&&h.length==8)return g.date.fromICAL(h);var T=h.substr(0,4)+"-"+h.substr(4,2)+"-"+h.substr(6,2)+"T"+h.substr(9,2)+":"+h.substr(11,2)+":"+h.substr(13,2);return h[15]&&h[15]==="Z"&&(T+="Z"),T},toICAL:function(h){var T=h.length;if(T==10&&!P.strict)return g.date.toICAL(h);if(T>=19){var b=h.substr(0,4)+h.substr(5,2)+h.substr(8,5)+h.substr(14,2)+h.substr(17,2);return h[19]&&h[19]==="Z"&&(b+="Z"),b}else return h},decorate:function(h,T){return P.strict?s.Time.fromDateTimeString(h,T):s.Time.fromString(h,T)},undecorate:function(h){return h.toString()}},duration:{decorate:function(h){return s.Duration.fromString(h)},undecorate:function(h){return h.toString()}},period:{fromICAL:function(h){var T=h.split("/");return T[0]=g["date-time"].fromICAL(T[0]),s.Duration.isValueString(T[1])||(T[1]=g["date-time"].fromICAL(T[1])),T},toICAL:function(h){return!P.strict&&h[0].length==10?h[0]=g.date.toICAL(h[0]):h[0]=g["date-time"].toICAL(h[0]),s.Duration.isValueString(h[1])||(!P.strict&&h[1].length==10?h[1]=g.date.toICAL(h[1]):h[1]=g["date-time"].toICAL(h[1])),h.join("/")},decorate:function(h,T){return s.Period.fromJSON(h,T,!P.strict)},undecorate:function(h){return h.toJSON()}},recur:{fromICAL:function(h){return s.Recur._stringToData(h,!0)},toICAL:function(h){var T="";for(var b in h)if(Object.prototype.hasOwnProperty.call(h,b)){var D=h[b];b=="until"?D.length>10?D=g["date-time"].toICAL(D):D=g.date.toICAL(D):b=="wkst"?typeof D=="number"&&(D=s.Recur.numericDayToIcalDay(D)):Array.isArray(D)&&(D=D.join(",")),T+=b.toUpperCase()+"="+D+";"}return T.substr(0,T.length-1)},decorate:function(T){return s.Recur.fromData(T)},undecorate:function(h){return h.toJSON()}},time:{fromICAL:function(h){if(h.length<6)return h;var T=h.substr(0,2)+":"+h.substr(2,2)+":"+h.substr(4,2);return h[6]==="Z"&&(T+="Z"),T},toICAL:function(h){if(h.length<8)return h;var T=h.substr(0,2)+h.substr(3,2)+h.substr(6,2);return h[8]==="Z"&&(T+="Z"),T}}}),A=s.helpers.extend(w,{action:n,attach:{defaultType:"uri"},attendee:{defaultType:"cal-address"},calscale:n,class:n,comment:n,completed:l,contact:n,created:l,description:n,dtend:v,dtstamp:l,dtstart:v,due:v,duration:{defaultType:"duration"},exdate:{defaultType:"date-time",allowedTypes:["date-time","date"],multiValue:","},exrule:m,freebusy:{defaultType:"period",multiValue:","},geo:{defaultType:"float",structuredValue:";"},"last-modified":l,location:n,method:n,organizer:{defaultType:"cal-address"},"percent-complete":f,priority:f,prodid:n,"related-to":n,repeat:f,rdate:{defaultType:"date-time",allowedTypes:["date-time","date","period"],multiValue:",",detectType:function(h){return h.indexOf("/")!==-1?"period":h.indexOf("T")===-1?"date":"date-time"}},"recurrence-id":v,resources:a,"request-status":o,rrule:m,sequence:f,status:n,summary:n,transp:n,trigger:{defaultType:"duration",allowedTypes:["duration","date-time"]},tzoffsetfrom:c,tzoffsetto:c,tzurl:d,tzid:n,tzname:n}),O=s.helpers.extend(E,{text:t(e,i),uri:t(e,i),date:{decorate:function(h){return s.VCardTime.fromDateAndOrTimeString(h,"date")},undecorate:function(h){return h.toString()},fromICAL:function(h){return h.length==8?g.date.fromICAL(h):h[0]=="-"&&h.length==6?h.substr(0,4)+"-"+h.substr(4):h},toICAL:function(h){return h.length==10?g.date.toICAL(h):h[0]=="-"&&h.length==7?h.substr(0,4)+h.substr(5):h}},time:{decorate:function(h){return s.VCardTime.fromDateAndOrTimeString("T"+h,"time")},undecorate:function(h){return h.toString()},fromICAL:function(h){var T=O.time._splitZone(h,!0),b=T[0],D=T[1];return D.length==6?D=D.substr(0,2)+":"+D.substr(2,2)+":"+D.substr(4,2):D.length==4&&D[0]!="-"?D=D.substr(0,2)+":"+D.substr(2,2):D.length==5&&(D=D.substr(0,3)+":"+D.substr(3,2)),b.length==5&&(b[0]=="-"||b[0]=="+")&&(b=b.substr(0,3)+":"+b.substr(3)),D+b},toICAL:function(h){var T=O.time._splitZone(h),b=T[0],D=T[1];return D.length==8?D=D.substr(0,2)+D.substr(3,2)+D.substr(6,2):D.length==5&&D[0]!="-"?D=D.substr(0,2)+D.substr(3,2):D.length==6&&(D=D.substr(0,3)+D.substr(4,2)),b.length==6&&(b[0]=="-"||b[0]=="+")&&(b=b.substr(0,3)+b.substr(4)),D+b},_splitZone:function(h,T){var b=h.length-1,D=h.length-(T?5:6),R=h[D],M,H;return h[b]=="Z"?(M=h[b],H=h.substr(0,b)):h.length>6&&(R=="-"||R=="+")?(M=h.substr(D),H=h.substr(0,D)):(M="",H=h),[M,H]}},"date-time":{decorate:function(h){return s.VCardTime.fromDateAndOrTimeString(h,"date-time")},undecorate:function(h){return h.toString()},fromICAL:function(h){return O["date-and-or-time"].fromICAL(h)},toICAL:function(h){return O["date-and-or-time"].toICAL(h)}},"date-and-or-time":{decorate:function(h){return s.VCardTime.fromDateAndOrTimeString(h,"date-and-or-time")},undecorate:function(h){return h.toString()},fromICAL:function(h){var T=h.split("T");return(T[0]?O.date.fromICAL(T[0]):"")+(T[1]?"T"+O.time.fromICAL(T[1]):"")},toICAL:function(h){var T=h.split("T");return O.date.toICAL(T[0])+(T[1]?"T"+O.time.toICAL(T[1]):"")}},timestamp:g["date-time"],"language-tag":{matches:/^[a-zA-Z0-9-]+$/}}),S={type:{valueType:"text",multiValue:","},value:{values:["text","uri","date","time","date-time","date-and-or-time","timestamp","boolean","integer","float","utc-offset","language-tag"],allowXName:!0,allowIanaToken:!0}},N=s.helpers.extend(w,{adr:{defaultType:"text",structuredValue:";",multiValue:","},anniversary:y,bday:y,caladruri:d,caluri:d,clientpidmap:o,email:n,fburl:d,fn:n,gender:o,geo:d,impp:d,key:d,kind:n,lang:{defaultType:"language-tag"},logo:d,member:d,n:{defaultType:"text",structuredValue:";",multiValue:","},nickname:a,note:n,org:{defaultType:"text",structuredValue:";"},photo:d,related:d,rev:{defaultType:"timestamp"},role:n,sound:d,source:d,tel:{defaultType:"uri",allowedTypes:["uri","text"]},title:n,tz:{defaultType:"text",allowedTypes:["text","utc-offset","uri"]},xml:n}),L=s.helpers.extend(E,{binary:g.binary,date:O.date,"date-time":O["date-time"],"phone-number":{},uri:g.uri,text:g.text,time:g.time,vcard:g.text,"utc-offset":{toICAL:function(h){return h.substr(0,7)},fromICAL:function(h){return h.substr(0,7)},decorate:function(h){return s.UtcOffset.fromString(h)},undecorate:function(h){return h.toString()}}}),x={type:{valueType:"text",multiValue:","},value:{values:["text","uri","date","date-time","phone-number","time","boolean","integer","float","utc-offset","vcard","binary"],allowXName:!0,allowIanaToken:!0}},z=s.helpers.extend(w,{fn:n,n:{defaultType:"text",structuredValue:";",multiValue:","},nickname:a,photo:{defaultType:"binary",allowedTypes:["binary","uri"]},bday:{defaultType:"date-time",allowedTypes:["date-time","date"],detectType:function(h){return h.indexOf("T")===-1?"date":"date-time"}},adr:{defaultType:"text",structuredValue:";",multiValue:","},label:n,tel:{defaultType:"phone-number"},email:n,mailer:n,tz:{defaultType:"utc-offset",allowedTypes:["utc-offset","text"]},geo:{defaultType:"float",structuredValue:";"},title:n,role:n,logo:{defaultType:"binary",allowedTypes:["binary","uri"]},agent:{defaultType:"vcard",allowedTypes:["vcard","text","uri"]},org:o,note:a,prodid:n,rev:{defaultType:"date-time",allowedTypes:["date-time","date"],detectType:function(h){return h.indexOf("T")===-1?"date":"date-time"}},"sort-string":n,sound:{defaultType:"binary",allowedTypes:["binary","uri"]},class:n,key:{defaultType:"binary",allowedTypes:["binary","text"]}}),I={value:g,param:Y,property:A},B={value:O,param:S,property:N},C={value:L,param:x,property:z},P={strict:!0,defaultSet:I,defaultType:"unknown",components:{vcard:B,vcard3:C,vevent:I,vtodo:I,vjournal:I,valarm:I,vtimezone:I,daylight:I,standard:I},icalendar:I,vcard:B,vcard3:C,getDesignSet:function(h){var T=h&&h in P.components;return T?P.components[h]:P.defaultSet}};return P}();s.stringify=function(){"use strict";var u=`\r
`,r="unknown",e=s.design,i=s.helpers;function t(a){typeof a[0]=="string"&&(a=[a]);for(var o=0,f=a.length,v="";o<f;o++)v+=t.component(a[o])+u;return v}t.component=function(a,o){var f=a[0].toUpperCase(),v="BEGIN:"+f+u,l=a[1],d=0,c=l.length,m=a[0];for(m==="vcard"&&a[1].length>0&&!(a[1][0][0]==="version"&&a[1][0][3]==="4.0")&&(m="vcard3"),o=o||e.getDesignSet(m);d<c;d++)v+=t.property(l[d],o)+u;for(var y=a[2]||[],p=0,_=y.length;p<_;p++)v+=t.component(y[p],o)+u;return v+="END:"+f,v},t.property=function(a,o,f){var v=a[0].toUpperCase(),l=a[0],d=a[1],c=v,m;for(m in d){var y=d[m];if(d.hasOwnProperty(m)){var w=m in o.param&&o.param[m].multiValue;w&&Array.isArray(y)?(o.param[m].multiValueSeparateDQuote&&(w='"'+w+'"'),y=y.map(t._rfc6868Unescape),y=t.multiValue(y,w,"unknown",null,o)):y=t._rfc6868Unescape(y),c+=";"+m.toUpperCase(),c+="="+t.propertyValue(y)}}if(a.length===3)return c+":";var p=a[2];o||(o=e.defaultSet);var _,w=!1,E=!1,Y=!1;return l in o.property?(_=o.property[l],"multiValue"in _&&(w=_.multiValue),"structuredValue"in _&&Array.isArray(a[3])&&(E=_.structuredValue),"defaultType"in _?p===_.defaultType&&(Y=!0):p===r&&(Y=!0)):p===r&&(Y=!0),Y||(c+=";VALUE="+p.toUpperCase()),c+=":",w&&E?c+=t.multiValue(a[3],E,p,w,o,E):w?c+=t.multiValue(a.slice(3),w,p,null,o,!1):E?c+=t.multiValue(a[3],E,p,null,o,E):c+=t.value(a[3],p,o,!1),f?c:s.helpers.foldline(c)},t.propertyValue=function(a){return i.unescapedIndexOf(a,",")===-1&&i.unescapedIndexOf(a,":")===-1&&i.unescapedIndexOf(a,";")===-1?a:'"'+a+'"'},t.multiValue=function(a,o,f,v,l,d){for(var c="",m=a.length,y=0;y<m;y++)v&&Array.isArray(a[y])?c+=t.multiValue(a[y],v,f,null,l,d):c+=t.value(a[y],f,l,d),y!==m-1&&(c+=o);return c},t.value=function(a,o,f,v){return o in f.value&&"toICAL"in f.value[o]?f.value[o].toICAL(a,v):a},t._rfc6868Unescape=function(a){return a.replace(/[\n^"]/g,function(o){return n[o]})};var n={'"':"^'","\n":"^n","^":"^^"};return t}();s.parse=function(){"use strict";var u=/[^ \t]/,r=",",e=":",i=";",t="=",n="unknown",a="text",o=s.design,f=s.helpers;function v(c){this.message=c,this.name="ParserError";try{throw new Error}catch(y){if(y.stack){var m=y.stack.split(`
`);m.shift(),this.stack=m.join(`
`)}}}v.prototype=Error.prototype;function l(c){var m={},y=m.component=[];if(m.stack=[y],l._eachLine(c,function(p,_){l._handleContentLine(_,m)}),m.stack.length>1)throw new v("invalid ical body. component began but did not end");return m=null,y.length==1?y[0]:y}l.property=function(c,m){var y={component:[[],[]],designSet:m||o.defaultSet};return l._handleContentLine(c,y),y.component[1][0]},l.component=function(c){return l(c)},l.ParserError=v,l._handleContentLine=function(c,m){var y=c.indexOf(e),p=c.indexOf(i),_,w,E,Y,g={};p!==-1&&y!==-1&&p>y&&(p=-1);var A;if(p!==-1){if(E=c.substring(0,p).toLowerCase(),A=l._parseParameters(c.substring(p),0,m.designSet),A[2]==-1)throw new v("Invalid parameters in '"+c+"'");if(g=A[0],_=A[1].length+A[2]+p,(w=c.substring(_).indexOf(e))!==-1)Y=c.substring(_+w+1);else throw new v("Missing parameter value in '"+c+"'")}else if(y!==-1){if(E=c.substring(0,y).toLowerCase(),Y=c.substring(y+1),E==="begin"){var O=[Y.toLowerCase(),[],[]];m.stack.length===1?m.component.push(O):m.component[2].push(O),m.stack.push(m.component),m.component=O,m.designSet||(m.designSet=o.getDesignSet(m.component[0]));return}else if(E==="end"){m.component=m.stack.pop();return}}else throw new v('invalid line (no token ";" or ":") "'+c+'"');var S,N=!1,L=!1,x;E in m.designSet.property&&(x=m.designSet.property[E],"multiValue"in x&&(N=x.multiValue),"structuredValue"in x&&(L=x.structuredValue),Y&&"detectType"in x&&(S=x.detectType(Y))),S||("value"in g?S=g.value.toLowerCase():x?S=x.defaultType:S=n),delete g.value;var z;N&&L?(Y=l._parseMultiValue(Y,L,S,[],N,m.designSet,L),z=[E,g,S,Y]):N?(z=[E,g,S],l._parseMultiValue(Y,N,S,z,null,m.designSet,!1)):L?(Y=l._parseMultiValue(Y,L,S,[],null,m.designSet,L),z=[E,g,S,Y]):(Y=l._parseValue(Y,S,m.designSet,!1),z=[E,g,S,Y]),m.component[0]==="vcard"&&m.component[1].length===0&&!(E==="version"&&Y==="4.0")&&(m.designSet=o.getDesignSet("vcard3")),m.component[1].push(z)},l._parseValue=function(c,m,y,p){return m in y.value&&"fromICAL"in y.value[m]?y.value[m].fromICAL(c,p):c},l._parseParameters=function(c,m,y){for(var p=m,_=0,w=t,E={},Y,g,A,O=-1,S,N,L;_!==!1&&(_=f.unescapedIndexOf(c,w,_+1))!==-1;){if(Y=c.substr(p+1,_-p-1),Y.length==0)throw new v("Empty parameter name in '"+c+"'");g=Y.toLowerCase(),L=!1,N=!1,g in y.param&&y.param[g].valueType?S=y.param[g].valueType:S=a,g in y.param&&(N=y.param[g].multiValue,y.param[g].multiValueSeparateDQuote&&(L=l._rfc6868Escape('"'+N+'"')));var x=c[_+1];if(x==='"'){if(O=_+2,_=f.unescapedIndexOf(c,'"',O),N&&_!=-1)for(var z=!0;z;)c[_+1]==N&&c[_+2]=='"'?_=f.unescapedIndexOf(c,'"',_+3):z=!1;if(_===-1)throw new v('invalid line (no matching double quote) "'+c+'"');A=c.substr(O,_-O),p=f.unescapedIndexOf(c,i,_),p===-1&&(_=!1)}else{O=_+1;var I=f.unescapedIndexOf(c,i,O),B=f.unescapedIndexOf(c,e,O);B!==-1&&I>B?(I=B,_=!1):I===-1?(B===-1?I=c.length:I=B,_=!1):(p=I,_=I),A=c.substr(O,I-O)}if(A=l._rfc6868Escape(A),N){var C=L||N;A=l._parseMultiValue(A,C,S,[],null,y)}else A=l._parseValue(A,S,y);N&&g in E?Array.isArray(E[g])?E[g].push(A):E[g]=[E[g],A]:E[g]=A}return[E,A,O]},l._rfc6868Escape=function(c){return c.replace(/\^['n^]/g,function(m){return d[m]})};var d={"^'":'"',"^n":`
`,"^^":"^"};return l._parseMultiValue=function(c,m,y,p,_,w,E){var Y=0,g=0,A;if(m.length===0)return c;for(;(Y=f.unescapedIndexOf(c,m,g))!==-1;)A=c.substr(g,Y-g),_?A=l._parseMultiValue(A,_,y,[],null,w,E):A=l._parseValue(A,y,w,E),p.push(A),g=Y+m.length;return A=c.substr(g),_?A=l._parseMultiValue(A,_,y,[],null,w,E):A=l._parseValue(A,y,w,E),p.push(A),p.length==1?p[0]:p},l._eachLine=function(c,m){var y=c.length,p=c.search(u),_=p,w,E,Y;do _=c.indexOf(`
`,p)+1,_>1&&c[_-2]==="\r"?Y=2:Y=1,_===0&&(_=y,Y=0),E=c[p],E===" "||E==="	"?w+=c.substr(p+1,_-p-(Y+1)):(w&&m(null,w),w=c.substr(p,_-p-Y)),p=_;while(_!==y);w=w.trim(),w.length&&m(null,w)},l}();s.Component=function(){"use strict";var u=1,r=2,e=0;function i(t,n){typeof t=="string"&&(t=[t,[],[]]),this.jCal=t,this.parent=n||null}return i.prototype={_hydratedPropertyCount:0,_hydratedComponentCount:0,get name(){return this.jCal[e]},get _designSet(){var t=this.parent&&this.parent._designSet;return t||s.design.getDesignSet(this.name)},_hydrateComponent:function(t){if(this._components||(this._components=[],this._hydratedComponentCount=0),this._components[t])return this._components[t];var n=new i(this.jCal[r][t],this);return this._hydratedComponentCount++,this._components[t]=n},_hydrateProperty:function(t){if(this._properties||(this._properties=[],this._hydratedPropertyCount=0),this._properties[t])return this._properties[t];var n=new s.Property(this.jCal[u][t],this);return this._hydratedPropertyCount++,this._properties[t]=n},getFirstSubcomponent:function(t){if(t){for(var n=0,a=this.jCal[r],o=a.length;n<o;n++)if(a[n][e]===t){var f=this._hydrateComponent(n);return f}}else if(this.jCal[r].length)return this._hydrateComponent(0);return null},getAllSubcomponents:function(t){var n=this.jCal[r].length,a=0;if(t){for(var o=this.jCal[r],f=[];a<n;a++)t===o[a][e]&&f.push(this._hydrateComponent(a));return f}else{if(!this._components||this._hydratedComponentCount!==n)for(;a<n;a++)this._hydrateComponent(a);return this._components||[]}},hasProperty:function(t){for(var n=this.jCal[u],a=n.length,o=0;o<a;o++)if(n[o][e]===t)return!0;return!1},getFirstProperty:function(t){if(t){for(var n=0,a=this.jCal[u],o=a.length;n<o;n++)if(a[n][e]===t){var f=this._hydrateProperty(n);return f}}else if(this.jCal[u].length)return this._hydrateProperty(0);return null},getFirstPropertyValue:function(t){var n=this.getFirstProperty(t);return n?n.getFirstValue():null},getAllProperties:function(t){var n=this.jCal[u].length,a=0;if(t){for(var o=this.jCal[u],f=[];a<n;a++)t===o[a][e]&&f.push(this._hydrateProperty(a));return f}else{if(!this._properties||this._hydratedPropertyCount!==n)for(;a<n;a++)this._hydrateProperty(a);return this._properties||[]}},_removeObjectByIndex:function(t,n,a){if(n=n||[],n[a]){var o=n[a];"parent"in o&&(o.parent=null)}n.splice(a,1),this.jCal[t].splice(a,1)},_removeObject:function(t,n,a){var o=0,f=this.jCal[t],v=f.length,l=this[n];if(typeof a=="string"){for(;o<v;o++)if(f[o][e]===a)return this._removeObjectByIndex(t,l,o),!0}else if(l){for(;o<v;o++)if(l[o]&&l[o]===a)return this._removeObjectByIndex(t,l,o),!0}return!1},_removeAllObjects:function(t,n,a){for(var o=this[n],f=this.jCal[t],v=f.length-1;v>=0;v--)(!a||f[v][e]===a)&&this._removeObjectByIndex(t,o,v)},addSubcomponent:function(t){this._components||(this._components=[],this._hydratedComponentCount=0),t.parent&&t.parent.removeSubcomponent(t);var n=this.jCal[r].push(t.jCal);return this._components[n-1]=t,this._hydratedComponentCount++,t.parent=this,t},removeSubcomponent:function(t){var n=this._removeObject(r,"_components",t);return n&&this._hydratedComponentCount--,n},removeAllSubcomponents:function(t){var n=this._removeAllObjects(r,"_components",t);return this._hydratedComponentCount=0,n},addProperty:function(t){if(!(t instanceof s.Property))throw new TypeError("must instance of ICAL.Property");this._properties||(this._properties=[],this._hydratedPropertyCount=0),t.parent&&t.parent.removeProperty(t);var n=this.jCal[u].push(t.jCal);return this._properties[n-1]=t,this._hydratedPropertyCount++,t.parent=this,t},addPropertyWithValue:function(t,n){var a=new s.Property(t);return a.setValue(n),this.addProperty(a),a},updatePropertyWithValue:function(t,n){var a=this.getFirstProperty(t);return a?a.setValue(n):a=this.addPropertyWithValue(t,n),a},removeProperty:function(t){var n=this._removeObject(u,"_properties",t);return n&&this._hydratedPropertyCount--,n},removeAllProperties:function(t){var n=this._removeAllObjects(u,"_properties",t);return this._hydratedPropertyCount=0,n},toJSON:function(){return this.jCal},toString:function(){return s.stringify.component(this.jCal,this._designSet)}},i.fromString=function(t){return new i(s.parse.component(t))},i}();s.Property=function(){"use strict";var u=0,r=1,e=2,i=3,t=s.design;function n(a,o){this._parent=o||null,typeof a=="string"?(this.jCal=[a,{},t.defaultType],this.jCal[e]=this.getDefaultType()):this.jCal=a,this._updateType()}return n.prototype={get type(){return this.jCal[e]},get name(){return this.jCal[u]},get parent(){return this._parent},set parent(a){var o=!this._parent||a&&a._designSet!=this._parent._designSet;return this._parent=a,this.type==t.defaultType&&o&&(this.jCal[e]=this.getDefaultType(),this._updateType()),a},get _designSet(){return this.parent?this.parent._designSet:t.defaultSet},_updateType:function(){var a=this._designSet;if(this.type in a.value){var o=a.value[this.type];"decorate"in a.value[this.type]?this.isDecorated=!0:this.isDecorated=!1,this.name in a.property&&(this.isMultiValue="multiValue"in a.property[this.name],this.isStructuredValue="structuredValue"in a.property[this.name])}},_hydrateValue:function(a){return this._values&&this._values[a]?this._values[a]:this.jCal.length<=i+a?null:this.isDecorated?(this._values||(this._values=[]),this._values[a]=this._decorate(this.jCal[i+a])):this.jCal[i+a]},_decorate:function(a){return this._designSet.value[this.type].decorate(a,this)},_undecorate:function(a){return this._designSet.value[this.type].undecorate(a,this)},_setDecoratedValue:function(a,o){this._values||(this._values=[]),typeof a=="object"&&"icaltype"in a?(this.jCal[i+o]=this._undecorate(a),this._values[o]=a):(this.jCal[i+o]=a,this._values[o]=this._decorate(a))},getParameter:function(a){if(a in this.jCal[r])return this.jCal[r][a]},getFirstParameter:function(a){var o=this.getParameter(a);return Array.isArray(o)?o[0]:o},setParameter:function(a,o){var f=a.toLowerCase();typeof o=="string"&&f in this._designSet.param&&"multiValue"in this._designSet.param[f]&&(o=[o]),this.jCal[r][a]=o},removeParameter:function(a){delete this.jCal[r][a]},getDefaultType:function(){var a=this.jCal[u],o=this._designSet;if(a in o.property){var f=o.property[a];if("defaultType"in f)return f.defaultType}return t.defaultType},resetType:function(a){this.removeAllValues(),this.jCal[e]=a,this._updateType()},getFirstValue:function(){return this._hydrateValue(0)},getValues:function(){var a=this.jCal.length-i;if(a<1)return[];for(var o=0,f=[];o<a;o++)f[o]=this._hydrateValue(o);return f},removeAllValues:function(){this._values&&(this._values.length=0),this.jCal.length=3},setValues:function(a){if(!this.isMultiValue)throw new Error(this.name+`: does not not support mulitValue.
override isMultiValue`);var o=a.length,f=0;if(this.removeAllValues(),o>0&&typeof a[0]=="object"&&"icaltype"in a[0]&&this.resetType(a[0].icaltype),this.isDecorated)for(;f<o;f++)this._setDecoratedValue(a[f],f);else for(;f<o;f++)this.jCal[i+f]=a[f]},setValue:function(a){this.removeAllValues(),typeof a=="object"&&"icaltype"in a&&this.resetType(a.icaltype),this.isDecorated?this._setDecoratedValue(a,0):this.jCal[i]=a},toJSON:function(){return this.jCal},toICALString:function(){return s.stringify.property(this.jCal,this._designSet,!0)}},n.fromString=function(a,o){return new n(s.parse.property(a,o))},n}();s.UtcOffset=function(){function u(r){this.fromData(r)}return u.prototype={hours:0,minutes:0,factor:1,icaltype:"utc-offset",clone:function(){return s.UtcOffset.fromSeconds(this.toSeconds())},fromData:function(r){if(r)for(var e in r)r.hasOwnProperty(e)&&(this[e]=r[e]);this._normalize()},fromSeconds:function(r){var e=Math.abs(r);return this.factor=r<0?-1:1,this.hours=s.helpers.trunc(e/3600),e-=this.hours*3600,this.minutes=s.helpers.trunc(e/60),this},toSeconds:function(){return this.factor*(60*this.minutes+3600*this.hours)},compare:function(e){var i=this.toSeconds(),t=e.toSeconds();return(i>t)-(t>i)},_normalize:function(){for(var r=this.toSeconds(),e=this.factor;r<-43200;)r+=97200;for(;r>50400;)r-=97200;this.fromSeconds(r),r==0&&(this.factor=e)},toICALString:function(){return s.design.icalendar.value["utc-offset"].toICAL(this.toString())},toString:function(){return(this.factor==1?"+":"-")+s.helpers.pad2(this.hours)+":"+s.helpers.pad2(this.minutes)}},u.fromString=function(r){var e={};return e.factor=r[0]==="+"?1:-1,e.hours=s.helpers.strictParseInt(r.substr(1,2)),e.minutes=s.helpers.strictParseInt(r.substr(4,2)),new s.UtcOffset(e)},u.fromSeconds=function(r){var e=new u;return e.fromSeconds(r),e},u}();s.Binary=function(){function u(r){this.value=r}return u.prototype={icaltype:"binary",decodeValue:function(){return this._b64_decode(this.value)},setEncodedValue:function(e){this.value=this._b64_encode(e)},_b64_encode:function(e){var i="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",t,n,a,o,f,v,l,d,c=0,m=0,y="",p=[];if(!e)return e;do t=e.charCodeAt(c++),n=e.charCodeAt(c++),a=e.charCodeAt(c++),d=t<<16|n<<8|a,o=d>>18&63,f=d>>12&63,v=d>>6&63,l=d&63,p[m++]=i.charAt(o)+i.charAt(f)+i.charAt(v)+i.charAt(l);while(c<e.length);y=p.join("");var _=e.length%3;return(_?y.slice(0,_-3):y)+"===".slice(_||3)},_b64_decode:function(e){var i="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",t,n,a,o,f,v,l,d,c=0,m=0,y="",p=[];if(!e)return e;e+="";do o=i.indexOf(e.charAt(c++)),f=i.indexOf(e.charAt(c++)),v=i.indexOf(e.charAt(c++)),l=i.indexOf(e.charAt(c++)),d=o<<18|f<<12|v<<6|l,t=d>>16&255,n=d>>8&255,a=d&255,v==64?p[m++]=String.fromCharCode(t):l==64?p[m++]=String.fromCharCode(t,n):p[m++]=String.fromCharCode(t,n,a);while(c<e.length);return y=p.join(""),y},toString:function(){return this.value}},u.fromString=function(r){return new u(r)},u}();(function(){s.Period=function(r){if(this.wrappedJSObject=this,r&&"start"in r){if(r.start&&!(r.start instanceof s.Time))throw new TypeError(".start must be an instance of ICAL.Time");this.start=r.start}if(r&&r.end&&r.duration)throw new Error("cannot accept both end and duration");if(r&&"end"in r){if(r.end&&!(r.end instanceof s.Time))throw new TypeError(".end must be an instance of ICAL.Time");this.end=r.end}if(r&&"duration"in r){if(r.duration&&!(r.duration instanceof s.Duration))throw new TypeError(".duration must be an instance of ICAL.Duration");this.duration=r.duration}},s.Period.prototype={start:null,end:null,duration:null,icalclass:"icalperiod",icaltype:"period",clone:function(){return s.Period.fromData({start:this.start?this.start.clone():null,end:this.end?this.end.clone():null,duration:this.duration?this.duration.clone():null})},getDuration:function(){return this.duration?this.duration:this.end.subtractDate(this.start)},getEnd:function(){if(this.end)return this.end;var u=this.start.clone();return u.addDuration(this.duration),u},toString:function(){return this.start+"/"+(this.end||this.duration)},toJSON:function(){return[this.start.toString(),(this.end||this.duration).toString()]},toICALString:function(){return this.start.toICALString()+"/"+(this.end||this.duration).toICALString()}},s.Period.fromString=function(r,e){var i=r.split("/");if(i.length!==2)throw new Error('Invalid string value: "'+r+'" must contain a "/" char.');var t={start:s.Time.fromDateTimeString(i[0],e)},n=i[1];return s.Duration.isValueString(n)?t.duration=s.Duration.fromString(n):t.end=s.Time.fromDateTimeString(n,e),new s.Period(t)},s.Period.fromData=function(r){return new s.Period(r)},s.Period.fromJSON=function(u,r,e){function i(t,n){return e?s.Time.fromString(t,n):s.Time.fromDateTimeString(t,n)}return s.Duration.isValueString(u[1])?s.Period.fromData({start:i(u[0],r),duration:s.Duration.fromString(u[1])}):s.Period.fromData({start:i(u[0],r),end:i(u[1],r)})}})();(function(){var u=/([PDWHMTS]{1,1})/;s.Duration=function(i){this.wrappedJSObject=this,this.fromData(i)},s.Duration.prototype={weeks:0,days:0,hours:0,minutes:0,seconds:0,isNegative:!1,icalclass:"icalduration",icaltype:"duration",clone:function(){return s.Duration.fromData(this)},toSeconds:function(){var i=this.seconds+60*this.minutes+3600*this.hours+86400*this.days+604800*this.weeks;return this.isNegative?-i:i},fromSeconds:function(i){var t=Math.abs(i);return this.isNegative=i<0,this.days=s.helpers.trunc(t/86400),this.days%7==0?(this.weeks=this.days/7,this.days=0):this.weeks=0,t-=(this.days+7*this.weeks)*86400,this.hours=s.helpers.trunc(t/3600),t-=this.hours*3600,this.minutes=s.helpers.trunc(t/60),t-=this.minutes*60,this.seconds=t,this},fromData:function(i){var t=["weeks","days","hours","minutes","seconds","isNegative"];for(var n in t)if(t.hasOwnProperty(n)){var a=t[n];i&&a in i?this[a]=i[a]:this[a]=0}},reset:function(){this.isNegative=!1,this.weeks=0,this.days=0,this.hours=0,this.minutes=0,this.seconds=0},compare:function(i){var t=this.toSeconds(),n=i.toSeconds();return(t>n)-(t<n)},normalize:function(){this.fromSeconds(this.toSeconds())},toString:function(){if(this.toSeconds()==0)return"PT0S";var i="";return this.isNegative&&(i+="-"),i+="P",this.weeks&&(i+=this.weeks+"W"),this.days&&(i+=this.days+"D"),(this.hours||this.minutes||this.seconds)&&(i+="T",this.hours&&(i+=this.hours+"H"),this.minutes&&(i+=this.minutes+"M"),this.seconds&&(i+=this.seconds+"S")),i},toICALString:function(){return this.toString()}},s.Duration.fromSeconds=function(i){return new s.Duration().fromSeconds(i)};function r(e,i,t){var n;switch(e){case"P":i&&i==="-"?t.isNegative=!0:t.isNegative=!1;break;case"D":n="days";break;case"W":n="weeks";break;case"H":n="hours";break;case"M":n="minutes";break;case"S":n="seconds";break;default:return 0}if(n){if(!i&&i!==0)throw new Error('invalid duration value: Missing number before "'+e+'"');var a=parseInt(i,10);if(s.helpers.isStrictlyNaN(a))throw new Error('invalid duration value: Invalid number "'+i+'" before "'+e+'"');t[n]=a}return 1}s.Duration.isValueString=function(e){return e[0]==="P"||e[1]==="P"},s.Duration.fromString=function(i){for(var t=0,n=Object.create(null),a=0;(t=i.search(u))!==-1;){var o=i[t],f=i.substr(0,t);i=i.substr(t+1),a+=r(o,f,n)}if(a<2)throw new Error('invalid duration value: Not enough duration components in "'+i+'"');return new s.Duration(n)},s.Duration.fromData=function(i){return new s.Duration(i)}})();(function(){var u=["tzid","location","tznames","latitude","longitude"];s.Timezone=function(e){this.wrappedJSObject=this,this.fromData(e)},s.Timezone.prototype={tzid:"",location:"",tznames:"",latitude:0,longitude:0,component:null,expandedUntilYear:0,icalclass:"icaltimezone",fromData:function(e){if(this.expandedUntilYear=0,this.changes=[],e instanceof s.Component)this.component=e;else{if(e&&"component"in e)if(typeof e.component=="string"){var i=s.parse(e.component);this.component=new s.Component(i)}else e.component instanceof s.Component?this.component=e.component:this.component=null;for(var t in u)if(u.hasOwnProperty(t)){var n=u[t];e&&n in e&&(this[n]=e[n])}}return this.component instanceof s.Component&&!this.tzid&&(this.tzid=this.component.getFirstPropertyValue("tzid")),this},utcOffset:function(e){if(this==s.Timezone.utcTimezone||this==s.Timezone.localTimezone||(this._ensureCoverage(e.year),!this.changes.length))return 0;for(var i={year:e.year,month:e.month,day:e.day,hour:e.hour,minute:e.minute,second:e.second},t=this._findNearbyChange(i),n=-1,a=1;;){var o=s.helpers.clone(this.changes[t],!0);o.utcOffset<o.prevUtcOffset?s.Timezone.adjust_change(o,0,0,0,o.utcOffset):s.Timezone.adjust_change(o,0,0,0,o.prevUtcOffset);var f=s.Timezone._compare_change_fn(i,o);if(f>=0?n=t:a=-1,a==-1&&n!=-1)break;if(t+=a,t<0)return 0;if(t>=this.changes.length)break}var v=this.changes[n],l=v.utcOffset-v.prevUtcOffset;if(l<0&&n>0){var d=s.helpers.clone(v,!0);if(s.Timezone.adjust_change(d,0,0,0,d.prevUtcOffset),s.Timezone._compare_change_fn(i,d)<0){var c=this.changes[n-1],m=!1;v.is_daylight!=m&&c.is_daylight==m&&(v=c)}}return v.utcOffset},_findNearbyChange:function(e){var i=s.helpers.binsearchInsert(this.changes,e,s.Timezone._compare_change_fn);return i>=this.changes.length?this.changes.length-1:i},_ensureCoverage:function(r){if(s.Timezone._minimumExpansionYear==-1){var e=s.Time.now();s.Timezone._minimumExpansionYear=e.year}var i=r;if(i<s.Timezone._minimumExpansionYear&&(i=s.Timezone._minimumExpansionYear),i+=s.Timezone.EXTRA_COVERAGE,i>s.Timezone.MAX_YEAR&&(i=s.Timezone.MAX_YEAR),!this.changes.length||this.expandedUntilYear<r){for(var t=this.component.getAllSubcomponents(),n=t.length,a=0;a<n;a++)this._expandComponent(t[a],i,this.changes);this.changes.sort(s.Timezone._compare_change_fn),this.expandedUntilYear=i}},_expandComponent:function(r,e,i){if(!r.hasProperty("dtstart")||!r.hasProperty("tzoffsetto")||!r.hasProperty("tzoffsetfrom"))return null;var t=r.getFirstProperty("dtstart").getFirstValue(),n;function a(p){return p.factor*(p.hours*3600+p.minutes*60)}function o(){var p={};return p.is_daylight=r.name=="daylight",p.utcOffset=a(r.getFirstProperty("tzoffsetto").getFirstValue()),p.prevUtcOffset=a(r.getFirstProperty("tzoffsetfrom").getFirstValue()),p}if(!r.hasProperty("rrule")&&!r.hasProperty("rdate"))n=o(),n.year=t.year,n.month=t.month,n.day=t.day,n.hour=t.hour,n.minute=t.minute,n.second=t.second,s.Timezone.adjust_change(n,0,0,0,-n.prevUtcOffset),i.push(n);else{var f=r.getAllProperties("rdate");for(var v in f)if(f.hasOwnProperty(v)){var l=f[v],d=l.getFirstValue();n=o(),n.year=d.year,n.month=d.month,n.day=d.day,d.isDate?(n.hour=t.hour,n.minute=t.minute,n.second=t.second,t.zone!=s.Timezone.utcTimezone&&s.Timezone.adjust_change(n,0,0,0,-n.prevUtcOffset)):(n.hour=d.hour,n.minute=d.minute,n.second=d.second,d.zone!=s.Timezone.utcTimezone&&s.Timezone.adjust_change(n,0,0,0,-n.prevUtcOffset)),i.push(n)}var c=r.getFirstProperty("rrule");if(c){c=c.getFirstValue(),n=o(),c.until&&c.until.zone==s.Timezone.utcTimezone&&(c.until.adjust(0,0,0,n.prevUtcOffset),c.until.zone=s.Timezone.localTimezone);for(var m=c.iterator(t),y;(y=m.next())&&(n=o(),!(y.year>e||!y));)n.year=y.year,n.month=y.month,n.day=y.day,n.hour=y.hour,n.minute=y.minute,n.second=y.second,n.isDate=y.isDate,s.Timezone.adjust_change(n,0,0,0,-n.prevUtcOffset),i.push(n)}}return i},toString:function(){return this.tznames?this.tznames:this.tzid}},s.Timezone._compare_change_fn=function(e,i){return e.year<i.year?-1:e.year>i.year?1:e.month<i.month?-1:e.month>i.month?1:e.day<i.day?-1:e.day>i.day?1:e.hour<i.hour?-1:e.hour>i.hour?1:e.minute<i.minute?-1:e.minute>i.minute?1:e.second<i.second?-1:e.second>i.second?1:0},s.Timezone.convert_time=function(e,i,t){if(e.isDate||i.tzid==t.tzid||i==s.Timezone.localTimezone||t==s.Timezone.localTimezone)return e.zone=t,e;var n=i.utcOffset(e);return e.adjust(0,0,0,-n),n=t.utcOffset(e),e.adjust(0,0,0,n),null},s.Timezone.fromData=function(e){var i=new s.Timezone;return i.fromData(e)},s.Timezone.utcTimezone=s.Timezone.fromData({tzid:"UTC"}),s.Timezone.localTimezone=s.Timezone.fromData({tzid:"floating"}),s.Timezone.adjust_change=function(e,i,t,n,a){return s.Time.prototype.adjust.call(e,i,t,n,a,e)},s.Timezone._minimumExpansionYear=-1,s.Timezone.MAX_YEAR=2035,s.Timezone.EXTRA_COVERAGE=5})();s.TimezoneService=function(){var u,r={get count(){return Object.keys(u).length},reset:function(){u=Object.create(null);var e=s.Timezone.utcTimezone;u.Z=e,u.UTC=e,u.GMT=e},has:function(e){return!!u[e]},get:function(e){return u[e]},register:function(e,i){if(e instanceof s.Component&&e.name==="vtimezone"&&(i=new s.Timezone(e),e=i.tzid),i instanceof s.Timezone)u[e]=i;else throw new TypeError("timezone must be ICAL.Timezone or ICAL.Component")},remove:function(e){return delete u[e]}};return r.reset(),r}();(function(){s.Time=function(r,e){this.wrappedJSObject=this;var i=this._time=Object.create(null);i.year=0,i.month=1,i.day=1,i.hour=0,i.minute=0,i.second=0,i.isDate=!1,this.fromData(r,e)},s.Time._dowCache={},s.Time._wnCache={},s.Time.prototype={icalclass:"icaltime",_cachedUnixTime:null,get icaltype(){return this.isDate?"date":"date-time"},zone:null,_pendingNormalization:!1,clone:function(){return new s.Time(this._time,this.zone)},reset:function(){this.fromData(s.Time.epochTime),this.zone=s.Timezone.utcTimezone},resetTo:function(r,e,i,t,n,a,o){this.fromData({year:r,month:e,day:i,hour:t,minute:n,second:a,zone:o})},fromJSDate:function(r,e){return r?e?(this.zone=s.Timezone.utcTimezone,this.year=r.getUTCFullYear(),this.month=r.getUTCMonth()+1,this.day=r.getUTCDate(),this.hour=r.getUTCHours(),this.minute=r.getUTCMinutes(),this.second=r.getUTCSeconds()):(this.zone=s.Timezone.localTimezone,this.year=r.getFullYear(),this.month=r.getMonth()+1,this.day=r.getDate(),this.hour=r.getHours(),this.minute=r.getMinutes(),this.second=r.getSeconds()):this.reset(),this._cachedUnixTime=null,this},fromData:function(r,e){if(r){for(var i in r)if(Object.prototype.hasOwnProperty.call(r,i)){if(i==="icaltype")continue;this[i]=r[i]}}if(e&&(this.zone=e),r&&!("isDate"in r)?this.isDate=!("hour"in r):r&&"isDate"in r&&(this.isDate=r.isDate),r&&"timezone"in r){var t=s.TimezoneService.get(r.timezone);this.zone=t||s.Timezone.localTimezone}return r&&"zone"in r&&(this.zone=r.zone),this.zone||(this.zone=s.Timezone.localTimezone),this._cachedUnixTime=null,this},dayOfWeek:function(r){var e=r||s.Time.SUNDAY,i=(this.year<<12)+(this.month<<8)+(this.day<<3)+e;if(i in s.Time._dowCache)return s.Time._dowCache[i];var t=this.day,n=this.month+(this.month<3?12:0),a=this.year-(this.month<3?1:0),o=t+a+s.helpers.trunc((n+1)*26/10)+s.helpers.trunc(a/4);return o+=s.helpers.trunc(a/100)*6+s.helpers.trunc(a/400),o=(o+7-e)%7+1,s.Time._dowCache[i]=o,o},dayOfYear:function(){var r=s.Time.isLeapYear(this.year)?1:0,e=s.Time.daysInYearPassedMonth;return e[r][this.month-1]+this.day},startOfWeek:function(r){var e=r||s.Time.SUNDAY,i=this.clone();return i.day-=(this.dayOfWeek()+7-e)%7,i.isDate=!0,i.hour=0,i.minute=0,i.second=0,i},endOfWeek:function(r){var e=r||s.Time.SUNDAY,i=this.clone();return i.day+=(7-this.dayOfWeek()+e-s.Time.SUNDAY)%7,i.isDate=!0,i.hour=0,i.minute=0,i.second=0,i},startOfMonth:function(){var r=this.clone();return r.day=1,r.isDate=!0,r.hour=0,r.minute=0,r.second=0,r},endOfMonth:function(){var r=this.clone();return r.day=s.Time.daysInMonth(r.month,r.year),r.isDate=!0,r.hour=0,r.minute=0,r.second=0,r},startOfYear:function(){var r=this.clone();return r.day=1,r.month=1,r.isDate=!0,r.hour=0,r.minute=0,r.second=0,r},endOfYear:function(){var r=this.clone();return r.day=31,r.month=12,r.isDate=!0,r.hour=0,r.minute=0,r.second=0,r},startDoyWeek:function(r){var e=r||s.Time.SUNDAY,i=this.dayOfWeek()-e;return i<0&&(i+=7),this.dayOfYear()-i},getDominicalLetter:function(){return s.Time.getDominicalLetter(this.year)},nthWeekDay:function(r,e){var i=s.Time.daysInMonth(this.month,this.year),t,n=e,a=0,o=this.clone();if(n>=0){o.day=1,n!=0&&n--,a=o.day;var f=o.dayOfWeek(),v=r-f;v<0&&(v+=7),a+=v,a-=r,t=r}else{o.day=i;var l=o.dayOfWeek();n++,t=l-r,t<0&&(t+=7),t=i-t}return t+=n*7,a+t},isNthWeekDay:function(u,r){var e=this.dayOfWeek();if(r===0&&e===u)return!0;var i=this.nthWeekDay(u,r);return i===this.day},weekNumber:function(r){var e=(this.year<<12)+(this.month<<8)+(this.day<<3)+r;if(e in s.Time._wnCache)return s.Time._wnCache[e];var i,t=this.clone();t.isDate=!0;var n=this.year;t.month==12&&t.day>25?(i=s.Time.weekOneStarts(n+1,r),t.compare(i)<0?i=s.Time.weekOneStarts(n,r):n++):(i=s.Time.weekOneStarts(n,r),t.compare(i)<0&&(i=s.Time.weekOneStarts(--n,r)));var a=t.subtractDate(i).toSeconds()/86400,o=s.helpers.trunc(a/7)+1;return s.Time._wnCache[e]=o,o},addDuration:function(r){var e=r.isNegative?-1:1,i=this.second,t=this.minute,n=this.hour,a=this.day;i+=e*r.seconds,t+=e*r.minutes,n+=e*r.hours,a+=e*r.days,a+=e*7*r.weeks,this.second=i,this.minute=t,this.hour=n,this.day=a,this._cachedUnixTime=null},subtractDate:function(r){var e=this.toUnixTime()+this.utcOffset(),i=r.toUnixTime()+r.utcOffset();return s.Duration.fromSeconds(e-i)},subtractDateTz:function(r){var e=this.toUnixTime(),i=r.toUnixTime();return s.Duration.fromSeconds(e-i)},compare:function(r){var e=this.toUnixTime(),i=r.toUnixTime();return e>i?1:i>e?-1:0},compareDateOnlyTz:function(r,e){function i(o){return s.Time._cmp_attr(t,n,o)}var t=this.convertToZone(e),n=r.convertToZone(e),a=0;return(a=i("year"))!=0||(a=i("month"))!=0||(a=i("day"))!=0,a},convertToZone:function(r){var e=this.clone(),i=this.zone.tzid==r.tzid;return!this.isDate&&!i&&s.Timezone.convert_time(e,this.zone,r),e.zone=r,e},utcOffset:function(){return this.zone==s.Timezone.localTimezone||this.zone==s.Timezone.utcTimezone?0:this.zone.utcOffset(this)},toICALString:function(){var u=this.toString();return u.length>10?s.design.icalendar.value["date-time"].toICAL(u):s.design.icalendar.value.date.toICAL(u)},toString:function(){var r=this.year+"-"+s.helpers.pad2(this.month)+"-"+s.helpers.pad2(this.day);return this.isDate||(r+="T"+s.helpers.pad2(this.hour)+":"+s.helpers.pad2(this.minute)+":"+s.helpers.pad2(this.second),this.zone===s.Timezone.utcTimezone&&(r+="Z")),r},toJSDate:function(){return this.zone==s.Timezone.localTimezone?this.isDate?new Date(this.year,this.month-1,this.day):new Date(this.year,this.month-1,this.day,this.hour,this.minute,this.second,0):new Date(this.toUnixTime()*1e3)},_normalize:function(){var r=this._time.isDate;return this._time.isDate&&(this._time.hour=0,this._time.minute=0,this._time.second=0),this.adjust(0,0,0,0),this},adjust:function(r,e,i,t,n){var a,o,f=0,v=0,l,d,c,m,y,p=n||this._time;if(p.isDate||(l=p.second+t,p.second=l%60,a=s.helpers.trunc(l/60),p.second<0&&(p.second+=60,a--),d=p.minute+i+a,p.minute=d%60,o=s.helpers.trunc(d/60),p.minute<0&&(p.minute+=60,o--),c=p.hour+e+o,p.hour=c%24,f=s.helpers.trunc(c/24),p.hour<0&&(p.hour+=24,f--)),p.month>12?v=s.helpers.trunc((p.month-1)/12):p.month<1&&(v=s.helpers.trunc(p.month/12)-1),p.year+=v,p.month-=12*v,m=p.day+r+f,m>0)for(;y=s.Time.daysInMonth(p.month,p.year),!(m<=y);)p.month++,p.month>12&&(p.year++,p.month=1),m-=y;else for(;m<=0;)p.month==1?(p.year--,p.month=12):p.month--,m+=s.Time.daysInMonth(p.month,p.year);return p.day=m,this._cachedUnixTime=null,this},fromUnixTime:function(r){this.zone=s.Timezone.utcTimezone;var e=s.Time.epochTime.clone();e.adjust(0,0,0,r),this.year=e.year,this.month=e.month,this.day=e.day,this.hour=e.hour,this.minute=e.minute,this.second=Math.floor(e.second),this._cachedUnixTime=null},toUnixTime:function(){if(this._cachedUnixTime!==null)return this._cachedUnixTime;var r=this.utcOffset(),e=Date.UTC(this.year,this.month-1,this.day,this.hour,this.minute,this.second-r);return this._cachedUnixTime=e/1e3,this._cachedUnixTime},toJSON:function(){for(var u=["year","month","day","hour","minute","second","isDate"],r=Object.create(null),e=0,i=u.length,t;e<i;e++)t=u[e],r[t]=this[t];return this.zone&&(r.timezone=this.zone.tzid),r}},function(){function r(e){Object.defineProperty(s.Time.prototype,e,{get:function(){return this._pendingNormalization&&(this._normalize(),this._pendingNormalization=!1),this._time[e]},set:function(t){return e==="isDate"&&t&&!this._time.isDate&&this.adjust(0,0,0,0),this._cachedUnixTime=null,this._pendingNormalization=!0,this._time[e]=t,t}})}"defineProperty"in Object&&(r("year"),r("month"),r("day"),r("hour"),r("minute"),r("second"),r("isDate"))}(),s.Time.daysInMonth=function(r,e){var i=[0,31,28,31,30,31,30,31,31,30,31,30,31],t=30;return r<1||r>12||(t=i[r],r==2&&(t+=s.Time.isLeapYear(e))),t},s.Time.isLeapYear=function(r){return r<=1752?r%4==0:r%4==0&&r%100!=0||r%400==0},s.Time.fromDayOfYear=function(r,e){var i=e,t=r,n=new s.Time;n.auto_normalize=!1;var a=s.Time.isLeapYear(i)?1:0;if(t<1)return i--,a=s.Time.isLeapYear(i)?1:0,t+=s.Time.daysInYearPassedMonth[a][12],s.Time.fromDayOfYear(t,i);if(t>s.Time.daysInYearPassedMonth[a][12])return a=s.Time.isLeapYear(i)?1:0,t-=s.Time.daysInYearPassedMonth[a][12],i++,s.Time.fromDayOfYear(t,i);n.year=i,n.isDate=!0;for(var o=11;o>=0;o--)if(t>s.Time.daysInYearPassedMonth[a][o]){n.month=o+1,n.day=t-s.Time.daysInYearPassedMonth[a][o];break}return n.auto_normalize=!0,n},s.Time.fromStringv2=function(r){return new s.Time({year:parseInt(r.substr(0,4),10),month:parseInt(r.substr(5,2),10),day:parseInt(r.substr(8,2),10),isDate:!0})},s.Time.fromDateString=function(u){return new s.Time({year:s.helpers.strictParseInt(u.substr(0,4)),month:s.helpers.strictParseInt(u.substr(5,2)),day:s.helpers.strictParseInt(u.substr(8,2)),isDate:!0})},s.Time.fromDateTimeString=function(u,r){if(u.length<19)throw new Error('invalid date-time value: "'+u+'"');var e;u[19]&&u[19]==="Z"?e="Z":r&&(e=r.getParameter("tzid"));var i=new s.Time({year:s.helpers.strictParseInt(u.substr(0,4)),month:s.helpers.strictParseInt(u.substr(5,2)),day:s.helpers.strictParseInt(u.substr(8,2)),hour:s.helpers.strictParseInt(u.substr(11,2)),minute:s.helpers.strictParseInt(u.substr(14,2)),second:s.helpers.strictParseInt(u.substr(17,2)),timezone:e});return i},s.Time.fromString=function(r,e){return r.length>10?s.Time.fromDateTimeString(r,e):s.Time.fromDateString(r)},s.Time.fromJSDate=function(r,e){var i=new s.Time;return i.fromJSDate(r,e)},s.Time.fromData=function(r,e){var i=new s.Time;return i.fromData(r,e)},s.Time.now=function(){return s.Time.fromJSDate(new Date,!1)},s.Time.weekOneStarts=function(r,e){var i=s.Time.fromData({year:r,month:1,day:1,isDate:!0}),t=i.dayOfWeek(),n=e||s.Time.DEFAULT_WEEK_START;return t>s.Time.THURSDAY&&(i.day+=7),n>s.Time.THURSDAY&&(i.day-=7),i.day-=t-n,i},s.Time.getDominicalLetter=function(u){var r="GFEDCBA",e=(u+(u/4|0)+(u/400|0)-(u/100|0)-1)%7,i=s.Time.isLeapYear(u);return i?r[(e+6)%7]+r[e]:r[e]},s.Time.epochTime=s.Time.fromData({year:1970,month:1,day:1,hour:0,minute:0,second:0,isDate:!1,timezone:"Z"}),s.Time._cmp_attr=function(r,e,i){return r[i]>e[i]?1:r[i]<e[i]?-1:0},s.Time.daysInYearPassedMonth=[[0,31,59,90,120,151,181,212,243,273,304,334,365],[0,31,60,91,121,152,182,213,244,274,305,335,366]],s.Time.SUNDAY=1,s.Time.MONDAY=2,s.Time.TUESDAY=3,s.Time.WEDNESDAY=4,s.Time.THURSDAY=5,s.Time.FRIDAY=6,s.Time.SATURDAY=7,s.Time.DEFAULT_WEEK_START=s.Time.MONDAY})();(function(){s.VCardTime=function(u,r,e){this.wrappedJSObject=this;var i=this._time=Object.create(null);i.year=null,i.month=null,i.day=null,i.hour=null,i.minute=null,i.second=null,this.icaltype=e||"date-and-or-time",this.fromData(u,r)},s.helpers.inherits(s.Time,s.VCardTime,{icalclass:"vcardtime",icaltype:"date-and-or-time",zone:null,clone:function(){return new s.VCardTime(this._time,this.zone,this.icaltype)},_normalize:function(){return this},utcOffset:function(){return this.zone instanceof s.UtcOffset?this.zone.toSeconds():s.Time.prototype.utcOffset.apply(this,arguments)},toICALString:function(){return s.design.vcard.value[this.icaltype].toICAL(this.toString())},toString:function(){var r=s.helpers.pad2,e=this.year,i=this.month,t=this.day,n=this.hour,a=this.minute,o=this.second,f=e!==null,v=i!==null,l=t!==null,d=n!==null,c=a!==null,m=o!==null,y=(f?r(e)+(v||l?"-":""):v||l?"--":"")+(v?r(i):"")+(l?"-"+r(t):""),p=(d?r(n):"-")+(d&&c?":":"")+(c?r(a):"")+(!d&&!c?"-":"")+(c&&m?":":"")+(m?r(o):""),_;if(this.zone===s.Timezone.utcTimezone)_="Z";else if(this.zone instanceof s.UtcOffset)_=this.zone.toString();else if(this.zone===s.Timezone.localTimezone)_="";else if(this.zone instanceof s.Timezone){var w=s.UtcOffset.fromSeconds(this.zone.utcOffset(this));_=w.toString()}else _="";switch(this.icaltype){case"time":return p+_;case"date-and-or-time":case"date-time":return y+(p=="--"?"":"T"+p+_);case"date":return y}return null}}),s.VCardTime.fromDateAndOrTimeString=function(u,r){function e(p,_,w){return p?s.helpers.strictParseInt(p.substr(_,w)):null}var i=u.split("T"),t=i[0],n=i[1],a=n?s.design.vcard.value.time._splitZone(n):[],o=a[0],f=a[1],v=s.helpers.strictParseInt,l=t?t.length:0,d=f?f.length:0,c=t&&t[0]=="-"&&t[1]=="-",m=f&&f[0]=="-",y={year:c?null:e(t,0,4),month:c&&(l==4||l==7)?e(t,2,2):l==7||l==10?e(t,5,2):null,day:l==5?e(t,3,2):l==7&&c?e(t,5,2):l==10?e(t,8,2):null,hour:m?null:e(f,0,2),minute:m&&d==3?e(f,1,2):d>4?m?e(f,1,2):e(f,3,2):null,second:d==4?e(f,2,2):d==6?e(f,4,2):d==8?e(f,6,2):null};return o=="Z"?o=s.Timezone.utcTimezone:o&&o[3]==":"?o=s.UtcOffset.fromString(o):o=null,new s.VCardTime(y,o,r)}})();(function(){var u={SU:s.Time.SUNDAY,MO:s.Time.MONDAY,TU:s.Time.TUESDAY,WE:s.Time.WEDNESDAY,TH:s.Time.THURSDAY,FR:s.Time.FRIDAY,SA:s.Time.SATURDAY},r={};for(var e in u)u.hasOwnProperty(e)&&(r[u[e]]=e);var i=["BYSECOND","BYMINUTE","BYHOUR","BYDAY","BYMONTHDAY","BYYEARDAY","BYWEEKNO","BYMONTH","BYSETPOS"];s.Recur=function(d){this.wrappedJSObject=this,this.parts={},d&&typeof d=="object"&&this.fromData(d)},s.Recur.prototype={parts:null,interval:1,wkst:s.Time.MONDAY,until:null,count:null,freq:null,icalclass:"icalrecur",icaltype:"recur",iterator:function(l){return new s.RecurIterator({rule:this,dtstart:l})},clone:function(){return new s.Recur(this.toJSON())},isFinite:function(){return!!(this.count||this.until)},isByCount:function(){return!!(this.count&&!this.until)},addComponent:function(d,c){var m=d.toUpperCase();m in this.parts?this.parts[m].push(c):this.parts[m]=[c]},setComponent:function(d,c){this.parts[d.toUpperCase()]=c.slice()},getComponent:function(d){var c=d.toUpperCase();return c in this.parts?this.parts[c].slice():[]},getNextOccurrence:function(d,c){var m=this.iterator(d),y,p;do y=m.next();while(y&&y.compare(c)<=0);return y&&c.zone&&(y.zone=c.zone),y},fromData:function(l){for(var d in l){var c=d.toUpperCase();c in v?Array.isArray(l[d])?this.parts[c]=l[d]:this.parts[c]=[l[d]]:this[d]=l[d]}this.interval&&typeof this.interval!="number"&&f.INTERVAL(this.interval,this),this.wkst&&typeof this.wkst!="number"&&(this.wkst=s.Recur.icalDayToNumericDay(this.wkst)),this.until&&!(this.until instanceof s.Time)&&(this.until=s.Time.fromString(this.until))},toJSON:function(){var l=Object.create(null);l.freq=this.freq,this.count&&(l.count=this.count),this.interval>1&&(l.interval=this.interval);for(var d in this.parts)if(this.parts.hasOwnProperty(d)){var c=this.parts[d];Array.isArray(c)&&c.length==1?l[d.toLowerCase()]=c[0]:l[d.toLowerCase()]=s.helpers.clone(this.parts[d])}return this.until&&(l.until=this.until.toString()),"wkst"in this&&this.wkst!==s.Time.DEFAULT_WEEK_START&&(l.wkst=s.Recur.numericDayToIcalDay(this.wkst)),l},toString:function(){var d="FREQ="+this.freq;this.count&&(d+=";COUNT="+this.count),this.interval>1&&(d+=";INTERVAL="+this.interval);for(var c in this.parts)this.parts.hasOwnProperty(c)&&(d+=";"+c+"="+this.parts[c]);return this.until&&(d+=";UNTIL="+this.until.toICALString()),"wkst"in this&&this.wkst!==s.Time.DEFAULT_WEEK_START&&(d+=";WKST="+s.Recur.numericDayToIcalDay(this.wkst)),d}};function t(l,d,c,m){var y=m;if(m[0]==="+"&&(y=m.substr(1)),y=s.helpers.strictParseInt(y),d!==void 0&&m<d)throw new Error(l+': invalid value "'+m+'" must be > '+d);if(c!==void 0&&m>c)throw new Error(l+': invalid value "'+m+'" must be < '+d);return y}s.Recur.icalDayToNumericDay=function(d,c){var m=c||s.Time.SUNDAY;return(u[d]-m+7)%7+1},s.Recur.numericDayToIcalDay=function(d,c){var m=c||s.Time.SUNDAY,y=d+m-s.Time.SUNDAY;return y>7&&(y-=7),r[y]};var n=/^(SU|MO|TU|WE|TH|FR|SA)$/,a=/^([+-])?(5[0-3]|[1-4][0-9]|[1-9])?(SU|MO|TU|WE|TH|FR|SA)$/,o=["SECONDLY","MINUTELY","HOURLY","DAILY","WEEKLY","MONTHLY","YEARLY"],f={FREQ:function(l,d,c){if(o.indexOf(l)!==-1)d.freq=l;else throw new Error('invalid frequency "'+l+'" expected: "'+o.join(", ")+'"')},COUNT:function(l,d,c){d.count=s.helpers.strictParseInt(l)},INTERVAL:function(l,d,c){d.interval=s.helpers.strictParseInt(l),d.interval<1&&(d.interval=1)},UNTIL:function(l,d,c){l.length>10?d.until=s.design.icalendar.value["date-time"].fromICAL(l):d.until=s.design.icalendar.value.date.fromICAL(l),c||(d.until=s.Time.fromString(d.until))},WKST:function(l,d,c){if(n.test(l))d.wkst=s.Recur.icalDayToNumericDay(l);else throw new Error('invalid WKST value "'+l+'"')}},v={BYSECOND:t.bind(this,"BYSECOND",0,60),BYMINUTE:t.bind(this,"BYMINUTE",0,59),BYHOUR:t.bind(this,"BYHOUR",0,23),BYDAY:function(l){if(a.test(l))return l;throw new Error('invalid BYDAY value "'+l+'"')},BYMONTHDAY:t.bind(this,"BYMONTHDAY",-31,31),BYYEARDAY:t.bind(this,"BYYEARDAY",-366,366),BYWEEKNO:t.bind(this,"BYWEEKNO",-53,53),BYMONTH:t.bind(this,"BYMONTH",1,12),BYSETPOS:t.bind(this,"BYSETPOS",-366,366)};s.Recur.fromString=function(l){var d=s.Recur._stringToData(l,!1);return new s.Recur(d)},s.Recur.fromData=function(l){return new s.Recur(l)},s.Recur._stringToData=function(l,d){for(var c=Object.create(null),m=l.split(";"),y=m.length,p=0;p<y;p++){var _=m[p].split("="),w=_[0].toUpperCase(),E=_[0].toLowerCase(),Y=d?E:w,g=_[1];if(w in v){for(var A=g.split(","),O=0,S=A.length;O<S;O++)A[O]=v[w](A[O]);c[Y]=A.length==1?A[0]:A}else w in f?f[w](g,c,d):c[E]=g}return c}})();s.RecurIterator=function(){function u(r){this.fromData(r)}return u.prototype={completed:!1,rule:null,dtstart:null,last:null,occurrence_number:0,by_indices:null,initialized:!1,by_data:null,days:null,days_index:0,fromData:function(r){if(this.rule=s.helpers.formatClassType(r.rule,s.Recur),!this.rule)throw new Error("iterator requires a (ICAL.Recur) rule");if(this.dtstart=s.helpers.formatClassType(r.dtstart,s.Time),!this.dtstart)throw new Error("iterator requires a (ICAL.Time) dtstart");r.by_data?this.by_data=r.by_data:this.by_data=s.helpers.clone(this.rule.parts,!0),r.occurrence_number&&(this.occurrence_number=r.occurrence_number),this.days=r.days||[],r.last&&(this.last=s.helpers.formatClassType(r.last,s.Time)),this.by_indices=r.by_indices,this.by_indices||(this.by_indices={BYSECOND:0,BYMINUTE:0,BYHOUR:0,BYDAY:0,BYMONTH:0,BYWEEKNO:0,BYMONTHDAY:0}),this.initialized=r.initialized||!1,this.initialized||this.init()},init:function(){this.initialized=!0,this.last=this.dtstart.clone();var e=this.by_data;if("BYDAY"in e&&this.sort_byday_rules(e.BYDAY),"BYYEARDAY"in e&&("BYMONTH"in e||"BYWEEKNO"in e||"BYMONTHDAY"in e||"BYDAY"in e))throw new Error("Invalid BYYEARDAY rule");if("BYWEEKNO"in e&&"BYMONTHDAY"in e)throw new Error("BYWEEKNO does not fit to BYMONTHDAY");if(this.rule.freq=="MONTHLY"&&("BYYEARDAY"in e||"BYWEEKNO"in e))throw new Error("For MONTHLY recurrences neither BYYEARDAY nor BYWEEKNO may appear");if(this.rule.freq=="WEEKLY"&&("BYYEARDAY"in e||"BYMONTHDAY"in e))throw new Error("For WEEKLY recurrences neither BYMONTHDAY nor BYYEARDAY may appear");if(this.rule.freq!="YEARLY"&&"BYYEARDAY"in e)throw new Error("BYYEARDAY may only appear in YEARLY rules");if(this.last.second=this.setup_defaults("BYSECOND","SECONDLY",this.dtstart.second),this.last.minute=this.setup_defaults("BYMINUTE","MINUTELY",this.dtstart.minute),this.last.hour=this.setup_defaults("BYHOUR","HOURLY",this.dtstart.hour),this.last.day=this.setup_defaults("BYMONTHDAY","DAILY",this.dtstart.day),this.last.month=this.setup_defaults("BYMONTH","MONTHLY",this.dtstart.month),this.rule.freq=="WEEKLY")if("BYDAY"in e){var i=this.ruleDayOfWeek(e.BYDAY[0],this.rule.wkst),t=i[0],n=i[1],a=n-this.last.dayOfWeek(this.rule.wkst);(this.last.dayOfWeek(this.rule.wkst)<n&&a>=0||a<0)&&(this.last.day+=a)}else{var o=s.Recur.numericDayToIcalDay(this.dtstart.dayOfWeek());e.BYDAY=[o]}if(this.rule.freq=="YEARLY"){for(;this.expand_year_days(this.last.year),!(this.days.length>0);)this.increment_year(this.rule.interval);this._nextByYearDay()}if(this.rule.freq=="MONTHLY"&&this.has_by_data("BYDAY")){var f=null,v=this.last.clone(),l=s.Time.daysInMonth(this.last.month,this.last.year);for(var d in this.by_data.BYDAY)if(this.by_data.BYDAY.hasOwnProperty(d)){this.last=v.clone();var i=this.ruleDayOfWeek(this.by_data.BYDAY[d]),t=i[0],n=i[1],c=this.last.nthWeekDay(n,t);if(t>=6||t<=-6)throw new Error("Malformed values in BYDAY part");if(c>l||c<=0){if(f&&f.month==v.month)continue;for(;c>l||c<=0;)this.increment_month(),l=s.Time.daysInMonth(this.last.month,this.last.year),c=this.last.nthWeekDay(n,t)}this.last.day=c,(!f||this.last.compare(f)<0)&&(f=this.last.clone())}if(this.last=f.clone(),this.has_by_data("BYMONTHDAY")&&this._byDayAndMonthDay(!0),this.last.day>l||this.last.day==0)throw new Error("Malformed values in BYDAY part")}else if(this.has_by_data("BYMONTHDAY")&&this.last.day<0){var l=s.Time.daysInMonth(this.last.month,this.last.year);this.last.day=l+this.last.day+1}},next:function(){var e=this.last?this.last.clone():null;if(this.rule.count&&this.occurrence_number>=this.rule.count||this.rule.until&&this.last.compare(this.rule.until)>0)return this.completed=!0,null;if(this.occurrence_number==0&&this.last.compare(this.dtstart)>=0)return this.occurrence_number++,this.last;var i;do switch(i=1,this.rule.freq){case"SECONDLY":this.next_second();break;case"MINUTELY":this.next_minute();break;case"HOURLY":this.next_hour();break;case"DAILY":this.next_day();break;case"WEEKLY":this.next_week();break;case"MONTHLY":i=this.next_month();break;case"YEARLY":this.next_year();break;default:return null}while(!this.check_contracting_rules()||this.last.compare(this.dtstart)<0||!i);if(this.last.compare(e)==0)throw new Error("Same occurrence found twice, protecting you from death by recursion");return this.rule.until&&this.last.compare(this.rule.until)>0?(this.completed=!0,null):(this.occurrence_number++,this.last)},next_second:function(){return this.next_generic("BYSECOND","SECONDLY","second","minute")},increment_second:function(e){return this.increment_generic(e,"second",60,"minute")},next_minute:function(){return this.next_generic("BYMINUTE","MINUTELY","minute","hour","next_second")},increment_minute:function(e){return this.increment_generic(e,"minute",60,"hour")},next_hour:function(){return this.next_generic("BYHOUR","HOURLY","hour","monthday","next_minute")},increment_hour:function(e){this.increment_generic(e,"hour",24,"monthday")},next_day:function(){var e="BYDAY"in this.by_data,i=this.rule.freq=="DAILY";return this.next_hour()==0||(i?this.increment_monthday(this.rule.interval):this.increment_monthday(1)),0},next_week:function(){var e=0;if(this.next_weekday_by_week()==0)return e;if(this.has_by_data("BYWEEKNO")){var i=++this.by_indices.BYWEEKNO;this.by_indices.BYWEEKNO==this.by_data.BYWEEKNO.length&&(this.by_indices.BYWEEKNO=0,e=1),this.last.month=1,this.last.day=1;var t=this.by_data.BYWEEKNO[this.by_indices.BYWEEKNO];this.last.day+=7*t,e&&this.increment_year(1)}else this.increment_monthday(7*this.rule.interval);return e},normalizeByMonthDayRules:function(r,e,i){for(var t=s.Time.daysInMonth(e,r),n=[],a=0,o=i.length,f;a<o;a++)if(f=i[a],!(Math.abs(f)>t)){if(f<0)f=t+(f+1);else if(f===0)continue;n.indexOf(f)===-1&&n.push(f)}return n.sort(function(v,l){return v-l})},_byDayAndMonthDay:function(r){var e,i=this.by_data.BYDAY,t,n=0,a,o=i.length,f=0,v,l=this,d=this.last.day;function c(){for(v=s.Time.daysInMonth(l.last.month,l.last.year),e=l.normalizeByMonthDayRules(l.last.year,l.last.month,l.by_data.BYMONTHDAY),a=e.length;e[n]<=d&&!(r&&e[n]==d)&&n<a-1;)n++}function m(){d=0,l.increment_month(),n=0,c()}c(),r&&(d-=1);for(var y=48;!f&&y;){if(y--,t=d+1,t>v){m();continue}var p=e[n++];if(p>=t)d=p;else{m();continue}for(var _=0;_<o;_++){var w=this.ruleDayOfWeek(i[_]),E=w[0],Y=w[1];if(this.last.day=d,this.last.isNthWeekDay(Y,E)){f=1;break}}if(!f&&n===a){m();continue}}if(y<=0)throw new Error("Malformed values in BYDAY combined with BYMONTHDAY parts");return f},next_month:function(){var e=this.rule.freq=="MONTHLY",i=1;if(this.next_hour()==0)return i;if(this.has_by_data("BYDAY")&&this.has_by_data("BYMONTHDAY"))i=this._byDayAndMonthDay();else if(this.has_by_data("BYDAY")){var t=s.Time.daysInMonth(this.last.month,this.last.year),n=0,a=0;if(this.has_by_data("BYSETPOS")){for(var o=this.last.day,f=1;f<=t;f++)this.last.day=f,this.is_day_in_byday(this.last)&&(a++,f<=o&&n++);this.last.day=o}i=0;for(var f=this.last.day+1;f<=t;f++)if(this.last.day=f,this.is_day_in_byday(this.last)&&(!this.has_by_data("BYSETPOS")||this.check_set_position(++n)||this.check_set_position(n-a-1))){i=1;break}f>t&&(this.last.day=1,this.increment_month(),this.is_day_in_byday(this.last)?(!this.has_by_data("BYSETPOS")||this.check_set_position(1))&&(i=1):i=0)}else if(this.has_by_data("BYMONTHDAY")){this.by_indices.BYMONTHDAY++,this.by_indices.BYMONTHDAY>=this.by_data.BYMONTHDAY.length&&(this.by_indices.BYMONTHDAY=0,this.increment_month());var t=s.Time.daysInMonth(this.last.month,this.last.year),f=this.by_data.BYMONTHDAY[this.by_indices.BYMONTHDAY];f<0&&(f=t+f+1),f>t?(this.last.day=1,i=this.is_day_in_byday(this.last)):this.last.day=f}else{this.increment_month();var t=s.Time.daysInMonth(this.last.month,this.last.year);this.by_data.BYMONTHDAY[0]>t?i=0:this.last.day=this.by_data.BYMONTHDAY[0]}return i},next_weekday_by_week:function(){var e=0;if(this.next_hour()==0)return e;if(!this.has_by_data("BYDAY"))return 1;for(;;){var i=new s.Time;this.by_indices.BYDAY++,this.by_indices.BYDAY==Object.keys(this.by_data.BYDAY).length&&(this.by_indices.BYDAY=0,e=1);var t=this.by_data.BYDAY[this.by_indices.BYDAY],n=this.ruleDayOfWeek(t),a=n[1];a-=this.rule.wkst,a<0&&(a+=7),i.year=this.last.year,i.month=this.last.month,i.day=this.last.day;var o=i.startDoyWeek(this.rule.wkst);if(!(a+o<1&&!e)){var f=s.Time.fromDayOfYear(o+a,this.last.year);return this.last.year=f.year,this.last.month=f.month,this.last.day=f.day,e}}},next_year:function(){if(this.next_hour()==0)return 0;if(++this.days_index==this.days.length){this.days_index=0;do this.increment_year(this.rule.interval),this.expand_year_days(this.last.year);while(this.days.length==0)}return this._nextByYearDay(),1},_nextByYearDay:function(){var e=this.days[this.days_index],i=this.last.year;e<1&&(e+=1,i+=1);var t=s.Time.fromDayOfYear(e,i);this.last.day=t.day,this.last.month=t.month},ruleDayOfWeek:function(e,i){var t=e.match(/([+-]?[0-9])?(MO|TU|WE|TH|FR|SA|SU)/);if(t){var n=parseInt(t[1]||0,10);return e=s.Recur.icalDayToNumericDay(t[2],i),[n,e]}else return[0,0]},next_generic:function(e,i,t,n,a){var o=e in this.by_data,f=this.rule.freq==i,v=0;if(a&&this[a]()==0)return v;if(o){this.by_indices[e]++;var l=this.by_indices[e],d=this.by_data[e];this.by_indices[e]==d.length&&(this.by_indices[e]=0,v=1),this.last[t]=d[this.by_indices[e]]}else f&&this["increment_"+t](this.rule.interval);return o&&v&&f&&this["increment_"+n](1),v},increment_monthday:function(e){for(var i=0;i<e;i++){var t=s.Time.daysInMonth(this.last.month,this.last.year);this.last.day++,this.last.day>t&&(this.last.day-=t,this.increment_month())}},increment_month:function(){if(this.last.day=1,this.has_by_data("BYMONTH"))this.by_indices.BYMONTH++,this.by_indices.BYMONTH==this.by_data.BYMONTH.length&&(this.by_indices.BYMONTH=0,this.increment_year(1)),this.last.month=this.by_data.BYMONTH[this.by_indices.BYMONTH];else{this.rule.freq=="MONTHLY"?this.last.month+=this.rule.interval:this.last.month++,this.last.month--;var e=s.helpers.trunc(this.last.month/12);this.last.month%=12,this.last.month++,e!=0&&this.increment_year(e)}},increment_year:function(e){this.last.year+=e},increment_generic:function(e,i,t,n){this.last[i]+=e;var a=s.helpers.trunc(this.last[i]/t);this.last[i]%=t,a!=0&&this["increment_"+n](a)},has_by_data:function(e){return e in this.rule.parts},expand_year_days:function(e){var i=new s.Time;this.days=[];var t={},n=["BYDAY","BYWEEKNO","BYMONTHDAY","BYMONTH","BYYEARDAY"];for(var a in n)if(n.hasOwnProperty(a)){var o=n[a];o in this.rule.parts&&(t[o]=this.rule.parts[o])}if("BYMONTH"in t&&"BYWEEKNO"in t){var f=1,v={};i.year=e,i.isDate=!0;for(var l=0;l<this.by_data.BYMONTH.length;l++){var d=this.by_data.BYMONTH[l];i.month=d,i.day=1;var c=i.weekNumber(this.rule.wkst);i.day=s.Time.daysInMonth(d,e);var m=i.weekNumber(this.rule.wkst);for(l=c;l<m;l++)v[l]=1}for(var y=0;y<this.by_data.BYWEEKNO.length&&f;y++){var p=this.by_data.BYWEEKNO[y];p<52?f&=v[y]:f=0}f?delete t.BYMONTH:delete t.BYWEEKNO}var _=Object.keys(t).length;if(_==0){var w=this.dtstart.clone();w.year=this.last.year,this.days.push(w.dayOfYear())}else if(_==1&&"BYMONTH"in t){for(var E in this.by_data.BYMONTH)if(this.by_data.BYMONTH.hasOwnProperty(E)){var Y=this.dtstart.clone();Y.year=e,Y.month=this.by_data.BYMONTH[E],Y.isDate=!0,this.days.push(Y.dayOfYear())}}else if(_==1&&"BYMONTHDAY"in t){for(var g in this.by_data.BYMONTHDAY)if(this.by_data.BYMONTHDAY.hasOwnProperty(g)){var A=this.dtstart.clone(),O=this.by_data.BYMONTHDAY[g];if(O<0){var S=s.Time.daysInMonth(A.month,e);O=O+S+1}A.day=O,A.year=e,A.isDate=!0,this.days.push(A.dayOfYear())}}else if(_==2&&"BYMONTHDAY"in t&&"BYMONTH"in t){for(var E in this.by_data.BYMONTH)if(this.by_data.BYMONTH.hasOwnProperty(E)){var N=this.by_data.BYMONTH[E],S=s.Time.daysInMonth(N,e);for(var g in this.by_data.BYMONTHDAY)if(this.by_data.BYMONTHDAY.hasOwnProperty(g)){var O=this.by_data.BYMONTHDAY[g];O<0&&(O=O+S+1),i.day=O,i.month=N,i.year=e,i.isDate=!0,this.days.push(i.dayOfYear())}}}else if(!(_==1&&"BYWEEKNO"in t)){if(!(_==2&&"BYWEEKNO"in t&&"BYMONTHDAY"in t))if(_==1&&"BYDAY"in t)this.days=this.days.concat(this.expand_by_day(e));else if(_==2&&"BYDAY"in t&&"BYMONTH"in t){for(var E in this.by_data.BYMONTH)if(this.by_data.BYMONTH.hasOwnProperty(E)){var d=this.by_data.BYMONTH[E],S=s.Time.daysInMonth(d,e);i.year=e,i.month=this.by_data.BYMONTH[E],i.day=1,i.isDate=!0;var L=i.dayOfWeek(),x=i.dayOfYear()-1;i.day=S;var z=i.dayOfWeek();if(this.has_by_data("BYSETPOS")){for(var I=0,B=[],C=1;C<=S;C++)i.day=C,this.is_day_in_byday(i)&&B.push(C);for(var P=0;P<B.length;P++)(this.check_set_position(P+1)||this.check_set_position(P-B.length))&&this.days.push(x+B[P])}else for(var h in this.by_data.BYDAY)if(this.by_data.BYDAY.hasOwnProperty(h)){var T=this.by_data.BYDAY[h],b=this.ruleDayOfWeek(T),D=b[0],R=b[1],M,H=(R+7-L)%7+1,se=S-(z+7-R)%7;if(D==0)for(var C=H;C<=S;C+=7)this.days.push(x+C);else D>0?(M=H+(D-1)*7,M<=S&&this.days.push(x+M)):(M=se+(D+1)*7,M>0&&this.days.push(x+M))}}this.days.sort(function(ae,oe){return ae-oe})}else if(_==2&&"BYDAY"in t&&"BYMONTHDAY"in t){var k=this.expand_by_day(e);for(var W in k)if(k.hasOwnProperty(W)){var C=k[W],j=s.Time.fromDayOfYear(C,e);this.by_data.BYMONTHDAY.indexOf(j.day)>=0&&this.days.push(C)}}else if(_==3&&"BYDAY"in t&&"BYMONTHDAY"in t&&"BYMONTH"in t){var k=this.expand_by_day(e);for(var W in k)if(k.hasOwnProperty(W)){var C=k[W],j=s.Time.fromDayOfYear(C,e);this.by_data.BYMONTH.indexOf(j.month)>=0&&this.by_data.BYMONTHDAY.indexOf(j.day)>=0&&this.days.push(C)}}else if(_==2&&"BYDAY"in t&&"BYWEEKNO"in t){var k=this.expand_by_day(e);for(var W in k)if(k.hasOwnProperty(W)){var C=k[W],j=s.Time.fromDayOfYear(C,e),p=j.weekNumber(this.rule.wkst);this.by_data.BYWEEKNO.indexOf(p)&&this.days.push(C)}}else _==3&&"BYDAY"in t&&"BYWEEKNO"in t&&"BYMONTHDAY"in t||(_==1&&"BYYEARDAY"in t?this.days=this.days.concat(this.by_data.BYYEARDAY):this.days=[])}return 0},expand_by_day:function(e){var i=[],t=this.last.clone();t.year=e,t.month=1,t.day=1,t.isDate=!0;var n=t.dayOfWeek();t.month=12,t.day=31,t.isDate=!0;var a=t.dayOfWeek(),o=t.dayOfYear();for(var f in this.by_data.BYDAY)if(this.by_data.BYDAY.hasOwnProperty(f)){var v=this.by_data.BYDAY[f],l=this.ruleDayOfWeek(v),d=l[0],c=l[1];if(d==0)for(var m=(c+7-n)%7+1,y=m;y<=o;y+=7)i.push(y);else if(d>0){var p;c>=n?p=c-n+1:p=c-n+8,i.push(p+(d-1)*7)}else{var _;d=-d,c<=a?_=o-a+c:_=o-a+c-7,i.push(_-(d-1)*7)}}return i},is_day_in_byday:function(e){for(var i in this.by_data.BYDAY)if(this.by_data.BYDAY.hasOwnProperty(i)){var t=this.by_data.BYDAY[i],n=this.ruleDayOfWeek(t),a=n[0],o=n[1],f=e.dayOfWeek();if(a==0&&o==f||e.nthWeekDay(o,a)==e.day)return 1}return 0},check_set_position:function(e){if(this.has_by_data("BYSETPOS")){var i=this.by_data.BYSETPOS.indexOf(e);return i!==-1}return!1},sort_byday_rules:function(e){for(var i=0;i<e.length;i++)for(var t=0;t<i;t++){var n=this.ruleDayOfWeek(e[t],this.rule.wkst)[1],a=this.ruleDayOfWeek(e[i],this.rule.wkst)[1];if(n>a){var o=e[i];e[i]=e[t],e[t]=o}}},check_contract_restriction:function(e,i){var t=u._indexMap[e],n=u._expandMap[this.rule.freq][t],a=!1;if(e in this.by_data&&n==u.CONTRACT){var o=this.by_data[e];for(var f in o)if(o.hasOwnProperty(f)&&o[f]==i){a=!0;break}}else a=!0;return a},check_contracting_rules:function(){var e=this.last.dayOfWeek(),i=this.last.weekNumber(this.rule.wkst),t=this.last.dayOfYear();return this.check_contract_restriction("BYSECOND",this.last.second)&&this.check_contract_restriction("BYMINUTE",this.last.minute)&&this.check_contract_restriction("BYHOUR",this.last.hour)&&this.check_contract_restriction("BYDAY",s.Recur.numericDayToIcalDay(e))&&this.check_contract_restriction("BYWEEKNO",i)&&this.check_contract_restriction("BYMONTHDAY",this.last.day)&&this.check_contract_restriction("BYMONTH",this.last.month)&&this.check_contract_restriction("BYYEARDAY",t)},setup_defaults:function(e,i,t){var n=u._indexMap[e],a=u._expandMap[this.rule.freq][n];return a!=u.CONTRACT&&(e in this.by_data||(this.by_data[e]=[t]),this.rule.freq!=i)?this.by_data[e][0]:t},toJSON:function(){var r=Object.create(null);return r.initialized=this.initialized,r.rule=this.rule.toJSON(),r.dtstart=this.dtstart.toJSON(),r.by_data=this.by_data,r.days=this.days,r.last=this.last.toJSON(),r.by_indices=this.by_indices,r.occurrence_number=this.occurrence_number,r}},u._indexMap={BYSECOND:0,BYMINUTE:1,BYHOUR:2,BYDAY:3,BYMONTHDAY:4,BYYEARDAY:5,BYWEEKNO:6,BYMONTH:7,BYSETPOS:8},u._expandMap={SECONDLY:[1,1,1,1,1,1,1,1],MINUTELY:[2,1,1,1,1,1,1,1],HOURLY:[2,2,1,1,1,1,1,1],DAILY:[2,2,2,1,1,1,1,1],WEEKLY:[2,2,2,2,3,3,1,1],MONTHLY:[2,2,2,2,2,3,3,1],YEARLY:[2,2,2,2,2,2,2,2]},u.UNKNOWN=0,u.CONTRACT=1,u.EXPAND=2,u.ILLEGAL=3,u}();s.RecurExpansion=function(){function u(t){return s.helpers.formatClassType(t,s.Time)}function r(t,n){return t.compare(n)}function e(t){return t.hasProperty("rdate")||t.hasProperty("rrule")||t.hasProperty("recurrence-id")}function i(t){this.ruleDates=[],this.exDates=[],this.fromData(t)}return i.prototype={complete:!1,ruleIterators:null,ruleDates:null,exDates:null,ruleDateInc:0,exDateInc:0,exDate:null,ruleDate:null,dtstart:null,last:null,fromData:function(t){var n=s.helpers.formatClassType(t.dtstart,s.Time);if(n)this.dtstart=n;else throw new Error(".dtstart (ICAL.Time) must be given");if(t.component)this._init(t.component);else{if(this.last=u(t.last)||n.clone(),!t.ruleIterators)throw new Error(".ruleIterators or .component must be given");this.ruleIterators=t.ruleIterators.map(function(a){return s.helpers.formatClassType(a,s.RecurIterator)}),this.ruleDateInc=t.ruleDateInc,this.exDateInc=t.exDateInc,t.ruleDates&&(this.ruleDates=t.ruleDates.map(u),this.ruleDate=this.ruleDates[this.ruleDateInc]),t.exDates&&(this.exDates=t.exDates.map(u),this.exDate=this.exDates[this.exDateInc]),typeof t.complete!="undefined"&&(this.complete=t.complete)}},next:function(){for(var t,n,a,o,f=500,v=0;;){if(v++>f)throw new Error("max tries have occured, rule may be impossible to forfill.");if(a=this.ruleDate,t=this._nextRecurrenceIter(this.last),!a&&!t){this.complete=!0;break}if((!a||t&&a.compare(t.last)>0)&&(a=t.last.clone(),t.next()),this.ruleDate===a&&this._nextRuleDay(),this.last=a,this.exDate&&(o=this.exDate.compare(this.last),o<0&&this._nextExDay(),o===0)){this._nextExDay();continue}return this.last}},toJSON:function(){function t(a){return a.toJSON()}var n=Object.create(null);return n.ruleIterators=this.ruleIterators.map(t),this.ruleDates&&(n.ruleDates=this.ruleDates.map(t)),this.exDates&&(n.exDates=this.exDates.map(t)),n.ruleDateInc=this.ruleDateInc,n.exDateInc=this.exDateInc,n.last=this.last.toJSON(),n.dtstart=this.dtstart.toJSON(),n.complete=this.complete,n},_extractDates:function(t,n){function a(m){c=s.helpers.binsearchInsert(o,m,r),o.splice(c,0,m)}for(var o=[],f=t.getAllProperties(n),v=f.length,l=0,d,c;l<v;l++)f[l].getValues().forEach(a);return o},_init:function(t){if(this.ruleIterators=[],this.last=this.dtstart.clone(),!e(t)){this.ruleDate=this.last.clone(),this.complete=!0;return}if(t.hasProperty("rdate")&&(this.ruleDates=this._extractDates(t,"rdate"),this.ruleDates[0]&&this.ruleDates[0].compare(this.dtstart)<0?(this.ruleDateInc=0,this.last=this.ruleDates[0].clone()):this.ruleDateInc=s.helpers.binsearchInsert(this.ruleDates,this.last,r),this.ruleDate=this.ruleDates[this.ruleDateInc]),t.hasProperty("rrule"))for(var n=t.getAllProperties("rrule"),a=0,o=n.length,f,v;a<o;a++)f=n[a].getFirstValue(),v=f.iterator(this.dtstart),this.ruleIterators.push(v),v.next();t.hasProperty("exdate")&&(this.exDates=this._extractDates(t,"exdate"),this.exDateInc=s.helpers.binsearchInsert(this.exDates,this.last,r),this.exDate=this.exDates[this.exDateInc])},_nextExDay:function(){this.exDate=this.exDates[++this.exDateInc]},_nextRuleDay:function(){this.ruleDate=this.ruleDates[++this.ruleDateInc]},_nextRecurrenceIter:function(){var t=this.ruleIterators;if(t.length===0)return null;for(var n=t.length,a,o,f=0,v;f<n;f++){if(a=t[f],o=a.last,a.completed){n--,f!==0&&f--,t.splice(f,1);continue}(!v||v.last.compare(o)>0)&&(v=a)}return v}},i}();s.Event=function(){function u(e,i){e instanceof s.Component||(i=e,e=null),e?this.component=e:this.component=new s.Component("vevent"),this._rangeExceptionCache=Object.create(null),this.exceptions=Object.create(null),this.rangeExceptions=[],i&&i.strictExceptions&&(this.strictExceptions=i.strictExceptions),i&&i.exceptions?i.exceptions.forEach(this.relateException,this):this.component.parent&&!this.isRecurrenceException()&&this.component.parent.getAllSubcomponents("vevent").forEach(function(t){t.hasProperty("recurrence-id")&&this.relateException(t)},this)}u.prototype={THISANDFUTURE:"THISANDFUTURE",exceptions:null,strictExceptions:!1,relateException:function(e){if(this.isRecurrenceException())throw new Error("cannot relate exception to exceptions");if(e instanceof s.Component&&(e=new s.Event(e)),this.strictExceptions&&e.uid!==this.uid)throw new Error("attempted to relate unrelated exception");var i=e.recurrenceId.toString();if(this.exceptions[i]=e,e.modifiesFuture()){var t=[e.recurrenceId.toUnixTime(),i],n=s.helpers.binsearchInsert(this.rangeExceptions,t,r);this.rangeExceptions.splice(n,0,t)}},modifiesFuture:function(){if(!this.component.hasProperty("recurrence-id"))return!1;var e=this.component.getFirstProperty("recurrence-id").getParameter("range");return e===this.THISANDFUTURE},findRangeException:function(e){if(!this.rangeExceptions.length)return null;var i=e.toUnixTime(),t=s.helpers.binsearchInsert(this.rangeExceptions,[i],r);if(t-=1,t<0)return null;var n=this.rangeExceptions[t];return i<n[0]?null:n[1]},getOccurrenceDetails:function(e){var i=e.toString(),t=e.convertToZone(s.Timezone.utcTimezone).toString(),n,a={recurrenceId:e};if(i in this.exceptions)n=a.item=this.exceptions[i],a.startDate=n.startDate,a.endDate=n.endDate,a.item=n;else if(t in this.exceptions)n=this.exceptions[t],a.startDate=n.startDate,a.endDate=n.endDate,a.item=n;else{var o=this.findRangeException(e),f;if(o){var v=this.exceptions[o];a.item=v;var l=this._rangeExceptionCache[o];if(!l){var d=v.recurrenceId.clone(),c=v.startDate.clone();d.zone=c.zone,l=c.subtractDate(d),this._rangeExceptionCache[o]=l}var m=e.clone();m.zone=v.startDate.zone,m.addDuration(l),f=m.clone(),f.addDuration(v.duration),a.startDate=m,a.endDate=f}else f=e.clone(),f.addDuration(this.duration),a.endDate=f,a.startDate=e,a.item=this}return a},iterator:function(e){return new s.RecurExpansion({component:this.component,dtstart:e||this.startDate})},isRecurring:function(){var e=this.component;return e.hasProperty("rrule")||e.hasProperty("rdate")},isRecurrenceException:function(){return this.component.hasProperty("recurrence-id")},getRecurrenceTypes:function(){for(var e=this.component.getAllProperties("rrule"),i=0,t=e.length,n=Object.create(null);i<t;i++){var a=e[i].getFirstValue();n[a.freq]=!0}return n},get uid(){return this._firstProp("uid")},set uid(e){this._setProp("uid",e)},get startDate(){return this._firstProp("dtstart")},set startDate(e){this._setTime("dtstart",e)},get endDate(){var e=this._firstProp("dtend");if(!e){var i=this._firstProp("duration");e=this.startDate.clone(),i?e.addDuration(i):e.isDate&&(e.day+=1)}return e},set endDate(e){this.component.hasProperty("duration")&&this.component.removeProperty("duration"),this._setTime("dtend",e)},get duration(){var e=this._firstProp("duration");return e||this.endDate.subtractDateTz(this.startDate)},set duration(e){this.component.hasProperty("dtend")&&this.component.removeProperty("dtend"),this._setProp("duration",e)},get location(){return this._firstProp("location")},set location(e){return this._setProp("location",e)},get attendees(){return this.component.getAllProperties("attendee")},get summary(){return this._firstProp("summary")},set summary(e){this._setProp("summary",e)},get description(){return this._firstProp("description")},set description(e){this._setProp("description",e)},get color(){return this._firstProp("color")},set color(e){this._setProp("color",e)},get organizer(){return this._firstProp("organizer")},set organizer(e){this._setProp("organizer",e)},get sequence(){return this._firstProp("sequence")},set sequence(e){this._setProp("sequence",e)},get recurrenceId(){return this._firstProp("recurrence-id")},set recurrenceId(e){this._setTime("recurrence-id",e)},_setTime:function(e,i){var t=this.component.getFirstProperty(e);t||(t=new s.Property(e),this.component.addProperty(t)),i.zone===s.Timezone.localTimezone||i.zone===s.Timezone.utcTimezone?t.removeParameter("tzid"):t.setParameter("tzid",i.zone.tzid),t.setValue(i)},_setProp:function(e,i){this.component.updatePropertyWithValue(e,i)},_firstProp:function(e){return this.component.getFirstPropertyValue(e)},toString:function(){return this.component.toString()}};function r(e,i){return e[0]>i[0]?1:i[0]>e[0]?-1:0}return u}();s.ComponentParser=function(){function u(r){typeof r=="undefined"&&(r={});var e;for(e in r)r.hasOwnProperty(e)&&(this[e]=r[e])}return u.prototype={parseEvent:!0,parseTimezone:!0,oncomplete:function(){},onerror:function(r){},ontimezone:function(r){},onevent:function(r){},process:function(r){typeof r=="string"&&(r=s.parse(r)),r instanceof s.Component||(r=new s.Component(r));for(var e=r.getAllSubcomponents(),i=0,t=e.length,n;i<t;i++)switch(n=e[i],n.name){case"vtimezone":if(this.parseTimezone){var a=n.getFirstPropertyValue("tzid");a&&this.ontimezone(new s.Timezone({tzid:a,component:n}))}break;case"vevent":this.parseEvent&&this.onevent(new s.Event(n));break;default:continue}this.oncomplete()}},u}()});var ve={};me(ve,{default:()=>G});module.exports=ye(ve);var ne=require("obsidian");var re=require("obsidian"),V=pe(te()),J=class{constructor(r){this.events=[];this.lastFetch=0;this.refreshMinutes=r}async fetchCalendars(r){let e=Date.now();if(this.events.length>0&&e-this.lastFetch<this.refreshMinutes*60*1e3)return this.events;let t=r.filter(n=>n.enabled).map(n=>this.fetchCalendar(n));try{let n=await Promise.all(t);return this.events=n.flat(),this.lastFetch=e,this.events}catch(n){throw console.error("Error fetching calendars:",n),n}}async fetchCalendar(r){try{let e=await(0,re.requestUrl)({url:r.url,method:"GET"}),i=(0,V.parse)(e.text);return new V.Component(i).getAllSubcomponents("vevent").map(a=>{let o=new V.Event(a);return{id:o.uid,title:o.summary,start:o.startDate.toJSDate(),end:o.endDate.toJSDate(),description:o.description,location:o.location,source:r.name}})}catch(e){return console.error(`Error fetching calendar ${r.name}:`,e),[]}}getEventsForDate(r){let e=r.toDateString();return this.events.filter(i=>i.start.toDateString()===e).sort((i,t)=>i.start.getTime()-t.start.getTime())}};var F=require("obsidian"),Z=class{constructor(r,e){this.app=r;this.settings=e}async createEventNote(r){let{vault:e}=this.app,{templatePath:i,noteLocation:t,noteTitleFormat:n}=this.settings,a=(0,F.normalizePath)(t),o=this.formatTitle(n,r),f=(0,F.normalizePath)(`${a}/${o}.md`),v=await this.getTemplate(i),l=this.populateTemplate(v,r);try{a!=="/"&&await this.ensureFolderExists(a);let d=e.getAbstractFileByPath(f);return d instanceof F.TFile?(await e.modify(d,l),d):await e.create(f,l)}catch(d){throw console.error("Error creating note:",d),d}}async getAllTemplatePaths(){return this.app.vault.getFiles().filter(e=>e.extension==="md").map(e=>e.path)}async getAllFolders(){let r=new Set(["/"]),e=i=>{r.add(i.path),i.children.forEach(t=>{t instanceof F.TFolder&&e(t)})};return this.app.vault.getAllLoadedFiles().forEach(i=>{i instanceof F.TFolder&&e(i)}),Array.from(r).sort((i,t)=>i.localeCompare(t))}async getTemplate(r){if(!r)return this.getDefaultTemplate();let{vault:e}=this.app,i=e.getAbstractFileByPath(r);return i instanceof F.TFile?await e.read(i):this.getDefaultTemplate()}cleanTeamsDescription(r){if(!r)return"";if(r.includes("Microsoft Teams meeting")||r.includes("________________________________________________________________________________")){let e="",i=r.match(/https:\/\/teams\.microsoft\.com\/l\/meetup-join\/[^\s\n]*/);i&&(e+=`[Join the meeting now](${i[0]})

`);let t=r.match(/Meeting ID:?\s*(\d[\d\s]+)/i);t&&(e+=`Meeting ID: ${t[1].trim()}
`);let n=r.match(/(?:Passcode|Password|Security code):?\s*([^\s\n]+)/i);n&&(e+=`Passcode: ${n[1].trim()}
`);let a=r.match(/(?:\+\d{1,}[\d\s\-()]+)(?=\n|$)/);if(a&&(e+=`
Dial in: ${a[0].trim()}`),e)return e.trim()}return r}getDefaultTemplate(){return["# {{title}}","","## Event Details","- Date: {{date}}","- Time: {{startTime}} - {{endTime}}","- Calendar: {{source}}","{{#if location}}- Location: {{location}}{{/if}}","","## Description","{{description}}","","## Notes",""].join(`
`)}formatTitle(r,e){let i=e.start.toISOString().split("T")[0];return r.replace(/{{event_title}}/g,this.sanitizeFileName(e.title)).replace(/{{date}}/g,i).replace(/{{source}}/g,this.sanitizeFileName(e.source))}populateTemplate(r,e){let i=e.start.toLocaleDateString(),t=e.start.toLocaleTimeString(),n=e.end.toLocaleTimeString(),a=this.cleanTeamsDescription(e.description||"");return r.replace(/{{title}}/g,e.title).replace(/{{date}}/g,i).replace(/{{startTime}}/g,t).replace(/{{endTime}}/g,n).replace(/{{description}}/g,a).replace(/{{location}}/g,e.location||"").replace(/{{source}}/g,e.source).replace(/{{#if location}}(.*?){{\/if}}/g,(o,f)=>e.location?f:"")}async ensureFolderExists(r){let{vault:e}=this.app,i=r.split("/").filter(n=>n.length),t="";for(let n of i){t=t?`${t}/${n}`:n;let a=e.getAbstractFileByPath(t);if(a){if(!(a instanceof F.TFolder))throw new Error(`Cannot create folder '${t}' because a file with that name already exists`)}else try{await e.createFolder(t)}catch(o){if(!o.message.includes("already exists"))throw o}}}sanitizeFileName(r){return r.replace(/[\\/:*?"<>|]/g,"-")}};var K=require("obsidian"),X=class extends K.ItemView{constructor(e,i){super(e);this.selectedDate=null;this.currentMonthDays=new Map;this.plugin=i,this.currentDate=new Date}getViewType(){return"memochron-calendar"}getDisplayText(){return"MemoChron Calendar"}getIcon(){return"calendar"}async onOpen(){let e=this.containerEl.children[1];e.empty();let t=e.createEl("div",{cls:"memochron-controls"}).createEl("div",{cls:"memochron-nav"}),n=t.createEl("button",{text:"\u2190"}),a=t.createEl("button",{text:"Today"}),o=t.createEl("button",{text:"\u2192"}),f=t.createEl("span",{cls:"memochron-title"});n.onclick=()=>this.navigate(-1),a.onclick=()=>this.goToday(),o.onclick=()=>this.navigate(1),this.calendar=e.createEl("div",{cls:"memochron-calendar"}),this.agenda=e.createEl("div",{cls:"memochron-agenda"}),await this.refreshEvents()}async navigate(e){this.currentDate.setMonth(this.currentDate.getMonth()+e),await this.refreshEvents()}async goToday(){let e=new Date;(this.currentDate.getMonth()!==e.getMonth()||this.currentDate.getFullYear()!==e.getFullYear())&&(this.currentDate=e,await this.refreshEvents()),this.selectDate(e)}async selectDate(e){if(this.selectedDate){let n=this.selectedDate.toDateString(),a=this.currentMonthDays.get(n);a&&a.removeClass("selected")}this.selectedDate=e;let i=e.toDateString(),t=this.currentMonthDays.get(i);t&&t.addClass("selected"),await this.showDayAgenda(e)}async refreshEvents(){await this.plugin.calendarService.fetchCalendars(this.plugin.settings.calendarUrls),this.renderMonth(),this.selectedDate&&this.showDayAgenda(this.selectedDate)}renderMonth(){this.calendar.empty(),this.currentMonthDays.clear();let e=this.currentDate.getFullYear(),i=this.currentDate.getMonth(),t=this.containerEl.querySelector(".memochron-title");t&&(t.textContent=new Date(e,i).toLocaleString("default",{month:"long",year:"numeric"}));let n=this.calendar.createEl("div",{cls:"memochron-calendar-grid"});["Su","Mo","Tu","We","Th","Fr","Sa"].forEach(c=>{n.createEl("div",{cls:"memochron-weekday",text:c})});let o=new Date(e,i,1),v=new Date(e,i+1,0).getDate();for(let c=0;c<o.getDay();c++)n.createEl("div",{cls:"memochron-day empty"});let d=new Date().toDateString();for(let c=1;c<=v;c++){let m=new Date(e,i,c),y=m.toDateString(),p=n.createEl("div",{cls:"memochron-day"});this.currentMonthDays.set(y,p),this.selectedDate&&y===this.selectedDate.toDateString()&&p.addClass("selected"),y===d&&p.addClass("today");let _=p.createEl("div",{cls:"memochron-day-header",text:String(c)});if(this.plugin.calendarService.getEventsForDate(m).length>0){p.addClass("has-events");let E=p.createEl("div",{cls:"memochron-event-dot",text:"\u2022"})}p.onclick=()=>this.selectDate(m)}}async showDayAgenda(e){this.agenda.empty();let i=this.agenda.createEl("h3",{text:e.toLocaleDateString("default",{weekday:"long",month:"long",day:"numeric"})}),t=this.plugin.calendarService.getEventsForDate(e);if(t.length===0){this.agenda.createEl("p",{text:"No events scheduled"});return}let n=this.agenda.createEl("div",{cls:"memochron-agenda-list"});t.forEach(a=>{let o=n.createEl("div",{cls:"memochron-agenda-event"});if(o.createEl("div",{cls:"memochron-event-time",text:`${a.start.toLocaleTimeString([],{timeStyle:"short"})} - ${a.end.toLocaleTimeString([],{timeStyle:"short"})}`}),o.createEl("div",{cls:"memochron-event-title",text:a.title}),a.location){let f=a.location.startsWith("http://")||a.location.startsWith("https://")||a.location.startsWith("www."),v=a.location.toLowerCase().includes("zoom")||a.location.toLowerCase().includes("meet.")||a.location.toLowerCase().includes("teams")||a.location.toLowerCase().includes("webex"),l=f?"\u{1F517}":v?"\u{1F4BB}":"\u{1F4CD}";o.createEl("div",{cls:"memochron-event-location",text:`${l} ${a.location}`})}o.addEventListener("click",async f=>{f.stopPropagation();try{await this.showEventDetails(a)}catch(v){console.error("Failed to create note:",v),new K.Notice("Failed to create note. Check the console for details.")}})})}async showEventDetails(e){try{if(!this.plugin.settings.noteLocation){new K.Notice("Please set a note location in settings first");return}let i=await this.plugin.noteService.createEventNote(e);if(!i)throw new Error("Failed to create or update note");let t=this.app.workspace.getLeaf("tab");t?await t.openFile(i):new K.Notice("Could not open the note in a new tab")}catch(i){throw console.error("Error showing event details:",i),i}}};var U=require("obsidian"),$=class extends U.PluginSettingTab{constructor(e,i){super(e,i);this.plugin=i}display(){let{containerEl:e}=this;e.empty(),e.createEl("h2",{text:"MemoChron Settings"}),new U.Setting(e).setName("Calendar Sources").setDesc("Add and manage your iCalendar URLs").addButton(l=>l.setButtonText("Add Calendar").onClick(async()=>{this.plugin.settings.calendarUrls.push({url:"",name:"New Calendar",enabled:!0}),await this.plugin.saveSettings(),this.display()}));let i=e.createEl("div",{cls:"memochron-calendar-list"});this.plugin.settings.calendarUrls.forEach((l,d)=>{let c=new U.Setting(i).addText(m=>m.setPlaceholder("Calendar URL").setValue(l.url).onChange(async y=>{this.plugin.settings.calendarUrls[d].url=y,await this.plugin.saveSettings()})).addText(m=>m.setPlaceholder("Calendar name").setValue(l.name).onChange(async y=>{this.plugin.settings.calendarUrls[d].name=y,await this.plugin.saveSettings()})).addToggle(m=>m.setValue(l.enabled).onChange(async y=>{this.plugin.settings.calendarUrls[d].enabled=y,await this.plugin.saveSettings(),await this.plugin.refreshCalendarView()})).addButton(m=>m.setButtonText("Remove").onClick(async()=>{this.plugin.settings.calendarUrls.splice(d,1),await this.plugin.saveSettings(),await this.plugin.refreshCalendarView(),this.display()}))}),e.createEl("h3",{text:"Note Settings"});let t=new U.Setting(e).setName("Template File").setDesc("Path to the template file for new event notes"),n=new U.TextComponent(t.controlEl);n.setPlaceholder("templates/event-template.md").setValue(this.plugin.settings.templatePath);let a=t.controlEl.createDiv({cls:"suggestion-container"});a.style.display="none",this.setupPathSuggestions(n,a,async()=>await this.plugin.noteService.getAllTemplatePaths(),async l=>{this.plugin.settings.templatePath=l,await this.plugin.saveSettings()});let o=new U.Setting(e).setName("Note Location").setDesc("Where to save new event notes"),f=new U.TextComponent(o.controlEl);f.setPlaceholder("calendar-notes/").setValue(this.plugin.settings.noteLocation);let v=o.controlEl.createDiv({cls:"suggestion-container"});v.style.display="none",this.setupPathSuggestions(f,v,async()=>await this.plugin.noteService.getAllFolders(),async l=>{this.plugin.settings.noteLocation=l,await this.plugin.saveSettings()}),new U.Setting(e).setName("Note Title Format").setDesc("Format for new note titles. Available variables: {{event_title}}, {{date}}, {{source}}").addText(l=>l.setPlaceholder("{{event_title}} - {{date}}").setValue(this.plugin.settings.noteTitleFormat).onChange(async d=>{this.plugin.settings.noteTitleFormat=d,await this.plugin.saveSettings()})),e.createEl("h3",{text:"View Settings"}),new U.Setting(e).setName("Default View").setDesc("Choose the default calendar view").addDropdown(l=>l.addOption("month","Month").addOption("week","Week").setValue(this.plugin.settings.defaultView).onChange(async d=>{this.plugin.settings.defaultView=d,await this.plugin.saveSettings(),await this.plugin.refreshCalendarView()})),new U.Setting(e).setName("Refresh Interval").setDesc("How often to refresh calendar data (in minutes)").addText(l=>l.setValue(String(this.plugin.settings.refreshInterval)).onChange(async d=>{let c=parseInt(d);!isNaN(c)&&c>0&&(this.plugin.settings.refreshInterval=c,await this.plugin.saveSettings())}))}setupPathSuggestions(e,i,t,n){e.inputEl.addEventListener("focus",async()=>{let a=await t();this.showSuggestions(e,i,a,e.getValue(),n)}),e.inputEl.addEventListener("input",async()=>{let a=await t();this.showSuggestions(e,i,a,e.getValue(),n)}),e.inputEl.addEventListener("blur",()=>{setTimeout(()=>{i.style.display="none"},200)})}showSuggestions(e,i,t,n,a){i.empty();let o=t.filter(v=>v.toLowerCase().includes(n.toLowerCase()));if(o.length===0){i.style.display="none";return}i.style.display="block";let f=i.createEl("ul",{cls:"suggestion-list"});o.slice(0,5).forEach(v=>{f.createEl("li",{text:v}).addEventListener("mousedown",async d=>{d.preventDefault(),e.setValue(v),await a(v),i.style.display="none"})})}};var ie={calendarUrls:[],templatePath:"",noteLocation:"/",noteTitleFormat:"{{date}} - {{event_title}}",refreshInterval:30,defaultView:"month"};var G=class extends ne.Plugin{async onload(){await this.loadSettings(),this.calendarService=new J(this.settings.refreshInterval),this.noteService=new Z(this.app,this.settings),this.registerView("memochron-calendar",e=>this.calendarView=new X(e,this)),this.addSettingTab(new $(this.app,this)),this.app.workspace.onLayoutReady(()=>{this.activateView()}),this.setupAutoRefresh()}onunload(){this.refreshTimer&&window.clearInterval(this.refreshTimer)}async loadSettings(){this.settings=Object.assign({},ie,await this.loadData())}async saveSettings(){await this.saveData(this.settings),this.calendarService&&this.setupAutoRefresh()}async activateView(){if(this.app.workspace.getLeavesOfType("memochron-calendar").length===0){let i=this.app.workspace.getRightLeaf(!1);i&&await i.setViewState({type:"memochron-calendar",active:!0})}await this.refreshCalendarView()}async refreshCalendarView(){this.calendarView&&await this.calendarView.refreshEvents()}setupAutoRefresh(){this.refreshTimer&&window.clearInterval(this.refreshTimer),this.refreshTimer=window.setInterval(()=>this.refreshCalendarView(),this.settings.refreshInterval*60*1e3)}};
