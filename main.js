/*
THIS IS A GENERATED/BUNDLED FILE BY ESBUILD
if you want to view the source, please visit the github repository of this plugin
*/

var ut=Object.create;var q=Object.defineProperty;var lt=Object.getOwnPropertyDescriptor;var ht=Object.getOwnPropertyNames;var ct=Object.getPrototypeOf,ft=Object.prototype.hasOwnProperty;var dt=(u,e)=>()=>(e||u((e={exports:{}}).exports,e),e.exports),mt=(u,e)=>{for(var t in e)q(u,t,{get:e[t],enumerable:!0})},et=(u,e,t,i)=>{if(e&&typeof e=="object"||typeof e=="function")for(let r of ht(e))!ft.call(u,r)&&r!==t&&q(u,r,{get:()=>e[r],enumerable:!(i=lt(e,r))||i.enumerable});return u};var pt=(u,e,t)=>(t=u!=null?ut(ct(u)):{},et(e||!u||!u.__esModule?q(t,"default",{value:u,enumerable:!0}):t,u)),yt=u=>et(q({},"__esModule",{value:!0}),u);var rt=dt((Tt,tt)=>{var s;(function(){typeof tt=="object"?s=tt.exports:typeof HTMLScriptElement!="undefined"&&"noModule"in HTMLScriptElement.prototype?window.ICAL=s={}:typeof s!="object"&&(s={})})();s.foldLength=75;s.newLineChar=`\r
`;s.helpers={updateTimezones:function(u){var e,t,i,r,n,a;if(!u||u.name!=="vcalendar")return u;for(e=u.getAllSubcomponents(),t=[],i={},n=0;n<e.length;n++)e[n].name==="vtimezone"?(a=e[n].getFirstProperty("tzid").getFirstValue(),i[a]=e[n]):t=t.concat(e[n].getAllProperties());for(r={},n=0;n<t.length;n++)(a=t[n].getParameter("tzid"))&&(r[a]=!0);for(n in i)i.hasOwnProperty(n)&&!r[n]&&u.removeSubcomponent(i[n]);for(n in r)r.hasOwnProperty(n)&&!i[n]&&s.TimezoneService.has(n)&&u.addSubcomponent(s.TimezoneService.get(n).component);return u},isStrictlyNaN:function(u){return typeof u=="number"&&isNaN(u)},strictParseInt:function(u){var e=parseInt(u,10);if(s.helpers.isStrictlyNaN(e))throw new Error('Could not extract integer from "'+u+'"');return e},formatClassType:function(e,t){if(typeof e!="undefined")return e instanceof t?e:new t(e)},unescapedIndexOf:function(u,e,t){for(;(t=u.indexOf(e,t))!==-1;)if(t>0&&u[t-1]==="\\")t+=1;else return t;return-1},binsearchInsert:function(u,e,t){if(!u.length)return 0;for(var i=0,r=u.length-1,n,a;i<=r;)if(n=i+Math.floor((r-i)/2),a=t(e,u[n]),a<0)r=n-1;else if(a>0)i=n+1;else break;return a<0?n:a>0?n+1:n},dumpn:function(){s.debug&&(typeof console!="undefined"&&"log"in console?s.helpers.dumpn=function(e){console.log(e)}:s.helpers.dumpn=function(e){dump(e+`
`)},s.helpers.dumpn(arguments[0]))},clone:function(u,e){if(!u||typeof u!="object")return u;if(u instanceof Date)return new Date(u.getTime());if("clone"in u)return u.clone();if(Array.isArray(u)){for(var t=[],i=0;i<u.length;i++)t.push(e?s.helpers.clone(u[i],!0):u[i]);return t}else{var r={};for(var n in u)Object.prototype.hasOwnProperty.call(u,n)&&(e?r[n]=s.helpers.clone(u[n],!0):r[n]=u[n]);return r}},foldline:function(e){for(var t="",i=e||"",r=0,n=0;i.length;){var a=i.codePointAt(r);a<128?++n:a<2048?n+=2:a<65536?n+=3:n+=4,n<s.foldLength+1?r+=a>65535?2:1:(t+=s.newLineChar+" "+i.substring(0,r),i=i.substring(r),r=n=0)}return t.substr(s.newLineChar.length+1)},pad2:function(e){typeof e!="string"&&(typeof e=="number"&&(e=parseInt(e)),e=String(e));var t=e.length;switch(t){case 0:return"00";case 1:return"0"+e;default:return e}},trunc:function(e){return e<0?Math.ceil(e):Math.floor(e)},inherits:function(u,e,t){function i(){}i.prototype=u.prototype,e.prototype=new i,t&&s.helpers.extend(t,e.prototype)},extend:function(u,e){for(var t in u){var i=Object.getOwnPropertyDescriptor(u,t);i&&!Object.getOwnPropertyDescriptor(e,t)&&Object.defineProperty(e,t,i)}return e}};s.design=function(){"use strict";var u=/\\\\|\\;|\\,|\\[Nn]/g,e=/\\|;|,|\n/g,t=/\\\\|\\,|\\[Nn]/g,i=/\\|,|\n/g;function r(h,T){var A={matches:/.*/,fromICAL:function(E,R){return g(E,h,R)},toICAL:function(E,R){var M=T;return R&&(M=new RegExp(M.source+"|"+R)),E.replace(M,function(F){switch(F){case"\\":return"\\\\";case";":return"\\;";case",":return"\\,";case`
`:return"\\n";default:return F}})}};return A}var n={defaultType:"text"},a={defaultType:"text",multiValue:","},o={defaultType:"text",structuredValue:";"},l={defaultType:"integer"},m={defaultType:"date-time",allowedTypes:["date-time","date"]},c={defaultType:"date-time"},d={defaultType:"uri"},f={defaultType:"utc-offset"},p={defaultType:"recur"},v={defaultType:"date-and-or-time",allowedTypes:["date-time","date","text"]};function y(h){switch(h){case"\\\\":return"\\";case"\\;":return";";case"\\,":return",";case"\\n":case"\\N":return`
`;default:return h}}function g(h,T,A){return h.indexOf("\\")===-1?h:(A&&(T=new RegExp(T.source+"|\\\\"+A)),h.replace(T,y))}var w={categories:a,url:d,version:n,uid:n},_={boolean:{values:["TRUE","FALSE"],fromICAL:function(h){switch(h){case"TRUE":return!0;case"FALSE":return!1;default:return!1}},toICAL:function(h){return h?"TRUE":"FALSE"}},float:{matches:/^[+-]?\d+\.\d+$/,fromICAL:function(h){var T=parseFloat(h);return s.helpers.isStrictlyNaN(T)?0:T},toICAL:function(h){return String(h)}},integer:{fromICAL:function(h){var T=parseInt(h);return s.helpers.isStrictlyNaN(T)?0:T},toICAL:function(h){return String(h)}},"utc-offset":{toICAL:function(h){return h.length<7?h.substr(0,3)+h.substr(4,2):h.substr(0,3)+h.substr(4,2)+h.substr(7,2)},fromICAL:function(h){return h.length<6?h.substr(0,3)+":"+h.substr(3,2):h.substr(0,3)+":"+h.substr(3,2)+":"+h.substr(5,2)},decorate:function(h){return s.UtcOffset.fromString(h)},undecorate:function(h){return h.toString()}}},O={cutype:{values:["INDIVIDUAL","GROUP","RESOURCE","ROOM","UNKNOWN"],allowXName:!0,allowIanaToken:!0},"delegated-from":{valueType:"cal-address",multiValue:",",multiValueSeparateDQuote:!0},"delegated-to":{valueType:"cal-address",multiValue:",",multiValueSeparateDQuote:!0},encoding:{values:["8BIT","BASE64"]},fbtype:{values:["FREE","BUSY","BUSY-UNAVAILABLE","BUSY-TENTATIVE"],allowXName:!0,allowIanaToken:!0},member:{valueType:"cal-address",multiValue:",",multiValueSeparateDQuote:!0},partstat:{values:["NEEDS-ACTION","ACCEPTED","DECLINED","TENTATIVE","DELEGATED","COMPLETED","IN-PROCESS"],allowXName:!0,allowIanaToken:!0},range:{values:["THISANDFUTURE"]},related:{values:["START","END"]},reltype:{values:["PARENT","CHILD","SIBLING"],allowXName:!0,allowIanaToken:!0},role:{values:["REQ-PARTICIPANT","CHAIR","OPT-PARTICIPANT","NON-PARTICIPANT"],allowXName:!0,allowIanaToken:!0},rsvp:{values:["TRUE","FALSE"]},"sent-by":{valueType:"cal-address"},tzid:{matches:/^\//},value:{values:["binary","boolean","cal-address","date","date-time","duration","float","integer","period","recur","text","time","uri","utc-offset"],allowXName:!0,allowIanaToken:!0}},D=s.helpers.extend(_,{text:r(u,e),uri:{},binary:{decorate:function(h){return s.Binary.fromString(h)},undecorate:function(h){return h.toString()}},"cal-address":{},date:{decorate:function(h,T){return L.strict?s.Time.fromDateString(h,T):s.Time.fromString(h,T)},undecorate:function(h){return h.toString()},fromICAL:function(h){return!L.strict&&h.length>=15?D["date-time"].fromICAL(h):h.substr(0,4)+"-"+h.substr(4,2)+"-"+h.substr(6,2)},toICAL:function(h){var T=h.length;return T==10?h.substr(0,4)+h.substr(5,2)+h.substr(8,2):T>=19?D["date-time"].toICAL(h):h}},"date-time":{fromICAL:function(h){if(!L.strict&&h.length==8)return D.date.fromICAL(h);var T=h.substr(0,4)+"-"+h.substr(4,2)+"-"+h.substr(6,2)+"T"+h.substr(9,2)+":"+h.substr(11,2)+":"+h.substr(13,2);return h[15]&&h[15]==="Z"&&(T+="Z"),T},toICAL:function(h){var T=h.length;if(T==10&&!L.strict)return D.date.toICAL(h);if(T>=19){var A=h.substr(0,4)+h.substr(5,2)+h.substr(8,5)+h.substr(14,2)+h.substr(17,2);return h[19]&&h[19]==="Z"&&(A+="Z"),A}else return h},decorate:function(h,T){return L.strict?s.Time.fromDateTimeString(h,T):s.Time.fromString(h,T)},undecorate:function(h){return h.toString()}},duration:{decorate:function(h){return s.Duration.fromString(h)},undecorate:function(h){return h.toString()}},period:{fromICAL:function(h){var T=h.split("/");return T[0]=D["date-time"].fromICAL(T[0]),s.Duration.isValueString(T[1])||(T[1]=D["date-time"].fromICAL(T[1])),T},toICAL:function(h){return!L.strict&&h[0].length==10?h[0]=D.date.toICAL(h[0]):h[0]=D["date-time"].toICAL(h[0]),s.Duration.isValueString(h[1])||(!L.strict&&h[1].length==10?h[1]=D.date.toICAL(h[1]):h[1]=D["date-time"].toICAL(h[1])),h.join("/")},decorate:function(h,T){return s.Period.fromJSON(h,T,!L.strict)},undecorate:function(h){return h.toJSON()}},recur:{fromICAL:function(h){return s.Recur._stringToData(h,!0)},toICAL:function(h){var T="";for(var A in h)if(Object.prototype.hasOwnProperty.call(h,A)){var E=h[A];A=="until"?E.length>10?E=D["date-time"].toICAL(E):E=D.date.toICAL(E):A=="wkst"?typeof E=="number"&&(E=s.Recur.numericDayToIcalDay(E)):Array.isArray(E)&&(E=E.join(",")),T+=A.toUpperCase()+"="+E+";"}return T.substr(0,T.length-1)},decorate:function(T){return s.Recur.fromData(T)},undecorate:function(h){return h.toJSON()}},time:{fromICAL:function(h){if(h.length<6)return h;var T=h.substr(0,2)+":"+h.substr(2,2)+":"+h.substr(4,2);return h[6]==="Z"&&(T+="Z"),T},toICAL:function(h){if(h.length<8)return h;var T=h.substr(0,2)+h.substr(3,2)+h.substr(6,2);return h[8]==="Z"&&(T+="Z"),T}}}),Y=s.helpers.extend(w,{action:n,attach:{defaultType:"uri"},attendee:{defaultType:"cal-address"},calscale:n,class:n,comment:n,completed:c,contact:n,created:c,description:n,dtend:m,dtstamp:c,dtstart:m,due:m,duration:{defaultType:"duration"},exdate:{defaultType:"date-time",allowedTypes:["date-time","date"],multiValue:","},exrule:p,freebusy:{defaultType:"period",multiValue:","},geo:{defaultType:"float",structuredValue:";"},"last-modified":c,location:n,method:n,organizer:{defaultType:"cal-address"},"percent-complete":l,priority:l,prodid:n,"related-to":n,repeat:l,rdate:{defaultType:"date-time",allowedTypes:["date-time","date","period"],multiValue:",",detectType:function(h){return h.indexOf("/")!==-1?"period":h.indexOf("T")===-1?"date":"date-time"}},"recurrence-id":m,resources:a,"request-status":o,rrule:p,sequence:l,status:n,summary:n,transp:n,trigger:{defaultType:"duration",allowedTypes:["duration","date-time"]},tzoffsetfrom:f,tzoffsetto:f,tzurl:d,tzid:n,tzname:n}),b=s.helpers.extend(_,{text:r(t,i),uri:r(t,i),date:{decorate:function(h){return s.VCardTime.fromDateAndOrTimeString(h,"date")},undecorate:function(h){return h.toString()},fromICAL:function(h){return h.length==8?D.date.fromICAL(h):h[0]=="-"&&h.length==6?h.substr(0,4)+"-"+h.substr(4):h},toICAL:function(h){return h.length==10?D.date.toICAL(h):h[0]=="-"&&h.length==7?h.substr(0,4)+h.substr(5):h}},time:{decorate:function(h){return s.VCardTime.fromDateAndOrTimeString("T"+h,"time")},undecorate:function(h){return h.toString()},fromICAL:function(h){var T=b.time._splitZone(h,!0),A=T[0],E=T[1];return E.length==6?E=E.substr(0,2)+":"+E.substr(2,2)+":"+E.substr(4,2):E.length==4&&E[0]!="-"?E=E.substr(0,2)+":"+E.substr(2,2):E.length==5&&(E=E.substr(0,3)+":"+E.substr(3,2)),A.length==5&&(A[0]=="-"||A[0]=="+")&&(A=A.substr(0,3)+":"+A.substr(3)),E+A},toICAL:function(h){var T=b.time._splitZone(h),A=T[0],E=T[1];return E.length==8?E=E.substr(0,2)+E.substr(3,2)+E.substr(6,2):E.length==5&&E[0]!="-"?E=E.substr(0,2)+E.substr(3,2):E.length==6&&(E=E.substr(0,3)+E.substr(4,2)),A.length==6&&(A[0]=="-"||A[0]=="+")&&(A=A.substr(0,3)+A.substr(4)),E+A},_splitZone:function(h,T){var A=h.length-1,E=h.length-(T?5:6),R=h[E],M,F;return h[A]=="Z"?(M=h[A],F=h.substr(0,A)):h.length>6&&(R=="-"||R=="+")?(M=h.substr(E),F=h.substr(0,E)):(M="",F=h),[M,F]}},"date-time":{decorate:function(h){return s.VCardTime.fromDateAndOrTimeString(h,"date-time")},undecorate:function(h){return h.toString()},fromICAL:function(h){return b["date-and-or-time"].fromICAL(h)},toICAL:function(h){return b["date-and-or-time"].toICAL(h)}},"date-and-or-time":{decorate:function(h){return s.VCardTime.fromDateAndOrTimeString(h,"date-and-or-time")},undecorate:function(h){return h.toString()},fromICAL:function(h){var T=h.split("T");return(T[0]?b.date.fromICAL(T[0]):"")+(T[1]?"T"+b.time.fromICAL(T[1]):"")},toICAL:function(h){var T=h.split("T");return b.date.toICAL(T[0])+(T[1]?"T"+b.time.toICAL(T[1]):"")}},timestamp:D["date-time"],"language-tag":{matches:/^[a-zA-Z0-9-]+$/}}),S={type:{valueType:"text",multiValue:","},value:{values:["text","uri","date","time","date-time","date-and-or-time","timestamp","boolean","integer","float","utc-offset","language-tag"],allowXName:!0,allowIanaToken:!0}},N=s.helpers.extend(w,{adr:{defaultType:"text",structuredValue:";",multiValue:","},anniversary:v,bday:v,caladruri:d,caluri:d,clientpidmap:o,email:n,fburl:d,fn:n,gender:o,geo:d,impp:d,key:d,kind:n,lang:{defaultType:"language-tag"},logo:d,member:d,n:{defaultType:"text",structuredValue:";",multiValue:","},nickname:a,note:n,org:{defaultType:"text",structuredValue:";"},photo:d,related:d,rev:{defaultType:"timestamp"},role:n,sound:d,source:d,tel:{defaultType:"uri",allowedTypes:["uri","text"]},title:n,tz:{defaultType:"text",allowedTypes:["text","utc-offset","uri"]},xml:n}),P=s.helpers.extend(_,{binary:D.binary,date:b.date,"date-time":b["date-time"],"phone-number":{},uri:D.uri,text:D.text,time:D.time,vcard:D.text,"utc-offset":{toICAL:function(h){return h.substr(0,7)},fromICAL:function(h){return h.substr(0,7)},decorate:function(h){return s.UtcOffset.fromString(h)},undecorate:function(h){return h.toString()}}}),x={type:{valueType:"text",multiValue:","},value:{values:["text","uri","date","date-time","phone-number","time","boolean","integer","float","utc-offset","vcard","binary"],allowXName:!0,allowIanaToken:!0}},B=s.helpers.extend(w,{fn:n,n:{defaultType:"text",structuredValue:";",multiValue:","},nickname:a,photo:{defaultType:"binary",allowedTypes:["binary","uri"]},bday:{defaultType:"date-time",allowedTypes:["date-time","date"],detectType:function(h){return h.indexOf("T")===-1?"date":"date-time"}},adr:{defaultType:"text",structuredValue:";",multiValue:","},label:n,tel:{defaultType:"phone-number"},email:n,mailer:n,tz:{defaultType:"utc-offset",allowedTypes:["utc-offset","text"]},geo:{defaultType:"float",structuredValue:";"},title:n,role:n,logo:{defaultType:"binary",allowedTypes:["binary","uri"]},agent:{defaultType:"vcard",allowedTypes:["vcard","text","uri"]},org:o,note:a,prodid:n,rev:{defaultType:"date-time",allowedTypes:["date-time","date"],detectType:function(h){return h.indexOf("T")===-1?"date":"date-time"}},"sort-string":n,sound:{defaultType:"binary",allowedTypes:["binary","uri"]},class:n,key:{defaultType:"binary",allowedTypes:["binary","text"]}}),I={value:D,param:O,property:Y},U={value:b,param:S,property:N},C={value:P,param:x,property:B},L={strict:!0,defaultSet:I,defaultType:"unknown",components:{vcard:U,vcard3:C,vevent:I,vtodo:I,vjournal:I,valarm:I,vtimezone:I,daylight:I,standard:I},icalendar:I,vcard:U,vcard3:C,getDesignSet:function(h){var T=h&&h in L.components;return T?L.components[h]:L.defaultSet}};return L}();s.stringify=function(){"use strict";var u=`\r
`,e="unknown",t=s.design,i=s.helpers;function r(a){typeof a[0]=="string"&&(a=[a]);for(var o=0,l=a.length,m="";o<l;o++)m+=r.component(a[o])+u;return m}r.component=function(a,o){var l=a[0].toUpperCase(),m="BEGIN:"+l+u,c=a[1],d=0,f=c.length,p=a[0];for(p==="vcard"&&a[1].length>0&&!(a[1][0][0]==="version"&&a[1][0][3]==="4.0")&&(p="vcard3"),o=o||t.getDesignSet(p);d<f;d++)m+=r.property(c[d],o)+u;for(var v=a[2]||[],y=0,g=v.length;y<g;y++)m+=r.component(v[y],o)+u;return m+="END:"+l,m},r.property=function(a,o,l){var m=a[0].toUpperCase(),c=a[0],d=a[1],f=m,p;for(p in d){var v=d[p];if(d.hasOwnProperty(p)){var w=p in o.param&&o.param[p].multiValue;w&&Array.isArray(v)?(o.param[p].multiValueSeparateDQuote&&(w='"'+w+'"'),v=v.map(r._rfc6868Unescape),v=r.multiValue(v,w,"unknown",null,o)):v=r._rfc6868Unescape(v),f+=";"+p.toUpperCase(),f+="="+r.propertyValue(v)}}if(a.length===3)return f+":";var y=a[2];o||(o=t.defaultSet);var g,w=!1,_=!1,O=!1;return c in o.property?(g=o.property[c],"multiValue"in g&&(w=g.multiValue),"structuredValue"in g&&Array.isArray(a[3])&&(_=g.structuredValue),"defaultType"in g?y===g.defaultType&&(O=!0):y===e&&(O=!0)):y===e&&(O=!0),O||(f+=";VALUE="+y.toUpperCase()),f+=":",w&&_?f+=r.multiValue(a[3],_,y,w,o,_):w?f+=r.multiValue(a.slice(3),w,y,null,o,!1):_?f+=r.multiValue(a[3],_,y,null,o,_):f+=r.value(a[3],y,o,!1),l?f:s.helpers.foldline(f)},r.propertyValue=function(a){return i.unescapedIndexOf(a,",")===-1&&i.unescapedIndexOf(a,":")===-1&&i.unescapedIndexOf(a,";")===-1?a:'"'+a+'"'},r.multiValue=function(a,o,l,m,c,d){for(var f="",p=a.length,v=0;v<p;v++)m&&Array.isArray(a[v])?f+=r.multiValue(a[v],m,l,null,c,d):f+=r.value(a[v],l,c,d),v!==p-1&&(f+=o);return f},r.value=function(a,o,l,m){return o in l.value&&"toICAL"in l.value[o]?l.value[o].toICAL(a,m):a},r._rfc6868Unescape=function(a){return a.replace(/[\n^"]/g,function(o){return n[o]})};var n={'"':"^'","\n":"^n","^":"^^"};return r}();s.parse=function(){"use strict";var u=/[^ \t]/,e=",",t=":",i=";",r="=",n="unknown",a="text",o=s.design,l=s.helpers;function m(f){this.message=f,this.name="ParserError";try{throw new Error}catch(v){if(v.stack){var p=v.stack.split(`
`);p.shift(),this.stack=p.join(`
`)}}}m.prototype=Error.prototype;function c(f){var p={},v=p.component=[];if(p.stack=[v],c._eachLine(f,function(y,g){c._handleContentLine(g,p)}),p.stack.length>1)throw new m("invalid ical body. component began but did not end");return p=null,v.length==1?v[0]:v}c.property=function(f,p){var v={component:[[],[]],designSet:p||o.defaultSet};return c._handleContentLine(f,v),v.component[1][0]},c.component=function(f){return c(f)},c.ParserError=m,c._handleContentLine=function(f,p){var v=f.indexOf(t),y=f.indexOf(i),g,w,_,O,D={};y!==-1&&v!==-1&&y>v&&(y=-1);var Y;if(y!==-1){if(_=f.substring(0,y).toLowerCase(),Y=c._parseParameters(f.substring(y),0,p.designSet),Y[2]==-1)throw new m("Invalid parameters in '"+f+"'");if(D=Y[0],g=Y[1].length+Y[2]+y,(w=f.substring(g).indexOf(t))!==-1)O=f.substring(g+w+1);else throw new m("Missing parameter value in '"+f+"'")}else if(v!==-1){if(_=f.substring(0,v).toLowerCase(),O=f.substring(v+1),_==="begin"){var b=[O.toLowerCase(),[],[]];p.stack.length===1?p.component.push(b):p.component[2].push(b),p.stack.push(p.component),p.component=b,p.designSet||(p.designSet=o.getDesignSet(p.component[0]));return}else if(_==="end"){p.component=p.stack.pop();return}}else throw new m('invalid line (no token ";" or ":") "'+f+'"');var S,N=!1,P=!1,x;_ in p.designSet.property&&(x=p.designSet.property[_],"multiValue"in x&&(N=x.multiValue),"structuredValue"in x&&(P=x.structuredValue),O&&"detectType"in x&&(S=x.detectType(O))),S||("value"in D?S=D.value.toLowerCase():x?S=x.defaultType:S=n),delete D.value;var B;N&&P?(O=c._parseMultiValue(O,P,S,[],N,p.designSet,P),B=[_,D,S,O]):N?(B=[_,D,S],c._parseMultiValue(O,N,S,B,null,p.designSet,!1)):P?(O=c._parseMultiValue(O,P,S,[],null,p.designSet,P),B=[_,D,S,O]):(O=c._parseValue(O,S,p.designSet,!1),B=[_,D,S,O]),p.component[0]==="vcard"&&p.component[1].length===0&&!(_==="version"&&O==="4.0")&&(p.designSet=o.getDesignSet("vcard3")),p.component[1].push(B)},c._parseValue=function(f,p,v,y){return p in v.value&&"fromICAL"in v.value[p]?v.value[p].fromICAL(f,y):f},c._parseParameters=function(f,p,v){for(var y=p,g=0,w=r,_={},O,D,Y,b=-1,S,N,P;g!==!1&&(g=l.unescapedIndexOf(f,w,g+1))!==-1;){if(O=f.substr(y+1,g-y-1),O.length==0)throw new m("Empty parameter name in '"+f+"'");D=O.toLowerCase(),P=!1,N=!1,D in v.param&&v.param[D].valueType?S=v.param[D].valueType:S=a,D in v.param&&(N=v.param[D].multiValue,v.param[D].multiValueSeparateDQuote&&(P=c._rfc6868Escape('"'+N+'"')));var x=f[g+1];if(x==='"'){if(b=g+2,g=l.unescapedIndexOf(f,'"',b),N&&g!=-1)for(var B=!0;B;)f[g+1]==N&&f[g+2]=='"'?g=l.unescapedIndexOf(f,'"',g+3):B=!1;if(g===-1)throw new m('invalid line (no matching double quote) "'+f+'"');Y=f.substr(b,g-b),y=l.unescapedIndexOf(f,i,g),y===-1&&(g=!1)}else{b=g+1;var I=l.unescapedIndexOf(f,i,b),U=l.unescapedIndexOf(f,t,b);U!==-1&&I>U?(I=U,g=!1):I===-1?(U===-1?I=f.length:I=U,g=!1):(y=I,g=I),Y=f.substr(b,I-b)}if(Y=c._rfc6868Escape(Y),N){var C=P||N;Y=c._parseMultiValue(Y,C,S,[],null,v)}else Y=c._parseValue(Y,S,v);N&&D in _?Array.isArray(_[D])?_[D].push(Y):_[D]=[_[D],Y]:_[D]=Y}return[_,Y,b]},c._rfc6868Escape=function(f){return f.replace(/\^['n^]/g,function(p){return d[p]})};var d={"^'":'"',"^n":`
`,"^^":"^"};return c._parseMultiValue=function(f,p,v,y,g,w,_){var O=0,D=0,Y;if(p.length===0)return f;for(;(O=l.unescapedIndexOf(f,p,D))!==-1;)Y=f.substr(D,O-D),g?Y=c._parseMultiValue(Y,g,v,[],null,w,_):Y=c._parseValue(Y,v,w,_),y.push(Y),D=O+p.length;return Y=f.substr(D),g?Y=c._parseMultiValue(Y,g,v,[],null,w,_):Y=c._parseValue(Y,v,w,_),y.push(Y),y.length==1?y[0]:y},c._eachLine=function(f,p){var v=f.length,y=f.search(u),g=y,w,_,O;do g=f.indexOf(`
`,y)+1,g>1&&f[g-2]==="\r"?O=2:O=1,g===0&&(g=v,O=0),_=f[y],_===" "||_==="	"?w+=f.substr(y+1,g-y-(O+1)):(w&&p(null,w),w=f.substr(y,g-y-O)),y=g;while(g!==v);w=w.trim(),w.length&&p(null,w)},c}();s.Component=function(){"use strict";var u=1,e=2,t=0;function i(r,n){typeof r=="string"&&(r=[r,[],[]]),this.jCal=r,this.parent=n||null}return i.prototype={_hydratedPropertyCount:0,_hydratedComponentCount:0,get name(){return this.jCal[t]},get _designSet(){var r=this.parent&&this.parent._designSet;return r||s.design.getDesignSet(this.name)},_hydrateComponent:function(r){if(this._components||(this._components=[],this._hydratedComponentCount=0),this._components[r])return this._components[r];var n=new i(this.jCal[e][r],this);return this._hydratedComponentCount++,this._components[r]=n},_hydrateProperty:function(r){if(this._properties||(this._properties=[],this._hydratedPropertyCount=0),this._properties[r])return this._properties[r];var n=new s.Property(this.jCal[u][r],this);return this._hydratedPropertyCount++,this._properties[r]=n},getFirstSubcomponent:function(r){if(r){for(var n=0,a=this.jCal[e],o=a.length;n<o;n++)if(a[n][t]===r){var l=this._hydrateComponent(n);return l}}else if(this.jCal[e].length)return this._hydrateComponent(0);return null},getAllSubcomponents:function(r){var n=this.jCal[e].length,a=0;if(r){for(var o=this.jCal[e],l=[];a<n;a++)r===o[a][t]&&l.push(this._hydrateComponent(a));return l}else{if(!this._components||this._hydratedComponentCount!==n)for(;a<n;a++)this._hydrateComponent(a);return this._components||[]}},hasProperty:function(r){for(var n=this.jCal[u],a=n.length,o=0;o<a;o++)if(n[o][t]===r)return!0;return!1},getFirstProperty:function(r){if(r){for(var n=0,a=this.jCal[u],o=a.length;n<o;n++)if(a[n][t]===r){var l=this._hydrateProperty(n);return l}}else if(this.jCal[u].length)return this._hydrateProperty(0);return null},getFirstPropertyValue:function(r){var n=this.getFirstProperty(r);return n?n.getFirstValue():null},getAllProperties:function(r){var n=this.jCal[u].length,a=0;if(r){for(var o=this.jCal[u],l=[];a<n;a++)r===o[a][t]&&l.push(this._hydrateProperty(a));return l}else{if(!this._properties||this._hydratedPropertyCount!==n)for(;a<n;a++)this._hydrateProperty(a);return this._properties||[]}},_removeObjectByIndex:function(r,n,a){if(n=n||[],n[a]){var o=n[a];"parent"in o&&(o.parent=null)}n.splice(a,1),this.jCal[r].splice(a,1)},_removeObject:function(r,n,a){var o=0,l=this.jCal[r],m=l.length,c=this[n];if(typeof a=="string"){for(;o<m;o++)if(l[o][t]===a)return this._removeObjectByIndex(r,c,o),!0}else if(c){for(;o<m;o++)if(c[o]&&c[o]===a)return this._removeObjectByIndex(r,c,o),!0}return!1},_removeAllObjects:function(r,n,a){for(var o=this[n],l=this.jCal[r],m=l.length-1;m>=0;m--)(!a||l[m][t]===a)&&this._removeObjectByIndex(r,o,m)},addSubcomponent:function(r){this._components||(this._components=[],this._hydratedComponentCount=0),r.parent&&r.parent.removeSubcomponent(r);var n=this.jCal[e].push(r.jCal);return this._components[n-1]=r,this._hydratedComponentCount++,r.parent=this,r},removeSubcomponent:function(r){var n=this._removeObject(e,"_components",r);return n&&this._hydratedComponentCount--,n},removeAllSubcomponents:function(r){var n=this._removeAllObjects(e,"_components",r);return this._hydratedComponentCount=0,n},addProperty:function(r){if(!(r instanceof s.Property))throw new TypeError("must instance of ICAL.Property");this._properties||(this._properties=[],this._hydratedPropertyCount=0),r.parent&&r.parent.removeProperty(r);var n=this.jCal[u].push(r.jCal);return this._properties[n-1]=r,this._hydratedPropertyCount++,r.parent=this,r},addPropertyWithValue:function(r,n){var a=new s.Property(r);return a.setValue(n),this.addProperty(a),a},updatePropertyWithValue:function(r,n){var a=this.getFirstProperty(r);return a?a.setValue(n):a=this.addPropertyWithValue(r,n),a},removeProperty:function(r){var n=this._removeObject(u,"_properties",r);return n&&this._hydratedPropertyCount--,n},removeAllProperties:function(r){var n=this._removeAllObjects(u,"_properties",r);return this._hydratedPropertyCount=0,n},toJSON:function(){return this.jCal},toString:function(){return s.stringify.component(this.jCal,this._designSet)}},i.fromString=function(r){return new i(s.parse.component(r))},i}();s.Property=function(){"use strict";var u=0,e=1,t=2,i=3,r=s.design;function n(a,o){this._parent=o||null,typeof a=="string"?(this.jCal=[a,{},r.defaultType],this.jCal[t]=this.getDefaultType()):this.jCal=a,this._updateType()}return n.prototype={get type(){return this.jCal[t]},get name(){return this.jCal[u]},get parent(){return this._parent},set parent(a){var o=!this._parent||a&&a._designSet!=this._parent._designSet;return this._parent=a,this.type==r.defaultType&&o&&(this.jCal[t]=this.getDefaultType(),this._updateType()),a},get _designSet(){return this.parent?this.parent._designSet:r.defaultSet},_updateType:function(){var a=this._designSet;if(this.type in a.value){var o=a.value[this.type];"decorate"in a.value[this.type]?this.isDecorated=!0:this.isDecorated=!1,this.name in a.property&&(this.isMultiValue="multiValue"in a.property[this.name],this.isStructuredValue="structuredValue"in a.property[this.name])}},_hydrateValue:function(a){return this._values&&this._values[a]?this._values[a]:this.jCal.length<=i+a?null:this.isDecorated?(this._values||(this._values=[]),this._values[a]=this._decorate(this.jCal[i+a])):this.jCal[i+a]},_decorate:function(a){return this._designSet.value[this.type].decorate(a,this)},_undecorate:function(a){return this._designSet.value[this.type].undecorate(a,this)},_setDecoratedValue:function(a,o){this._values||(this._values=[]),typeof a=="object"&&"icaltype"in a?(this.jCal[i+o]=this._undecorate(a),this._values[o]=a):(this.jCal[i+o]=a,this._values[o]=this._decorate(a))},getParameter:function(a){if(a in this.jCal[e])return this.jCal[e][a]},getFirstParameter:function(a){var o=this.getParameter(a);return Array.isArray(o)?o[0]:o},setParameter:function(a,o){var l=a.toLowerCase();typeof o=="string"&&l in this._designSet.param&&"multiValue"in this._designSet.param[l]&&(o=[o]),this.jCal[e][a]=o},removeParameter:function(a){delete this.jCal[e][a]},getDefaultType:function(){var a=this.jCal[u],o=this._designSet;if(a in o.property){var l=o.property[a];if("defaultType"in l)return l.defaultType}return r.defaultType},resetType:function(a){this.removeAllValues(),this.jCal[t]=a,this._updateType()},getFirstValue:function(){return this._hydrateValue(0)},getValues:function(){var a=this.jCal.length-i;if(a<1)return[];for(var o=0,l=[];o<a;o++)l[o]=this._hydrateValue(o);return l},removeAllValues:function(){this._values&&(this._values.length=0),this.jCal.length=3},setValues:function(a){if(!this.isMultiValue)throw new Error(this.name+`: does not not support mulitValue.
override isMultiValue`);var o=a.length,l=0;if(this.removeAllValues(),o>0&&typeof a[0]=="object"&&"icaltype"in a[0]&&this.resetType(a[0].icaltype),this.isDecorated)for(;l<o;l++)this._setDecoratedValue(a[l],l);else for(;l<o;l++)this.jCal[i+l]=a[l]},setValue:function(a){this.removeAllValues(),typeof a=="object"&&"icaltype"in a&&this.resetType(a.icaltype),this.isDecorated?this._setDecoratedValue(a,0):this.jCal[i]=a},toJSON:function(){return this.jCal},toICALString:function(){return s.stringify.property(this.jCal,this._designSet,!0)}},n.fromString=function(a,o){return new n(s.parse.property(a,o))},n}();s.UtcOffset=function(){function u(e){this.fromData(e)}return u.prototype={hours:0,minutes:0,factor:1,icaltype:"utc-offset",clone:function(){return s.UtcOffset.fromSeconds(this.toSeconds())},fromData:function(e){if(e)for(var t in e)e.hasOwnProperty(t)&&(this[t]=e[t]);this._normalize()},fromSeconds:function(e){var t=Math.abs(e);return this.factor=e<0?-1:1,this.hours=s.helpers.trunc(t/3600),t-=this.hours*3600,this.minutes=s.helpers.trunc(t/60),this},toSeconds:function(){return this.factor*(60*this.minutes+3600*this.hours)},compare:function(t){var i=this.toSeconds(),r=t.toSeconds();return(i>r)-(r>i)},_normalize:function(){for(var e=this.toSeconds(),t=this.factor;e<-43200;)e+=97200;for(;e>50400;)e-=97200;this.fromSeconds(e),e==0&&(this.factor=t)},toICALString:function(){return s.design.icalendar.value["utc-offset"].toICAL(this.toString())},toString:function(){return(this.factor==1?"+":"-")+s.helpers.pad2(this.hours)+":"+s.helpers.pad2(this.minutes)}},u.fromString=function(e){var t={};return t.factor=e[0]==="+"?1:-1,t.hours=s.helpers.strictParseInt(e.substr(1,2)),t.minutes=s.helpers.strictParseInt(e.substr(4,2)),new s.UtcOffset(t)},u.fromSeconds=function(e){var t=new u;return t.fromSeconds(e),t},u}();s.Binary=function(){function u(e){this.value=e}return u.prototype={icaltype:"binary",decodeValue:function(){return this._b64_decode(this.value)},setEncodedValue:function(t){this.value=this._b64_encode(t)},_b64_encode:function(t){var i="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",r,n,a,o,l,m,c,d,f=0,p=0,v="",y=[];if(!t)return t;do r=t.charCodeAt(f++),n=t.charCodeAt(f++),a=t.charCodeAt(f++),d=r<<16|n<<8|a,o=d>>18&63,l=d>>12&63,m=d>>6&63,c=d&63,y[p++]=i.charAt(o)+i.charAt(l)+i.charAt(m)+i.charAt(c);while(f<t.length);v=y.join("");var g=t.length%3;return(g?v.slice(0,g-3):v)+"===".slice(g||3)},_b64_decode:function(t){var i="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",r,n,a,o,l,m,c,d,f=0,p=0,v="",y=[];if(!t)return t;t+="";do o=i.indexOf(t.charAt(f++)),l=i.indexOf(t.charAt(f++)),m=i.indexOf(t.charAt(f++)),c=i.indexOf(t.charAt(f++)),d=o<<18|l<<12|m<<6|c,r=d>>16&255,n=d>>8&255,a=d&255,m==64?y[p++]=String.fromCharCode(r):c==64?y[p++]=String.fromCharCode(r,n):y[p++]=String.fromCharCode(r,n,a);while(f<t.length);return v=y.join(""),v},toString:function(){return this.value}},u.fromString=function(e){return new u(e)},u}();(function(){s.Period=function(e){if(this.wrappedJSObject=this,e&&"start"in e){if(e.start&&!(e.start instanceof s.Time))throw new TypeError(".start must be an instance of ICAL.Time");this.start=e.start}if(e&&e.end&&e.duration)throw new Error("cannot accept both end and duration");if(e&&"end"in e){if(e.end&&!(e.end instanceof s.Time))throw new TypeError(".end must be an instance of ICAL.Time");this.end=e.end}if(e&&"duration"in e){if(e.duration&&!(e.duration instanceof s.Duration))throw new TypeError(".duration must be an instance of ICAL.Duration");this.duration=e.duration}},s.Period.prototype={start:null,end:null,duration:null,icalclass:"icalperiod",icaltype:"period",clone:function(){return s.Period.fromData({start:this.start?this.start.clone():null,end:this.end?this.end.clone():null,duration:this.duration?this.duration.clone():null})},getDuration:function(){return this.duration?this.duration:this.end.subtractDate(this.start)},getEnd:function(){if(this.end)return this.end;var u=this.start.clone();return u.addDuration(this.duration),u},toString:function(){return this.start+"/"+(this.end||this.duration)},toJSON:function(){return[this.start.toString(),(this.end||this.duration).toString()]},toICALString:function(){return this.start.toICALString()+"/"+(this.end||this.duration).toICALString()}},s.Period.fromString=function(e,t){var i=e.split("/");if(i.length!==2)throw new Error('Invalid string value: "'+e+'" must contain a "/" char.');var r={start:s.Time.fromDateTimeString(i[0],t)},n=i[1];return s.Duration.isValueString(n)?r.duration=s.Duration.fromString(n):r.end=s.Time.fromDateTimeString(n,t),new s.Period(r)},s.Period.fromData=function(e){return new s.Period(e)},s.Period.fromJSON=function(u,e,t){function i(r,n){return t?s.Time.fromString(r,n):s.Time.fromDateTimeString(r,n)}return s.Duration.isValueString(u[1])?s.Period.fromData({start:i(u[0],e),duration:s.Duration.fromString(u[1])}):s.Period.fromData({start:i(u[0],e),end:i(u[1],e)})}})();(function(){var u=/([PDWHMTS]{1,1})/;s.Duration=function(i){this.wrappedJSObject=this,this.fromData(i)},s.Duration.prototype={weeks:0,days:0,hours:0,minutes:0,seconds:0,isNegative:!1,icalclass:"icalduration",icaltype:"duration",clone:function(){return s.Duration.fromData(this)},toSeconds:function(){var i=this.seconds+60*this.minutes+3600*this.hours+86400*this.days+604800*this.weeks;return this.isNegative?-i:i},fromSeconds:function(i){var r=Math.abs(i);return this.isNegative=i<0,this.days=s.helpers.trunc(r/86400),this.days%7==0?(this.weeks=this.days/7,this.days=0):this.weeks=0,r-=(this.days+7*this.weeks)*86400,this.hours=s.helpers.trunc(r/3600),r-=this.hours*3600,this.minutes=s.helpers.trunc(r/60),r-=this.minutes*60,this.seconds=r,this},fromData:function(i){var r=["weeks","days","hours","minutes","seconds","isNegative"];for(var n in r)if(r.hasOwnProperty(n)){var a=r[n];i&&a in i?this[a]=i[a]:this[a]=0}},reset:function(){this.isNegative=!1,this.weeks=0,this.days=0,this.hours=0,this.minutes=0,this.seconds=0},compare:function(i){var r=this.toSeconds(),n=i.toSeconds();return(r>n)-(r<n)},normalize:function(){this.fromSeconds(this.toSeconds())},toString:function(){if(this.toSeconds()==0)return"PT0S";var i="";return this.isNegative&&(i+="-"),i+="P",this.weeks&&(i+=this.weeks+"W"),this.days&&(i+=this.days+"D"),(this.hours||this.minutes||this.seconds)&&(i+="T",this.hours&&(i+=this.hours+"H"),this.minutes&&(i+=this.minutes+"M"),this.seconds&&(i+=this.seconds+"S")),i},toICALString:function(){return this.toString()}},s.Duration.fromSeconds=function(i){return new s.Duration().fromSeconds(i)};function e(t,i,r){var n;switch(t){case"P":i&&i==="-"?r.isNegative=!0:r.isNegative=!1;break;case"D":n="days";break;case"W":n="weeks";break;case"H":n="hours";break;case"M":n="minutes";break;case"S":n="seconds";break;default:return 0}if(n){if(!i&&i!==0)throw new Error('invalid duration value: Missing number before "'+t+'"');var a=parseInt(i,10);if(s.helpers.isStrictlyNaN(a))throw new Error('invalid duration value: Invalid number "'+i+'" before "'+t+'"');r[n]=a}return 1}s.Duration.isValueString=function(t){return t[0]==="P"||t[1]==="P"},s.Duration.fromString=function(i){for(var r=0,n=Object.create(null),a=0;(r=i.search(u))!==-1;){var o=i[r],l=i.substr(0,r);i=i.substr(r+1),a+=e(o,l,n)}if(a<2)throw new Error('invalid duration value: Not enough duration components in "'+i+'"');return new s.Duration(n)},s.Duration.fromData=function(i){return new s.Duration(i)}})();(function(){var u=["tzid","location","tznames","latitude","longitude"];s.Timezone=function(t){this.wrappedJSObject=this,this.fromData(t)},s.Timezone.prototype={tzid:"",location:"",tznames:"",latitude:0,longitude:0,component:null,expandedUntilYear:0,icalclass:"icaltimezone",fromData:function(t){if(this.expandedUntilYear=0,this.changes=[],t instanceof s.Component)this.component=t;else{if(t&&"component"in t)if(typeof t.component=="string"){var i=s.parse(t.component);this.component=new s.Component(i)}else t.component instanceof s.Component?this.component=t.component:this.component=null;for(var r in u)if(u.hasOwnProperty(r)){var n=u[r];t&&n in t&&(this[n]=t[n])}}return this.component instanceof s.Component&&!this.tzid&&(this.tzid=this.component.getFirstPropertyValue("tzid")),this},utcOffset:function(t){if(this==s.Timezone.utcTimezone||this==s.Timezone.localTimezone||(this._ensureCoverage(t.year),!this.changes.length))return 0;for(var i={year:t.year,month:t.month,day:t.day,hour:t.hour,minute:t.minute,second:t.second},r=this._findNearbyChange(i),n=-1,a=1;;){var o=s.helpers.clone(this.changes[r],!0);o.utcOffset<o.prevUtcOffset?s.Timezone.adjust_change(o,0,0,0,o.utcOffset):s.Timezone.adjust_change(o,0,0,0,o.prevUtcOffset);var l=s.Timezone._compare_change_fn(i,o);if(l>=0?n=r:a=-1,a==-1&&n!=-1)break;if(r+=a,r<0)return 0;if(r>=this.changes.length)break}var m=this.changes[n],c=m.utcOffset-m.prevUtcOffset;if(c<0&&n>0){var d=s.helpers.clone(m,!0);if(s.Timezone.adjust_change(d,0,0,0,d.prevUtcOffset),s.Timezone._compare_change_fn(i,d)<0){var f=this.changes[n-1],p=!1;m.is_daylight!=p&&f.is_daylight==p&&(m=f)}}return m.utcOffset},_findNearbyChange:function(t){var i=s.helpers.binsearchInsert(this.changes,t,s.Timezone._compare_change_fn);return i>=this.changes.length?this.changes.length-1:i},_ensureCoverage:function(e){if(s.Timezone._minimumExpansionYear==-1){var t=s.Time.now();s.Timezone._minimumExpansionYear=t.year}var i=e;if(i<s.Timezone._minimumExpansionYear&&(i=s.Timezone._minimumExpansionYear),i+=s.Timezone.EXTRA_COVERAGE,i>s.Timezone.MAX_YEAR&&(i=s.Timezone.MAX_YEAR),!this.changes.length||this.expandedUntilYear<e){for(var r=this.component.getAllSubcomponents(),n=r.length,a=0;a<n;a++)this._expandComponent(r[a],i,this.changes);this.changes.sort(s.Timezone._compare_change_fn),this.expandedUntilYear=i}},_expandComponent:function(e,t,i){if(!e.hasProperty("dtstart")||!e.hasProperty("tzoffsetto")||!e.hasProperty("tzoffsetfrom"))return null;var r=e.getFirstProperty("dtstart").getFirstValue(),n;function a(y){return y.factor*(y.hours*3600+y.minutes*60)}function o(){var y={};return y.is_daylight=e.name=="daylight",y.utcOffset=a(e.getFirstProperty("tzoffsetto").getFirstValue()),y.prevUtcOffset=a(e.getFirstProperty("tzoffsetfrom").getFirstValue()),y}if(!e.hasProperty("rrule")&&!e.hasProperty("rdate"))n=o(),n.year=r.year,n.month=r.month,n.day=r.day,n.hour=r.hour,n.minute=r.minute,n.second=r.second,s.Timezone.adjust_change(n,0,0,0,-n.prevUtcOffset),i.push(n);else{var l=e.getAllProperties("rdate");for(var m in l)if(l.hasOwnProperty(m)){var c=l[m],d=c.getFirstValue();n=o(),n.year=d.year,n.month=d.month,n.day=d.day,d.isDate?(n.hour=r.hour,n.minute=r.minute,n.second=r.second,r.zone!=s.Timezone.utcTimezone&&s.Timezone.adjust_change(n,0,0,0,-n.prevUtcOffset)):(n.hour=d.hour,n.minute=d.minute,n.second=d.second,d.zone!=s.Timezone.utcTimezone&&s.Timezone.adjust_change(n,0,0,0,-n.prevUtcOffset)),i.push(n)}var f=e.getFirstProperty("rrule");if(f){f=f.getFirstValue(),n=o(),f.until&&f.until.zone==s.Timezone.utcTimezone&&(f.until.adjust(0,0,0,n.prevUtcOffset),f.until.zone=s.Timezone.localTimezone);for(var p=f.iterator(r),v;(v=p.next())&&(n=o(),!(v.year>t||!v));)n.year=v.year,n.month=v.month,n.day=v.day,n.hour=v.hour,n.minute=v.minute,n.second=v.second,n.isDate=v.isDate,s.Timezone.adjust_change(n,0,0,0,-n.prevUtcOffset),i.push(n)}}return i},toString:function(){return this.tznames?this.tznames:this.tzid}},s.Timezone._compare_change_fn=function(t,i){return t.year<i.year?-1:t.year>i.year?1:t.month<i.month?-1:t.month>i.month?1:t.day<i.day?-1:t.day>i.day?1:t.hour<i.hour?-1:t.hour>i.hour?1:t.minute<i.minute?-1:t.minute>i.minute?1:t.second<i.second?-1:t.second>i.second?1:0},s.Timezone.convert_time=function(t,i,r){if(t.isDate||i.tzid==r.tzid||i==s.Timezone.localTimezone||r==s.Timezone.localTimezone)return t.zone=r,t;var n=i.utcOffset(t);return t.adjust(0,0,0,-n),n=r.utcOffset(t),t.adjust(0,0,0,n),null},s.Timezone.fromData=function(t){var i=new s.Timezone;return i.fromData(t)},s.Timezone.utcTimezone=s.Timezone.fromData({tzid:"UTC"}),s.Timezone.localTimezone=s.Timezone.fromData({tzid:"floating"}),s.Timezone.adjust_change=function(t,i,r,n,a){return s.Time.prototype.adjust.call(t,i,r,n,a,t)},s.Timezone._minimumExpansionYear=-1,s.Timezone.MAX_YEAR=2035,s.Timezone.EXTRA_COVERAGE=5})();s.TimezoneService=function(){var u,e={get count(){return Object.keys(u).length},reset:function(){u=Object.create(null);var t=s.Timezone.utcTimezone;u.Z=t,u.UTC=t,u.GMT=t},has:function(t){return!!u[t]},get:function(t){return u[t]},register:function(t,i){if(t instanceof s.Component&&t.name==="vtimezone"&&(i=new s.Timezone(t),t=i.tzid),i instanceof s.Timezone)u[t]=i;else throw new TypeError("timezone must be ICAL.Timezone or ICAL.Component")},remove:function(t){return delete u[t]}};return e.reset(),e}();(function(){s.Time=function(e,t){this.wrappedJSObject=this;var i=this._time=Object.create(null);i.year=0,i.month=1,i.day=1,i.hour=0,i.minute=0,i.second=0,i.isDate=!1,this.fromData(e,t)},s.Time._dowCache={},s.Time._wnCache={},s.Time.prototype={icalclass:"icaltime",_cachedUnixTime:null,get icaltype(){return this.isDate?"date":"date-time"},zone:null,_pendingNormalization:!1,clone:function(){return new s.Time(this._time,this.zone)},reset:function(){this.fromData(s.Time.epochTime),this.zone=s.Timezone.utcTimezone},resetTo:function(e,t,i,r,n,a,o){this.fromData({year:e,month:t,day:i,hour:r,minute:n,second:a,zone:o})},fromJSDate:function(e,t){return e?t?(this.zone=s.Timezone.utcTimezone,this.year=e.getUTCFullYear(),this.month=e.getUTCMonth()+1,this.day=e.getUTCDate(),this.hour=e.getUTCHours(),this.minute=e.getUTCMinutes(),this.second=e.getUTCSeconds()):(this.zone=s.Timezone.localTimezone,this.year=e.getFullYear(),this.month=e.getMonth()+1,this.day=e.getDate(),this.hour=e.getHours(),this.minute=e.getMinutes(),this.second=e.getSeconds()):this.reset(),this._cachedUnixTime=null,this},fromData:function(e,t){if(e){for(var i in e)if(Object.prototype.hasOwnProperty.call(e,i)){if(i==="icaltype")continue;this[i]=e[i]}}if(t&&(this.zone=t),e&&!("isDate"in e)?this.isDate=!("hour"in e):e&&"isDate"in e&&(this.isDate=e.isDate),e&&"timezone"in e){var r=s.TimezoneService.get(e.timezone);this.zone=r||s.Timezone.localTimezone}return e&&"zone"in e&&(this.zone=e.zone),this.zone||(this.zone=s.Timezone.localTimezone),this._cachedUnixTime=null,this},dayOfWeek:function(e){var t=e||s.Time.SUNDAY,i=(this.year<<12)+(this.month<<8)+(this.day<<3)+t;if(i in s.Time._dowCache)return s.Time._dowCache[i];var r=this.day,n=this.month+(this.month<3?12:0),a=this.year-(this.month<3?1:0),o=r+a+s.helpers.trunc((n+1)*26/10)+s.helpers.trunc(a/4);return o+=s.helpers.trunc(a/100)*6+s.helpers.trunc(a/400),o=(o+7-t)%7+1,s.Time._dowCache[i]=o,o},dayOfYear:function(){var e=s.Time.isLeapYear(this.year)?1:0,t=s.Time.daysInYearPassedMonth;return t[e][this.month-1]+this.day},startOfWeek:function(e){var t=e||s.Time.SUNDAY,i=this.clone();return i.day-=(this.dayOfWeek()+7-t)%7,i.isDate=!0,i.hour=0,i.minute=0,i.second=0,i},endOfWeek:function(e){var t=e||s.Time.SUNDAY,i=this.clone();return i.day+=(7-this.dayOfWeek()+t-s.Time.SUNDAY)%7,i.isDate=!0,i.hour=0,i.minute=0,i.second=0,i},startOfMonth:function(){var e=this.clone();return e.day=1,e.isDate=!0,e.hour=0,e.minute=0,e.second=0,e},endOfMonth:function(){var e=this.clone();return e.day=s.Time.daysInMonth(e.month,e.year),e.isDate=!0,e.hour=0,e.minute=0,e.second=0,e},startOfYear:function(){var e=this.clone();return e.day=1,e.month=1,e.isDate=!0,e.hour=0,e.minute=0,e.second=0,e},endOfYear:function(){var e=this.clone();return e.day=31,e.month=12,e.isDate=!0,e.hour=0,e.minute=0,e.second=0,e},startDoyWeek:function(e){var t=e||s.Time.SUNDAY,i=this.dayOfWeek()-t;return i<0&&(i+=7),this.dayOfYear()-i},getDominicalLetter:function(){return s.Time.getDominicalLetter(this.year)},nthWeekDay:function(e,t){var i=s.Time.daysInMonth(this.month,this.year),r,n=t,a=0,o=this.clone();if(n>=0){o.day=1,n!=0&&n--,a=o.day;var l=o.dayOfWeek(),m=e-l;m<0&&(m+=7),a+=m,a-=e,r=e}else{o.day=i;var c=o.dayOfWeek();n++,r=c-e,r<0&&(r+=7),r=i-r}return r+=n*7,a+r},isNthWeekDay:function(u,e){var t=this.dayOfWeek();if(e===0&&t===u)return!0;var i=this.nthWeekDay(u,e);return i===this.day},weekNumber:function(e){var t=(this.year<<12)+(this.month<<8)+(this.day<<3)+e;if(t in s.Time._wnCache)return s.Time._wnCache[t];var i,r=this.clone();r.isDate=!0;var n=this.year;r.month==12&&r.day>25?(i=s.Time.weekOneStarts(n+1,e),r.compare(i)<0?i=s.Time.weekOneStarts(n,e):n++):(i=s.Time.weekOneStarts(n,e),r.compare(i)<0&&(i=s.Time.weekOneStarts(--n,e)));var a=r.subtractDate(i).toSeconds()/86400,o=s.helpers.trunc(a/7)+1;return s.Time._wnCache[t]=o,o},addDuration:function(e){var t=e.isNegative?-1:1,i=this.second,r=this.minute,n=this.hour,a=this.day;i+=t*e.seconds,r+=t*e.minutes,n+=t*e.hours,a+=t*e.days,a+=t*7*e.weeks,this.second=i,this.minute=r,this.hour=n,this.day=a,this._cachedUnixTime=null},subtractDate:function(e){var t=this.toUnixTime()+this.utcOffset(),i=e.toUnixTime()+e.utcOffset();return s.Duration.fromSeconds(t-i)},subtractDateTz:function(e){var t=this.toUnixTime(),i=e.toUnixTime();return s.Duration.fromSeconds(t-i)},compare:function(e){var t=this.toUnixTime(),i=e.toUnixTime();return t>i?1:i>t?-1:0},compareDateOnlyTz:function(e,t){function i(o){return s.Time._cmp_attr(r,n,o)}var r=this.convertToZone(t),n=e.convertToZone(t),a=0;return(a=i("year"))!=0||(a=i("month"))!=0||(a=i("day"))!=0,a},convertToZone:function(e){var t=this.clone(),i=this.zone.tzid==e.tzid;return!this.isDate&&!i&&s.Timezone.convert_time(t,this.zone,e),t.zone=e,t},utcOffset:function(){return this.zone==s.Timezone.localTimezone||this.zone==s.Timezone.utcTimezone?0:this.zone.utcOffset(this)},toICALString:function(){var u=this.toString();return u.length>10?s.design.icalendar.value["date-time"].toICAL(u):s.design.icalendar.value.date.toICAL(u)},toString:function(){var e=this.year+"-"+s.helpers.pad2(this.month)+"-"+s.helpers.pad2(this.day);return this.isDate||(e+="T"+s.helpers.pad2(this.hour)+":"+s.helpers.pad2(this.minute)+":"+s.helpers.pad2(this.second),this.zone===s.Timezone.utcTimezone&&(e+="Z")),e},toJSDate:function(){return this.zone==s.Timezone.localTimezone?this.isDate?new Date(this.year,this.month-1,this.day):new Date(this.year,this.month-1,this.day,this.hour,this.minute,this.second,0):new Date(this.toUnixTime()*1e3)},_normalize:function(){var e=this._time.isDate;return this._time.isDate&&(this._time.hour=0,this._time.minute=0,this._time.second=0),this.adjust(0,0,0,0),this},adjust:function(e,t,i,r,n){var a,o,l=0,m=0,c,d,f,p,v,y=n||this._time;if(y.isDate||(c=y.second+r,y.second=c%60,a=s.helpers.trunc(c/60),y.second<0&&(y.second+=60,a--),d=y.minute+i+a,y.minute=d%60,o=s.helpers.trunc(d/60),y.minute<0&&(y.minute+=60,o--),f=y.hour+t+o,y.hour=f%24,l=s.helpers.trunc(f/24),y.hour<0&&(y.hour+=24,l--)),y.month>12?m=s.helpers.trunc((y.month-1)/12):y.month<1&&(m=s.helpers.trunc(y.month/12)-1),y.year+=m,y.month-=12*m,p=y.day+e+l,p>0)for(;v=s.Time.daysInMonth(y.month,y.year),!(p<=v);)y.month++,y.month>12&&(y.year++,y.month=1),p-=v;else for(;p<=0;)y.month==1?(y.year--,y.month=12):y.month--,p+=s.Time.daysInMonth(y.month,y.year);return y.day=p,this._cachedUnixTime=null,this},fromUnixTime:function(e){this.zone=s.Timezone.utcTimezone;var t=s.Time.epochTime.clone();t.adjust(0,0,0,e),this.year=t.year,this.month=t.month,this.day=t.day,this.hour=t.hour,this.minute=t.minute,this.second=Math.floor(t.second),this._cachedUnixTime=null},toUnixTime:function(){if(this._cachedUnixTime!==null)return this._cachedUnixTime;var e=this.utcOffset(),t=Date.UTC(this.year,this.month-1,this.day,this.hour,this.minute,this.second-e);return this._cachedUnixTime=t/1e3,this._cachedUnixTime},toJSON:function(){for(var u=["year","month","day","hour","minute","second","isDate"],e=Object.create(null),t=0,i=u.length,r;t<i;t++)r=u[t],e[r]=this[r];return this.zone&&(e.timezone=this.zone.tzid),e}},function(){function e(t){Object.defineProperty(s.Time.prototype,t,{get:function(){return this._pendingNormalization&&(this._normalize(),this._pendingNormalization=!1),this._time[t]},set:function(r){return t==="isDate"&&r&&!this._time.isDate&&this.adjust(0,0,0,0),this._cachedUnixTime=null,this._pendingNormalization=!0,this._time[t]=r,r}})}"defineProperty"in Object&&(e("year"),e("month"),e("day"),e("hour"),e("minute"),e("second"),e("isDate"))}(),s.Time.daysInMonth=function(e,t){var i=[0,31,28,31,30,31,30,31,31,30,31,30,31],r=30;return e<1||e>12||(r=i[e],e==2&&(r+=s.Time.isLeapYear(t))),r},s.Time.isLeapYear=function(e){return e<=1752?e%4==0:e%4==0&&e%100!=0||e%400==0},s.Time.fromDayOfYear=function(e,t){var i=t,r=e,n=new s.Time;n.auto_normalize=!1;var a=s.Time.isLeapYear(i)?1:0;if(r<1)return i--,a=s.Time.isLeapYear(i)?1:0,r+=s.Time.daysInYearPassedMonth[a][12],s.Time.fromDayOfYear(r,i);if(r>s.Time.daysInYearPassedMonth[a][12])return a=s.Time.isLeapYear(i)?1:0,r-=s.Time.daysInYearPassedMonth[a][12],i++,s.Time.fromDayOfYear(r,i);n.year=i,n.isDate=!0;for(var o=11;o>=0;o--)if(r>s.Time.daysInYearPassedMonth[a][o]){n.month=o+1,n.day=r-s.Time.daysInYearPassedMonth[a][o];break}return n.auto_normalize=!0,n},s.Time.fromStringv2=function(e){return new s.Time({year:parseInt(e.substr(0,4),10),month:parseInt(e.substr(5,2),10),day:parseInt(e.substr(8,2),10),isDate:!0})},s.Time.fromDateString=function(u){return new s.Time({year:s.helpers.strictParseInt(u.substr(0,4)),month:s.helpers.strictParseInt(u.substr(5,2)),day:s.helpers.strictParseInt(u.substr(8,2)),isDate:!0})},s.Time.fromDateTimeString=function(u,e){if(u.length<19)throw new Error('invalid date-time value: "'+u+'"');var t;u[19]&&u[19]==="Z"?t="Z":e&&(t=e.getParameter("tzid"));var i=new s.Time({year:s.helpers.strictParseInt(u.substr(0,4)),month:s.helpers.strictParseInt(u.substr(5,2)),day:s.helpers.strictParseInt(u.substr(8,2)),hour:s.helpers.strictParseInt(u.substr(11,2)),minute:s.helpers.strictParseInt(u.substr(14,2)),second:s.helpers.strictParseInt(u.substr(17,2)),timezone:t});return i},s.Time.fromString=function(e,t){return e.length>10?s.Time.fromDateTimeString(e,t):s.Time.fromDateString(e)},s.Time.fromJSDate=function(e,t){var i=new s.Time;return i.fromJSDate(e,t)},s.Time.fromData=function(e,t){var i=new s.Time;return i.fromData(e,t)},s.Time.now=function(){return s.Time.fromJSDate(new Date,!1)},s.Time.weekOneStarts=function(e,t){var i=s.Time.fromData({year:e,month:1,day:1,isDate:!0}),r=i.dayOfWeek(),n=t||s.Time.DEFAULT_WEEK_START;return r>s.Time.THURSDAY&&(i.day+=7),n>s.Time.THURSDAY&&(i.day-=7),i.day-=r-n,i},s.Time.getDominicalLetter=function(u){var e="GFEDCBA",t=(u+(u/4|0)+(u/400|0)-(u/100|0)-1)%7,i=s.Time.isLeapYear(u);return i?e[(t+6)%7]+e[t]:e[t]},s.Time.epochTime=s.Time.fromData({year:1970,month:1,day:1,hour:0,minute:0,second:0,isDate:!1,timezone:"Z"}),s.Time._cmp_attr=function(e,t,i){return e[i]>t[i]?1:e[i]<t[i]?-1:0},s.Time.daysInYearPassedMonth=[[0,31,59,90,120,151,181,212,243,273,304,334,365],[0,31,60,91,121,152,182,213,244,274,305,335,366]],s.Time.SUNDAY=1,s.Time.MONDAY=2,s.Time.TUESDAY=3,s.Time.WEDNESDAY=4,s.Time.THURSDAY=5,s.Time.FRIDAY=6,s.Time.SATURDAY=7,s.Time.DEFAULT_WEEK_START=s.Time.MONDAY})();(function(){s.VCardTime=function(u,e,t){this.wrappedJSObject=this;var i=this._time=Object.create(null);i.year=null,i.month=null,i.day=null,i.hour=null,i.minute=null,i.second=null,this.icaltype=t||"date-and-or-time",this.fromData(u,e)},s.helpers.inherits(s.Time,s.VCardTime,{icalclass:"vcardtime",icaltype:"date-and-or-time",zone:null,clone:function(){return new s.VCardTime(this._time,this.zone,this.icaltype)},_normalize:function(){return this},utcOffset:function(){return this.zone instanceof s.UtcOffset?this.zone.toSeconds():s.Time.prototype.utcOffset.apply(this,arguments)},toICALString:function(){return s.design.vcard.value[this.icaltype].toICAL(this.toString())},toString:function(){var e=s.helpers.pad2,t=this.year,i=this.month,r=this.day,n=this.hour,a=this.minute,o=this.second,l=t!==null,m=i!==null,c=r!==null,d=n!==null,f=a!==null,p=o!==null,v=(l?e(t)+(m||c?"-":""):m||c?"--":"")+(m?e(i):"")+(c?"-"+e(r):""),y=(d?e(n):"-")+(d&&f?":":"")+(f?e(a):"")+(!d&&!f?"-":"")+(f&&p?":":"")+(p?e(o):""),g;if(this.zone===s.Timezone.utcTimezone)g="Z";else if(this.zone instanceof s.UtcOffset)g=this.zone.toString();else if(this.zone===s.Timezone.localTimezone)g="";else if(this.zone instanceof s.Timezone){var w=s.UtcOffset.fromSeconds(this.zone.utcOffset(this));g=w.toString()}else g="";switch(this.icaltype){case"time":return y+g;case"date-and-or-time":case"date-time":return v+(y=="--"?"":"T"+y+g);case"date":return v}return null}}),s.VCardTime.fromDateAndOrTimeString=function(u,e){function t(y,g,w){return y?s.helpers.strictParseInt(y.substr(g,w)):null}var i=u.split("T"),r=i[0],n=i[1],a=n?s.design.vcard.value.time._splitZone(n):[],o=a[0],l=a[1],m=s.helpers.strictParseInt,c=r?r.length:0,d=l?l.length:0,f=r&&r[0]=="-"&&r[1]=="-",p=l&&l[0]=="-",v={year:f?null:t(r,0,4),month:f&&(c==4||c==7)?t(r,2,2):c==7||c==10?t(r,5,2):null,day:c==5?t(r,3,2):c==7&&f?t(r,5,2):c==10?t(r,8,2):null,hour:p?null:t(l,0,2),minute:p&&d==3?t(l,1,2):d>4?p?t(l,1,2):t(l,3,2):null,second:d==4?t(l,2,2):d==6?t(l,4,2):d==8?t(l,6,2):null};return o=="Z"?o=s.Timezone.utcTimezone:o&&o[3]==":"?o=s.UtcOffset.fromString(o):o=null,new s.VCardTime(v,o,e)}})();(function(){var u={SU:s.Time.SUNDAY,MO:s.Time.MONDAY,TU:s.Time.TUESDAY,WE:s.Time.WEDNESDAY,TH:s.Time.THURSDAY,FR:s.Time.FRIDAY,SA:s.Time.SATURDAY},e={};for(var t in u)u.hasOwnProperty(t)&&(e[u[t]]=t);var i=["BYSECOND","BYMINUTE","BYHOUR","BYDAY","BYMONTHDAY","BYYEARDAY","BYWEEKNO","BYMONTH","BYSETPOS"];s.Recur=function(d){this.wrappedJSObject=this,this.parts={},d&&typeof d=="object"&&this.fromData(d)},s.Recur.prototype={parts:null,interval:1,wkst:s.Time.MONDAY,until:null,count:null,freq:null,icalclass:"icalrecur",icaltype:"recur",iterator:function(c){return new s.RecurIterator({rule:this,dtstart:c})},clone:function(){return new s.Recur(this.toJSON())},isFinite:function(){return!!(this.count||this.until)},isByCount:function(){return!!(this.count&&!this.until)},addComponent:function(d,f){var p=d.toUpperCase();p in this.parts?this.parts[p].push(f):this.parts[p]=[f]},setComponent:function(d,f){this.parts[d.toUpperCase()]=f.slice()},getComponent:function(d){var f=d.toUpperCase();return f in this.parts?this.parts[f].slice():[]},getNextOccurrence:function(d,f){var p=this.iterator(d),v,y;do v=p.next();while(v&&v.compare(f)<=0);return v&&f.zone&&(v.zone=f.zone),v},fromData:function(c){for(var d in c){var f=d.toUpperCase();f in m?Array.isArray(c[d])?this.parts[f]=c[d]:this.parts[f]=[c[d]]:this[d]=c[d]}this.interval&&typeof this.interval!="number"&&l.INTERVAL(this.interval,this),this.wkst&&typeof this.wkst!="number"&&(this.wkst=s.Recur.icalDayToNumericDay(this.wkst)),this.until&&!(this.until instanceof s.Time)&&(this.until=s.Time.fromString(this.until))},toJSON:function(){var c=Object.create(null);c.freq=this.freq,this.count&&(c.count=this.count),this.interval>1&&(c.interval=this.interval);for(var d in this.parts)if(this.parts.hasOwnProperty(d)){var f=this.parts[d];Array.isArray(f)&&f.length==1?c[d.toLowerCase()]=f[0]:c[d.toLowerCase()]=s.helpers.clone(this.parts[d])}return this.until&&(c.until=this.until.toString()),"wkst"in this&&this.wkst!==s.Time.DEFAULT_WEEK_START&&(c.wkst=s.Recur.numericDayToIcalDay(this.wkst)),c},toString:function(){var d="FREQ="+this.freq;this.count&&(d+=";COUNT="+this.count),this.interval>1&&(d+=";INTERVAL="+this.interval);for(var f in this.parts)this.parts.hasOwnProperty(f)&&(d+=";"+f+"="+this.parts[f]);return this.until&&(d+=";UNTIL="+this.until.toICALString()),"wkst"in this&&this.wkst!==s.Time.DEFAULT_WEEK_START&&(d+=";WKST="+s.Recur.numericDayToIcalDay(this.wkst)),d}};function r(c,d,f,p){var v=p;if(p[0]==="+"&&(v=p.substr(1)),v=s.helpers.strictParseInt(v),d!==void 0&&p<d)throw new Error(c+': invalid value "'+p+'" must be > '+d);if(f!==void 0&&p>f)throw new Error(c+': invalid value "'+p+'" must be < '+d);return v}s.Recur.icalDayToNumericDay=function(d,f){var p=f||s.Time.SUNDAY;return(u[d]-p+7)%7+1},s.Recur.numericDayToIcalDay=function(d,f){var p=f||s.Time.SUNDAY,v=d+p-s.Time.SUNDAY;return v>7&&(v-=7),e[v]};var n=/^(SU|MO|TU|WE|TH|FR|SA)$/,a=/^([+-])?(5[0-3]|[1-4][0-9]|[1-9])?(SU|MO|TU|WE|TH|FR|SA)$/,o=["SECONDLY","MINUTELY","HOURLY","DAILY","WEEKLY","MONTHLY","YEARLY"],l={FREQ:function(c,d,f){if(o.indexOf(c)!==-1)d.freq=c;else throw new Error('invalid frequency "'+c+'" expected: "'+o.join(", ")+'"')},COUNT:function(c,d,f){d.count=s.helpers.strictParseInt(c)},INTERVAL:function(c,d,f){d.interval=s.helpers.strictParseInt(c),d.interval<1&&(d.interval=1)},UNTIL:function(c,d,f){c.length>10?d.until=s.design.icalendar.value["date-time"].fromICAL(c):d.until=s.design.icalendar.value.date.fromICAL(c),f||(d.until=s.Time.fromString(d.until))},WKST:function(c,d,f){if(n.test(c))d.wkst=s.Recur.icalDayToNumericDay(c);else throw new Error('invalid WKST value "'+c+'"')}},m={BYSECOND:r.bind(this,"BYSECOND",0,60),BYMINUTE:r.bind(this,"BYMINUTE",0,59),BYHOUR:r.bind(this,"BYHOUR",0,23),BYDAY:function(c){if(a.test(c))return c;throw new Error('invalid BYDAY value "'+c+'"')},BYMONTHDAY:r.bind(this,"BYMONTHDAY",-31,31),BYYEARDAY:r.bind(this,"BYYEARDAY",-366,366),BYWEEKNO:r.bind(this,"BYWEEKNO",-53,53),BYMONTH:r.bind(this,"BYMONTH",1,12),BYSETPOS:r.bind(this,"BYSETPOS",-366,366)};s.Recur.fromString=function(c){var d=s.Recur._stringToData(c,!1);return new s.Recur(d)},s.Recur.fromData=function(c){return new s.Recur(c)},s.Recur._stringToData=function(c,d){for(var f=Object.create(null),p=c.split(";"),v=p.length,y=0;y<v;y++){var g=p[y].split("="),w=g[0].toUpperCase(),_=g[0].toLowerCase(),O=d?_:w,D=g[1];if(w in m){for(var Y=D.split(","),b=0,S=Y.length;b<S;b++)Y[b]=m[w](Y[b]);f[O]=Y.length==1?Y[0]:Y}else w in l?l[w](D,f,d):f[_]=D}return f}})();s.RecurIterator=function(){function u(e){this.fromData(e)}return u.prototype={completed:!1,rule:null,dtstart:null,last:null,occurrence_number:0,by_indices:null,initialized:!1,by_data:null,days:null,days_index:0,fromData:function(e){if(this.rule=s.helpers.formatClassType(e.rule,s.Recur),!this.rule)throw new Error("iterator requires a (ICAL.Recur) rule");if(this.dtstart=s.helpers.formatClassType(e.dtstart,s.Time),!this.dtstart)throw new Error("iterator requires a (ICAL.Time) dtstart");e.by_data?this.by_data=e.by_data:this.by_data=s.helpers.clone(this.rule.parts,!0),e.occurrence_number&&(this.occurrence_number=e.occurrence_number),this.days=e.days||[],e.last&&(this.last=s.helpers.formatClassType(e.last,s.Time)),this.by_indices=e.by_indices,this.by_indices||(this.by_indices={BYSECOND:0,BYMINUTE:0,BYHOUR:0,BYDAY:0,BYMONTH:0,BYWEEKNO:0,BYMONTHDAY:0}),this.initialized=e.initialized||!1,this.initialized||this.init()},init:function(){this.initialized=!0,this.last=this.dtstart.clone();var t=this.by_data;if("BYDAY"in t&&this.sort_byday_rules(t.BYDAY),"BYYEARDAY"in t&&("BYMONTH"in t||"BYWEEKNO"in t||"BYMONTHDAY"in t||"BYDAY"in t))throw new Error("Invalid BYYEARDAY rule");if("BYWEEKNO"in t&&"BYMONTHDAY"in t)throw new Error("BYWEEKNO does not fit to BYMONTHDAY");if(this.rule.freq=="MONTHLY"&&("BYYEARDAY"in t||"BYWEEKNO"in t))throw new Error("For MONTHLY recurrences neither BYYEARDAY nor BYWEEKNO may appear");if(this.rule.freq=="WEEKLY"&&("BYYEARDAY"in t||"BYMONTHDAY"in t))throw new Error("For WEEKLY recurrences neither BYMONTHDAY nor BYYEARDAY may appear");if(this.rule.freq!="YEARLY"&&"BYYEARDAY"in t)throw new Error("BYYEARDAY may only appear in YEARLY rules");if(this.last.second=this.setup_defaults("BYSECOND","SECONDLY",this.dtstart.second),this.last.minute=this.setup_defaults("BYMINUTE","MINUTELY",this.dtstart.minute),this.last.hour=this.setup_defaults("BYHOUR","HOURLY",this.dtstart.hour),this.last.day=this.setup_defaults("BYMONTHDAY","DAILY",this.dtstart.day),this.last.month=this.setup_defaults("BYMONTH","MONTHLY",this.dtstart.month),this.rule.freq=="WEEKLY")if("BYDAY"in t){var i=this.ruleDayOfWeek(t.BYDAY[0],this.rule.wkst),r=i[0],n=i[1],a=n-this.last.dayOfWeek(this.rule.wkst);(this.last.dayOfWeek(this.rule.wkst)<n&&a>=0||a<0)&&(this.last.day+=a)}else{var o=s.Recur.numericDayToIcalDay(this.dtstart.dayOfWeek());t.BYDAY=[o]}if(this.rule.freq=="YEARLY"){for(;this.expand_year_days(this.last.year),!(this.days.length>0);)this.increment_year(this.rule.interval);this._nextByYearDay()}if(this.rule.freq=="MONTHLY"&&this.has_by_data("BYDAY")){var l=null,m=this.last.clone(),c=s.Time.daysInMonth(this.last.month,this.last.year);for(var d in this.by_data.BYDAY)if(this.by_data.BYDAY.hasOwnProperty(d)){this.last=m.clone();var i=this.ruleDayOfWeek(this.by_data.BYDAY[d]),r=i[0],n=i[1],f=this.last.nthWeekDay(n,r);if(r>=6||r<=-6)throw new Error("Malformed values in BYDAY part");if(f>c||f<=0){if(l&&l.month==m.month)continue;for(;f>c||f<=0;)this.increment_month(),c=s.Time.daysInMonth(this.last.month,this.last.year),f=this.last.nthWeekDay(n,r)}this.last.day=f,(!l||this.last.compare(l)<0)&&(l=this.last.clone())}if(this.last=l.clone(),this.has_by_data("BYMONTHDAY")&&this._byDayAndMonthDay(!0),this.last.day>c||this.last.day==0)throw new Error("Malformed values in BYDAY part")}else if(this.has_by_data("BYMONTHDAY")&&this.last.day<0){var c=s.Time.daysInMonth(this.last.month,this.last.year);this.last.day=c+this.last.day+1}},next:function(){var t=this.last?this.last.clone():null;if(this.rule.count&&this.occurrence_number>=this.rule.count||this.rule.until&&this.last.compare(this.rule.until)>0)return this.completed=!0,null;if(this.occurrence_number==0&&this.last.compare(this.dtstart)>=0)return this.occurrence_number++,this.last;var i;do switch(i=1,this.rule.freq){case"SECONDLY":this.next_second();break;case"MINUTELY":this.next_minute();break;case"HOURLY":this.next_hour();break;case"DAILY":this.next_day();break;case"WEEKLY":this.next_week();break;case"MONTHLY":i=this.next_month();break;case"YEARLY":this.next_year();break;default:return null}while(!this.check_contracting_rules()||this.last.compare(this.dtstart)<0||!i);if(this.last.compare(t)==0)throw new Error("Same occurrence found twice, protecting you from death by recursion");return this.rule.until&&this.last.compare(this.rule.until)>0?(this.completed=!0,null):(this.occurrence_number++,this.last)},next_second:function(){return this.next_generic("BYSECOND","SECONDLY","second","minute")},increment_second:function(t){return this.increment_generic(t,"second",60,"minute")},next_minute:function(){return this.next_generic("BYMINUTE","MINUTELY","minute","hour","next_second")},increment_minute:function(t){return this.increment_generic(t,"minute",60,"hour")},next_hour:function(){return this.next_generic("BYHOUR","HOURLY","hour","monthday","next_minute")},increment_hour:function(t){this.increment_generic(t,"hour",24,"monthday")},next_day:function(){var t="BYDAY"in this.by_data,i=this.rule.freq=="DAILY";return this.next_hour()==0||(i?this.increment_monthday(this.rule.interval):this.increment_monthday(1)),0},next_week:function(){var t=0;if(this.next_weekday_by_week()==0)return t;if(this.has_by_data("BYWEEKNO")){var i=++this.by_indices.BYWEEKNO;this.by_indices.BYWEEKNO==this.by_data.BYWEEKNO.length&&(this.by_indices.BYWEEKNO=0,t=1),this.last.month=1,this.last.day=1;var r=this.by_data.BYWEEKNO[this.by_indices.BYWEEKNO];this.last.day+=7*r,t&&this.increment_year(1)}else this.increment_monthday(7*this.rule.interval);return t},normalizeByMonthDayRules:function(e,t,i){for(var r=s.Time.daysInMonth(t,e),n=[],a=0,o=i.length,l;a<o;a++)if(l=i[a],!(Math.abs(l)>r)){if(l<0)l=r+(l+1);else if(l===0)continue;n.indexOf(l)===-1&&n.push(l)}return n.sort(function(m,c){return m-c})},_byDayAndMonthDay:function(e){var t,i=this.by_data.BYDAY,r,n=0,a,o=i.length,l=0,m,c=this,d=this.last.day;function f(){for(m=s.Time.daysInMonth(c.last.month,c.last.year),t=c.normalizeByMonthDayRules(c.last.year,c.last.month,c.by_data.BYMONTHDAY),a=t.length;t[n]<=d&&!(e&&t[n]==d)&&n<a-1;)n++}function p(){d=0,c.increment_month(),n=0,f()}f(),e&&(d-=1);for(var v=48;!l&&v;){if(v--,r=d+1,r>m){p();continue}var y=t[n++];if(y>=r)d=y;else{p();continue}for(var g=0;g<o;g++){var w=this.ruleDayOfWeek(i[g]),_=w[0],O=w[1];if(this.last.day=d,this.last.isNthWeekDay(O,_)){l=1;break}}if(!l&&n===a){p();continue}}if(v<=0)throw new Error("Malformed values in BYDAY combined with BYMONTHDAY parts");return l},next_month:function(){var t=this.rule.freq=="MONTHLY",i=1;if(this.next_hour()==0)return i;if(this.has_by_data("BYDAY")&&this.has_by_data("BYMONTHDAY"))i=this._byDayAndMonthDay();else if(this.has_by_data("BYDAY")){var r=s.Time.daysInMonth(this.last.month,this.last.year),n=0,a=0;if(this.has_by_data("BYSETPOS")){for(var o=this.last.day,l=1;l<=r;l++)this.last.day=l,this.is_day_in_byday(this.last)&&(a++,l<=o&&n++);this.last.day=o}i=0;for(var l=this.last.day+1;l<=r;l++)if(this.last.day=l,this.is_day_in_byday(this.last)&&(!this.has_by_data("BYSETPOS")||this.check_set_position(++n)||this.check_set_position(n-a-1))){i=1;break}l>r&&(this.last.day=1,this.increment_month(),this.is_day_in_byday(this.last)?(!this.has_by_data("BYSETPOS")||this.check_set_position(1))&&(i=1):i=0)}else if(this.has_by_data("BYMONTHDAY")){this.by_indices.BYMONTHDAY++,this.by_indices.BYMONTHDAY>=this.by_data.BYMONTHDAY.length&&(this.by_indices.BYMONTHDAY=0,this.increment_month());var r=s.Time.daysInMonth(this.last.month,this.last.year),l=this.by_data.BYMONTHDAY[this.by_indices.BYMONTHDAY];l<0&&(l=r+l+1),l>r?(this.last.day=1,i=this.is_day_in_byday(this.last)):this.last.day=l}else{this.increment_month();var r=s.Time.daysInMonth(this.last.month,this.last.year);this.by_data.BYMONTHDAY[0]>r?i=0:this.last.day=this.by_data.BYMONTHDAY[0]}return i},next_weekday_by_week:function(){var t=0;if(this.next_hour()==0)return t;if(!this.has_by_data("BYDAY"))return 1;for(;;){var i=new s.Time;this.by_indices.BYDAY++,this.by_indices.BYDAY==Object.keys(this.by_data.BYDAY).length&&(this.by_indices.BYDAY=0,t=1);var r=this.by_data.BYDAY[this.by_indices.BYDAY],n=this.ruleDayOfWeek(r),a=n[1];a-=this.rule.wkst,a<0&&(a+=7),i.year=this.last.year,i.month=this.last.month,i.day=this.last.day;var o=i.startDoyWeek(this.rule.wkst);if(!(a+o<1&&!t)){var l=s.Time.fromDayOfYear(o+a,this.last.year);return this.last.year=l.year,this.last.month=l.month,this.last.day=l.day,t}}},next_year:function(){if(this.next_hour()==0)return 0;if(++this.days_index==this.days.length){this.days_index=0;do this.increment_year(this.rule.interval),this.expand_year_days(this.last.year);while(this.days.length==0)}return this._nextByYearDay(),1},_nextByYearDay:function(){var t=this.days[this.days_index],i=this.last.year;t<1&&(t+=1,i+=1);var r=s.Time.fromDayOfYear(t,i);this.last.day=r.day,this.last.month=r.month},ruleDayOfWeek:function(t,i){var r=t.match(/([+-]?[0-9])?(MO|TU|WE|TH|FR|SA|SU)/);if(r){var n=parseInt(r[1]||0,10);return t=s.Recur.icalDayToNumericDay(r[2],i),[n,t]}else return[0,0]},next_generic:function(t,i,r,n,a){var o=t in this.by_data,l=this.rule.freq==i,m=0;if(a&&this[a]()==0)return m;if(o){this.by_indices[t]++;var c=this.by_indices[t],d=this.by_data[t];this.by_indices[t]==d.length&&(this.by_indices[t]=0,m=1),this.last[r]=d[this.by_indices[t]]}else l&&this["increment_"+r](this.rule.interval);return o&&m&&l&&this["increment_"+n](1),m},increment_monthday:function(t){for(var i=0;i<t;i++){var r=s.Time.daysInMonth(this.last.month,this.last.year);this.last.day++,this.last.day>r&&(this.last.day-=r,this.increment_month())}},increment_month:function(){if(this.last.day=1,this.has_by_data("BYMONTH"))this.by_indices.BYMONTH++,this.by_indices.BYMONTH==this.by_data.BYMONTH.length&&(this.by_indices.BYMONTH=0,this.increment_year(1)),this.last.month=this.by_data.BYMONTH[this.by_indices.BYMONTH];else{this.rule.freq=="MONTHLY"?this.last.month+=this.rule.interval:this.last.month++,this.last.month--;var t=s.helpers.trunc(this.last.month/12);this.last.month%=12,this.last.month++,t!=0&&this.increment_year(t)}},increment_year:function(t){this.last.year+=t},increment_generic:function(t,i,r,n){this.last[i]+=t;var a=s.helpers.trunc(this.last[i]/r);this.last[i]%=r,a!=0&&this["increment_"+n](a)},has_by_data:function(t){return t in this.rule.parts},expand_year_days:function(t){var i=new s.Time;this.days=[];var r={},n=["BYDAY","BYWEEKNO","BYMONTHDAY","BYMONTH","BYYEARDAY"];for(var a in n)if(n.hasOwnProperty(a)){var o=n[a];o in this.rule.parts&&(r[o]=this.rule.parts[o])}if("BYMONTH"in r&&"BYWEEKNO"in r){var l=1,m={};i.year=t,i.isDate=!0;for(var c=0;c<this.by_data.BYMONTH.length;c++){var d=this.by_data.BYMONTH[c];i.month=d,i.day=1;var f=i.weekNumber(this.rule.wkst);i.day=s.Time.daysInMonth(d,t);var p=i.weekNumber(this.rule.wkst);for(c=f;c<p;c++)m[c]=1}for(var v=0;v<this.by_data.BYWEEKNO.length&&l;v++){var y=this.by_data.BYWEEKNO[v];y<52?l&=m[v]:l=0}l?delete r.BYMONTH:delete r.BYWEEKNO}var g=Object.keys(r).length;if(g==0){var w=this.dtstart.clone();w.year=this.last.year,this.days.push(w.dayOfYear())}else if(g==1&&"BYMONTH"in r){for(var _ in this.by_data.BYMONTH)if(this.by_data.BYMONTH.hasOwnProperty(_)){var O=this.dtstart.clone();O.year=t,O.month=this.by_data.BYMONTH[_],O.isDate=!0,this.days.push(O.dayOfYear())}}else if(g==1&&"BYMONTHDAY"in r){for(var D in this.by_data.BYMONTHDAY)if(this.by_data.BYMONTHDAY.hasOwnProperty(D)){var Y=this.dtstart.clone(),b=this.by_data.BYMONTHDAY[D];if(b<0){var S=s.Time.daysInMonth(Y.month,t);b=b+S+1}Y.day=b,Y.year=t,Y.isDate=!0,this.days.push(Y.dayOfYear())}}else if(g==2&&"BYMONTHDAY"in r&&"BYMONTH"in r){for(var _ in this.by_data.BYMONTH)if(this.by_data.BYMONTH.hasOwnProperty(_)){var N=this.by_data.BYMONTH[_],S=s.Time.daysInMonth(N,t);for(var D in this.by_data.BYMONTHDAY)if(this.by_data.BYMONTHDAY.hasOwnProperty(D)){var b=this.by_data.BYMONTHDAY[D];b<0&&(b=b+S+1),i.day=b,i.month=N,i.year=t,i.isDate=!0,this.days.push(i.dayOfYear())}}}else if(!(g==1&&"BYWEEKNO"in r)){if(!(g==2&&"BYWEEKNO"in r&&"BYMONTHDAY"in r))if(g==1&&"BYDAY"in r)this.days=this.days.concat(this.expand_by_day(t));else if(g==2&&"BYDAY"in r&&"BYMONTH"in r){for(var _ in this.by_data.BYMONTH)if(this.by_data.BYMONTH.hasOwnProperty(_)){var d=this.by_data.BYMONTH[_],S=s.Time.daysInMonth(d,t);i.year=t,i.month=this.by_data.BYMONTH[_],i.day=1,i.isDate=!0;var P=i.dayOfWeek(),x=i.dayOfYear()-1;i.day=S;var B=i.dayOfWeek();if(this.has_by_data("BYSETPOS")){for(var I=0,U=[],C=1;C<=S;C++)i.day=C,this.is_day_in_byday(i)&&U.push(C);for(var L=0;L<U.length;L++)(this.check_set_position(L+1)||this.check_set_position(L-U.length))&&this.days.push(x+U[L])}else for(var h in this.by_data.BYDAY)if(this.by_data.BYDAY.hasOwnProperty(h)){var T=this.by_data.BYDAY[h],A=this.ruleDayOfWeek(T),E=A[0],R=A[1],M,F=(R+7-P)%7+1,st=S-(B+7-R)%7;if(E==0)for(var C=F;C<=S;C+=7)this.days.push(x+C);else E>0?(M=F+(E-1)*7,M<=S&&this.days.push(x+M)):(M=st+(E+1)*7,M>0&&this.days.push(x+M))}}this.days.sort(function(at,ot){return at-ot})}else if(g==2&&"BYDAY"in r&&"BYMONTHDAY"in r){var k=this.expand_by_day(t);for(var W in k)if(k.hasOwnProperty(W)){var C=k[W],V=s.Time.fromDayOfYear(C,t);this.by_data.BYMONTHDAY.indexOf(V.day)>=0&&this.days.push(C)}}else if(g==3&&"BYDAY"in r&&"BYMONTHDAY"in r&&"BYMONTH"in r){var k=this.expand_by_day(t);for(var W in k)if(k.hasOwnProperty(W)){var C=k[W],V=s.Time.fromDayOfYear(C,t);this.by_data.BYMONTH.indexOf(V.month)>=0&&this.by_data.BYMONTHDAY.indexOf(V.day)>=0&&this.days.push(C)}}else if(g==2&&"BYDAY"in r&&"BYWEEKNO"in r){var k=this.expand_by_day(t);for(var W in k)if(k.hasOwnProperty(W)){var C=k[W],V=s.Time.fromDayOfYear(C,t),y=V.weekNumber(this.rule.wkst);this.by_data.BYWEEKNO.indexOf(y)&&this.days.push(C)}}else g==3&&"BYDAY"in r&&"BYWEEKNO"in r&&"BYMONTHDAY"in r||(g==1&&"BYYEARDAY"in r?this.days=this.days.concat(this.by_data.BYYEARDAY):this.days=[])}return 0},expand_by_day:function(t){var i=[],r=this.last.clone();r.year=t,r.month=1,r.day=1,r.isDate=!0;var n=r.dayOfWeek();r.month=12,r.day=31,r.isDate=!0;var a=r.dayOfWeek(),o=r.dayOfYear();for(var l in this.by_data.BYDAY)if(this.by_data.BYDAY.hasOwnProperty(l)){var m=this.by_data.BYDAY[l],c=this.ruleDayOfWeek(m),d=c[0],f=c[1];if(d==0)for(var p=(f+7-n)%7+1,v=p;v<=o;v+=7)i.push(v);else if(d>0){var y;f>=n?y=f-n+1:y=f-n+8,i.push(y+(d-1)*7)}else{var g;d=-d,f<=a?g=o-a+f:g=o-a+f-7,i.push(g-(d-1)*7)}}return i},is_day_in_byday:function(t){for(var i in this.by_data.BYDAY)if(this.by_data.BYDAY.hasOwnProperty(i)){var r=this.by_data.BYDAY[i],n=this.ruleDayOfWeek(r),a=n[0],o=n[1],l=t.dayOfWeek();if(a==0&&o==l||t.nthWeekDay(o,a)==t.day)return 1}return 0},check_set_position:function(t){if(this.has_by_data("BYSETPOS")){var i=this.by_data.BYSETPOS.indexOf(t);return i!==-1}return!1},sort_byday_rules:function(t){for(var i=0;i<t.length;i++)for(var r=0;r<i;r++){var n=this.ruleDayOfWeek(t[r],this.rule.wkst)[1],a=this.ruleDayOfWeek(t[i],this.rule.wkst)[1];if(n>a){var o=t[i];t[i]=t[r],t[r]=o}}},check_contract_restriction:function(t,i){var r=u._indexMap[t],n=u._expandMap[this.rule.freq][r],a=!1;if(t in this.by_data&&n==u.CONTRACT){var o=this.by_data[t];for(var l in o)if(o.hasOwnProperty(l)&&o[l]==i){a=!0;break}}else a=!0;return a},check_contracting_rules:function(){var t=this.last.dayOfWeek(),i=this.last.weekNumber(this.rule.wkst),r=this.last.dayOfYear();return this.check_contract_restriction("BYSECOND",this.last.second)&&this.check_contract_restriction("BYMINUTE",this.last.minute)&&this.check_contract_restriction("BYHOUR",this.last.hour)&&this.check_contract_restriction("BYDAY",s.Recur.numericDayToIcalDay(t))&&this.check_contract_restriction("BYWEEKNO",i)&&this.check_contract_restriction("BYMONTHDAY",this.last.day)&&this.check_contract_restriction("BYMONTH",this.last.month)&&this.check_contract_restriction("BYYEARDAY",r)},setup_defaults:function(t,i,r){var n=u._indexMap[t],a=u._expandMap[this.rule.freq][n];return a!=u.CONTRACT&&(t in this.by_data||(this.by_data[t]=[r]),this.rule.freq!=i)?this.by_data[t][0]:r},toJSON:function(){var e=Object.create(null);return e.initialized=this.initialized,e.rule=this.rule.toJSON(),e.dtstart=this.dtstart.toJSON(),e.by_data=this.by_data,e.days=this.days,e.last=this.last.toJSON(),e.by_indices=this.by_indices,e.occurrence_number=this.occurrence_number,e}},u._indexMap={BYSECOND:0,BYMINUTE:1,BYHOUR:2,BYDAY:3,BYMONTHDAY:4,BYYEARDAY:5,BYWEEKNO:6,BYMONTH:7,BYSETPOS:8},u._expandMap={SECONDLY:[1,1,1,1,1,1,1,1],MINUTELY:[2,1,1,1,1,1,1,1],HOURLY:[2,2,1,1,1,1,1,1],DAILY:[2,2,2,1,1,1,1,1],WEEKLY:[2,2,2,2,3,3,1,1],MONTHLY:[2,2,2,2,2,3,3,1],YEARLY:[2,2,2,2,2,2,2,2]},u.UNKNOWN=0,u.CONTRACT=1,u.EXPAND=2,u.ILLEGAL=3,u}();s.RecurExpansion=function(){function u(r){return s.helpers.formatClassType(r,s.Time)}function e(r,n){return r.compare(n)}function t(r){return r.hasProperty("rdate")||r.hasProperty("rrule")||r.hasProperty("recurrence-id")}function i(r){this.ruleDates=[],this.exDates=[],this.fromData(r)}return i.prototype={complete:!1,ruleIterators:null,ruleDates:null,exDates:null,ruleDateInc:0,exDateInc:0,exDate:null,ruleDate:null,dtstart:null,last:null,fromData:function(r){var n=s.helpers.formatClassType(r.dtstart,s.Time);if(n)this.dtstart=n;else throw new Error(".dtstart (ICAL.Time) must be given");if(r.component)this._init(r.component);else{if(this.last=u(r.last)||n.clone(),!r.ruleIterators)throw new Error(".ruleIterators or .component must be given");this.ruleIterators=r.ruleIterators.map(function(a){return s.helpers.formatClassType(a,s.RecurIterator)}),this.ruleDateInc=r.ruleDateInc,this.exDateInc=r.exDateInc,r.ruleDates&&(this.ruleDates=r.ruleDates.map(u),this.ruleDate=this.ruleDates[this.ruleDateInc]),r.exDates&&(this.exDates=r.exDates.map(u),this.exDate=this.exDates[this.exDateInc]),typeof r.complete!="undefined"&&(this.complete=r.complete)}},next:function(){for(var r,n,a,o,l=500,m=0;;){if(m++>l)throw new Error("max tries have occured, rule may be impossible to forfill.");if(a=this.ruleDate,r=this._nextRecurrenceIter(this.last),!a&&!r){this.complete=!0;break}if((!a||r&&a.compare(r.last)>0)&&(a=r.last.clone(),r.next()),this.ruleDate===a&&this._nextRuleDay(),this.last=a,this.exDate&&(o=this.exDate.compare(this.last),o<0&&this._nextExDay(),o===0)){this._nextExDay();continue}return this.last}},toJSON:function(){function r(a){return a.toJSON()}var n=Object.create(null);return n.ruleIterators=this.ruleIterators.map(r),this.ruleDates&&(n.ruleDates=this.ruleDates.map(r)),this.exDates&&(n.exDates=this.exDates.map(r)),n.ruleDateInc=this.ruleDateInc,n.exDateInc=this.exDateInc,n.last=this.last.toJSON(),n.dtstart=this.dtstart.toJSON(),n.complete=this.complete,n},_extractDates:function(r,n){function a(p){f=s.helpers.binsearchInsert(o,p,e),o.splice(f,0,p)}for(var o=[],l=r.getAllProperties(n),m=l.length,c=0,d,f;c<m;c++)l[c].getValues().forEach(a);return o},_init:function(r){if(this.ruleIterators=[],this.last=this.dtstart.clone(),!t(r)){this.ruleDate=this.last.clone(),this.complete=!0;return}if(r.hasProperty("rdate")&&(this.ruleDates=this._extractDates(r,"rdate"),this.ruleDates[0]&&this.ruleDates[0].compare(this.dtstart)<0?(this.ruleDateInc=0,this.last=this.ruleDates[0].clone()):this.ruleDateInc=s.helpers.binsearchInsert(this.ruleDates,this.last,e),this.ruleDate=this.ruleDates[this.ruleDateInc]),r.hasProperty("rrule"))for(var n=r.getAllProperties("rrule"),a=0,o=n.length,l,m;a<o;a++)l=n[a].getFirstValue(),m=l.iterator(this.dtstart),this.ruleIterators.push(m),m.next();r.hasProperty("exdate")&&(this.exDates=this._extractDates(r,"exdate"),this.exDateInc=s.helpers.binsearchInsert(this.exDates,this.last,e),this.exDate=this.exDates[this.exDateInc])},_nextExDay:function(){this.exDate=this.exDates[++this.exDateInc]},_nextRuleDay:function(){this.ruleDate=this.ruleDates[++this.ruleDateInc]},_nextRecurrenceIter:function(){var r=this.ruleIterators;if(r.length===0)return null;for(var n=r.length,a,o,l=0,m;l<n;l++){if(a=r[l],o=a.last,a.completed){n--,l!==0&&l--,r.splice(l,1);continue}(!m||m.last.compare(o)>0)&&(m=a)}return m}},i}();s.Event=function(){function u(t,i){t instanceof s.Component||(i=t,t=null),t?this.component=t:this.component=new s.Component("vevent"),this._rangeExceptionCache=Object.create(null),this.exceptions=Object.create(null),this.rangeExceptions=[],i&&i.strictExceptions&&(this.strictExceptions=i.strictExceptions),i&&i.exceptions?i.exceptions.forEach(this.relateException,this):this.component.parent&&!this.isRecurrenceException()&&this.component.parent.getAllSubcomponents("vevent").forEach(function(r){r.hasProperty("recurrence-id")&&this.relateException(r)},this)}u.prototype={THISANDFUTURE:"THISANDFUTURE",exceptions:null,strictExceptions:!1,relateException:function(t){if(this.isRecurrenceException())throw new Error("cannot relate exception to exceptions");if(t instanceof s.Component&&(t=new s.Event(t)),this.strictExceptions&&t.uid!==this.uid)throw new Error("attempted to relate unrelated exception");var i=t.recurrenceId.toString();if(this.exceptions[i]=t,t.modifiesFuture()){var r=[t.recurrenceId.toUnixTime(),i],n=s.helpers.binsearchInsert(this.rangeExceptions,r,e);this.rangeExceptions.splice(n,0,r)}},modifiesFuture:function(){if(!this.component.hasProperty("recurrence-id"))return!1;var t=this.component.getFirstProperty("recurrence-id").getParameter("range");return t===this.THISANDFUTURE},findRangeException:function(t){if(!this.rangeExceptions.length)return null;var i=t.toUnixTime(),r=s.helpers.binsearchInsert(this.rangeExceptions,[i],e);if(r-=1,r<0)return null;var n=this.rangeExceptions[r];return i<n[0]?null:n[1]},getOccurrenceDetails:function(t){var i=t.toString(),r=t.convertToZone(s.Timezone.utcTimezone).toString(),n,a={recurrenceId:t};if(i in this.exceptions)n=a.item=this.exceptions[i],a.startDate=n.startDate,a.endDate=n.endDate,a.item=n;else if(r in this.exceptions)n=this.exceptions[r],a.startDate=n.startDate,a.endDate=n.endDate,a.item=n;else{var o=this.findRangeException(t),l;if(o){var m=this.exceptions[o];a.item=m;var c=this._rangeExceptionCache[o];if(!c){var d=m.recurrenceId.clone(),f=m.startDate.clone();d.zone=f.zone,c=f.subtractDate(d),this._rangeExceptionCache[o]=c}var p=t.clone();p.zone=m.startDate.zone,p.addDuration(c),l=p.clone(),l.addDuration(m.duration),a.startDate=p,a.endDate=l}else l=t.clone(),l.addDuration(this.duration),a.endDate=l,a.startDate=t,a.item=this}return a},iterator:function(t){return new s.RecurExpansion({component:this.component,dtstart:t||this.startDate})},isRecurring:function(){var t=this.component;return t.hasProperty("rrule")||t.hasProperty("rdate")},isRecurrenceException:function(){return this.component.hasProperty("recurrence-id")},getRecurrenceTypes:function(){for(var t=this.component.getAllProperties("rrule"),i=0,r=t.length,n=Object.create(null);i<r;i++){var a=t[i].getFirstValue();n[a.freq]=!0}return n},get uid(){return this._firstProp("uid")},set uid(t){this._setProp("uid",t)},get startDate(){return this._firstProp("dtstart")},set startDate(t){this._setTime("dtstart",t)},get endDate(){var t=this._firstProp("dtend");if(!t){var i=this._firstProp("duration");t=this.startDate.clone(),i?t.addDuration(i):t.isDate&&(t.day+=1)}return t},set endDate(t){this.component.hasProperty("duration")&&this.component.removeProperty("duration"),this._setTime("dtend",t)},get duration(){var t=this._firstProp("duration");return t||this.endDate.subtractDateTz(this.startDate)},set duration(t){this.component.hasProperty("dtend")&&this.component.removeProperty("dtend"),this._setProp("duration",t)},get location(){return this._firstProp("location")},set location(t){return this._setProp("location",t)},get attendees(){return this.component.getAllProperties("attendee")},get summary(){return this._firstProp("summary")},set summary(t){this._setProp("summary",t)},get description(){return this._firstProp("description")},set description(t){this._setProp("description",t)},get color(){return this._firstProp("color")},set color(t){this._setProp("color",t)},get organizer(){return this._firstProp("organizer")},set organizer(t){this._setProp("organizer",t)},get sequence(){return this._firstProp("sequence")},set sequence(t){this._setProp("sequence",t)},get recurrenceId(){return this._firstProp("recurrence-id")},set recurrenceId(t){this._setTime("recurrence-id",t)},_setTime:function(t,i){var r=this.component.getFirstProperty(t);r||(r=new s.Property(t),this.component.addProperty(r)),i.zone===s.Timezone.localTimezone||i.zone===s.Timezone.utcTimezone?r.removeParameter("tzid"):r.setParameter("tzid",i.zone.tzid),r.setValue(i)},_setProp:function(t,i){this.component.updatePropertyWithValue(t,i)},_firstProp:function(t){return this.component.getFirstPropertyValue(t)},toString:function(){return this.component.toString()}};function e(t,i){return t[0]>i[0]?1:i[0]>t[0]?-1:0}return u}();s.ComponentParser=function(){function u(e){typeof e=="undefined"&&(e={});var t;for(t in e)e.hasOwnProperty(t)&&(this[t]=e[t])}return u.prototype={parseEvent:!0,parseTimezone:!0,oncomplete:function(){},onerror:function(e){},ontimezone:function(e){},onevent:function(e){},process:function(e){typeof e=="string"&&(e=s.parse(e)),e instanceof s.Component||(e=new s.Component(e));for(var t=e.getAllSubcomponents(),i=0,r=t.length,n;i<r;i++)switch(n=t[i],n.name){case"vtimezone":if(this.parseTimezone){var a=n.getFirstPropertyValue("tzid");a&&this.ontimezone(new s.Timezone({tzid:a,component:n}))}break;case"vevent":this.parseEvent&&this.onevent(new s.Event(n));break;default:continue}this.oncomplete()}},u}()});var vt={};mt(vt,{default:()=>Q});module.exports=yt(vt);var nt=require("obsidian");var j=require("obsidian"),K=pt(rt()),Z=class{constructor(e){this.events=[];this.lastFetch=0;this.refreshMinutes=e}async fetchCalendars(e){let t=Date.now(),i=e.filter(n=>n.enabled);if(this.events.length===0&&console.debug("MemoChron platform info:",{mobile:j.Platform.isMobile,electron:j.Platform.isDesktop,networkAvailable:navigator.onLine}),i.length===0)return this.events=[],console.warn("No enabled calendar sources to fetch."),[];if(!(this.events.length===0||t-this.lastFetch>=this.refreshMinutes*60*1e3||this.events.some(n=>!i.find(a=>a.name===n.source))||i.some(n=>!this.events.find(a=>a.source===n.name))))return this.events;try{let n=i.map(o=>this.fetchCalendar(o)),a=await Promise.all(n);return this.events=a.flat(),this.lastFetch=t,this.events}catch(n){throw console.error("Error fetching calendars:",n),n}}async fetchCalendar(e){try{let t=await(0,j.requestUrl)({url:e.url,method:"GET",headers:{Accept:"text/calendar","User-Agent":"MemoChron-ObsidianPlugin"},throw:!1});if(t.status!==200)return console.error(`Failed to fetch calendar ${e.name}: ${t.status} ${t.text}`),[];let i=(0,K.parse)(t.text),n=new K.Component(i).getAllSubcomponents("vevent"),a=[],o=new Date;o.setMonth(o.getMonth()-1),o.setHours(0,0,0,0);let l=new Date;l.setMonth(l.getMonth()+2),l.setHours(23,59,59,999);for(let m of n){let c=new K.Event(m);if(m.hasProperty("rrule")){let d=c.iterator(),f;for(;f=d.next();){let p=f.clone(),v=c.duration;if(p.addDuration(v),f.toJSDate()<=l&&p.toJSDate()>=o&&a.push({id:`${c.uid}-${f.toUnixTime()}`,title:c.summary,start:f.toJSDate(),end:p.toJSDate(),description:c.description,location:c.location,source:e.name}),f.toJSDate()>l)break}}else a.push({id:c.uid,title:c.summary,start:c.startDate.toJSDate(),end:c.endDate.toJSDate(),description:c.description,location:c.location,source:e.name})}return a}catch(t){return console.error(`Error fetching calendar ${e.name}:`,t),console.debug("Platform info:",{mobile:j.Platform.isMobile,electron:j.Platform.isDesktop,networkAvailable:navigator.onLine}),[]}}getEventsForDate(e){let t=new Date(e);t.setHours(0,0,0,0);let i=new Date(e);return i.setHours(23,59,59,999),this.events.filter(r=>{let n=r.start.toDateString()===e.toDateString(),a=r.end.toDateString()===e.toDateString(),o=r.start<i&&r.end>t;return n||a||o}).sort((r,n)=>r.start.getTime()-n.start.getTime())}};var H=require("obsidian"),X=class{constructor(e,t){this.app=e;this.settings=t}async updateExistingNote(e,t){let i=await this.app.vault.read(e),r=i.indexOf("## \u{1F4DD} Notes");if(r===-1){await this.app.vault.modify(e,this.generateNoteContent(t));return}let n=i.slice(r+11).trim(),a=this.generateNoteContent(t),o=a.indexOf("## \u{1F4DD} Notes");if(o===-1){await this.app.vault.modify(e,a);return}let l=a.slice(0,o+11)+`
`+(n?`
`+n:"");await this.app.vault.modify(e,l)}async createEventNote(e){let{vault:t}=this.app,{noteLocation:i,noteTitleFormat:r}=this.settings,n=(0,H.normalizePath)(i),a=this.formatTitle(r,e),o=(0,H.normalizePath)(`${n}/${a}.md`);try{n!=="/"&&await this.ensureFolderExists(n);let l=t.getAbstractFileByPath(o);if(l instanceof H.TFile)return l;let m=this.generateNoteContent(e);return await t.create(o,m)}catch(l){throw console.error("Error creating note:",l),l}}async getAllFolders(){let e=new Set(["/"]),t=i=>{e.add(i.path),i.children.forEach(r=>{r instanceof H.TFolder&&t(r)})};return this.app.vault.getAllLoadedFiles().forEach(i=>{i instanceof H.TFolder&&t(i)}),Array.from(e).sort((i,r)=>i.localeCompare(r))}generateNoteContent(e){let t=this.formatDate(e.start),i=e.start.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"}),r=e.end.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"}),n=this.getTagsForEvent(e),a=n.length>0?`tags:
`+n.map(f=>`  - ${f}`).join(`
`):"",o="";if(e.location){let f=e.location.startsWith("http://")||e.location.startsWith("https://")||e.location.startsWith("www."),p=e.location.toLowerCase().includes("zoom")||e.location.toLowerCase().includes("meet.")||e.location.toLowerCase().includes("teams")||e.location.toLowerCase().includes("webex");o=`${f?"\u{1F517}":p?"\u{1F4BB}":"\u{1F4CD}"} ${e.location}`}let m=`---
${["type: meeting",`date: "${t}"`,a].filter(f=>f).join(`
`)}
---`,c=this.cleanTeamsDescription(e.description||""),d=this.settings.noteTemplate;return d=d.replace(/{{event_title}}/g,e.title).replace(/{{date}}/g,t).replace(/{{start_time}}/g,i).replace(/{{end_time}}/g,r).replace(/{{source}}/g,e.source).replace(/{{location}}/g,o).replace(/{{description}}/g,c),m+`
`+d}getTagsForEvent(e){let t=[...this.settings.defaultTags||[]],i=this.settings.calendarUrls.find(r=>r.name===e.source);return i!=null&&i.tags&&t.push(...i.tags),[...new Set(t)]}formatTitle(e,t){let i=t.start.toISOString().split("T")[0];return e.replace(/{{event_title}}/g,this.sanitizeFileName(t.title)).replace(/{{date}}/g,i).replace(/{{source}}/g,this.sanitizeFileName(t.source))}formatDate(e){switch(this.settings.noteDateFormat){case"ISO":return e.toISOString().split("T")[0];case"US":return e.toLocaleDateString("en-US",{month:"2-digit",day:"2-digit",year:"numeric"});case"UK":return e.toLocaleDateString("en-GB",{day:"2-digit",month:"2-digit",year:"numeric"});case"Long":return e.toLocaleDateString("en-US",{month:"long",day:"numeric",year:"numeric"});default:return e.toISOString().split("T")[0]}}cleanTeamsDescription(e){let t=e.indexOf("________________");return t!==-1?e.substring(0,t).trim():e.trim()}async ensureFolderExists(e){let{vault:t}=this.app,i=e.split("/").filter(n=>n.length),r="";for(let n of i){r=r?`${r}/${n}`:n;let a=t.getAbstractFileByPath(r);if(a){if(!(a instanceof H.TFolder))throw new Error(`Cannot create folder '${r}' because a file with that name already exists`)}else try{await t.createFolder(r)}catch(o){if(!o.message.includes("already exists"))throw o}}}sanitizeFileName(e){return e.replace(/[\\/:*?"<>|]/g,"-")}};var J=require("obsidian"),$=class extends J.ItemView{constructor(t,i){super(t);this.selectedDate=null;this.currentMonthDays=new Map;this.plugin=i,this.currentDate=new Date}getViewType(){return"memochron-calendar"}getDisplayText(){return"MemoChron Calendar"}getIcon(){return"calendar-range"}async onOpen(){let t=this.containerEl.children[1];t.empty();let r=t.createEl("div",{cls:"memochron-controls"}).createEl("div",{cls:"memochron-nav"}),n=r.createEl("span",{cls:"memochron-title"}),a=r.createEl("div",{cls:"memochron-nav-buttons"}),o=a.createEl("button",{text:"<"}),l=a.createEl("button",{text:"Today"}),m=a.createEl("button",{text:">"});o.onclick=()=>this.navigate(-1),l.onclick=()=>this.goToday(),m.onclick=()=>this.navigate(1),this.calendar=t.createEl("div",{cls:"memochron-calendar"}),this.agenda=t.createEl("div",{cls:"memochron-agenda"}),await this.goToday()}async navigate(t){this.currentDate.setMonth(this.currentDate.getMonth()+t),await this.refreshEvents()}async goToday(){let t=new Date;(this.currentDate.getMonth()!==t.getMonth()||this.currentDate.getFullYear()!==t.getFullYear())&&(this.currentDate=t,await this.refreshEvents()),this.selectDate(t)}async selectDate(t){if(this.selectedDate){let n=this.selectedDate.toDateString(),a=this.currentMonthDays.get(n);a&&a.removeClass("selected")}this.selectedDate=t;let i=t.toDateString(),r=this.currentMonthDays.get(i);r&&r.addClass("selected"),await this.showDayAgenda(t)}async refreshEvents(){await this.plugin.calendarService.fetchCalendars(this.plugin.settings.calendarUrls),this.renderMonth(),this.selectedDate&&this.showDayAgenda(this.selectedDate)}renderMonth(){this.calendar.empty(),this.currentMonthDays.clear();let t=this.currentDate.getFullYear(),i=this.currentDate.getMonth(),r=this.containerEl.querySelector(".memochron-title");r&&(r.textContent=new Date(t,i).toLocaleString("default",{month:"long",year:"numeric"}));let n=this.calendar.createEl("div",{cls:"memochron-calendar-grid"}),a=["Su","Mo","Tu","We","Th","Fr","Sa"],o=this.plugin.settings.firstDayOfWeek;[...a.slice(o),...a.slice(0,o)].forEach(y=>{n.createEl("div",{cls:"memochron-weekday",text:y})});let m=new Date(t,i,1),d=new Date(t,i+1,0).getDate(),f=m.getDay()-o;f<0&&(f+=7);for(let y=0;y<f;y++)n.createEl("div",{cls:"memochron-day empty"});let v=new Date().toDateString();for(let y=1;y<=d;y++){let g=new Date(t,i,y),w=g.toDateString(),_=n.createEl("div",{cls:"memochron-day"});this.currentMonthDays.set(w,_),this.selectedDate&&w===this.selectedDate.toDateString()&&_.addClass("selected"),w===v&&_.addClass("today");let O=_.createEl("div",{cls:"memochron-day-header",text:String(y)});if(this.plugin.calendarService.getEventsForDate(g).length>0){_.addClass("has-events");let Y=_.createEl("div",{cls:"memochron-event-dot",text:"\u2022"})}_.addEventListener("touchstart",Y=>{Y.preventDefault()},{passive:!1}),_.addEventListener("click",Y=>{Y.preventDefault(),this.selectDate(g)})}}async showDayAgenda(t){this.agenda.empty();let i=this.agenda.createEl("h3",{text:t.toLocaleDateString("default",{weekday:"long",month:"long",day:"numeric"})}),r=this.plugin.calendarService.getEventsForDate(t);if(r.length===0){this.agenda.createEl("p",{text:"No events scheduled"});return}let n=this.agenda.createEl("div",{cls:"memochron-agenda-list"}),a=new Date;r.forEach(o=>{let l=n.createEl("div",{cls:"memochron-agenda-event"});if(o.end<a&&l.addClass("past-event"),l.createEl("div",{cls:"memochron-event-time",text:`${o.start.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})} - ${o.end.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})}`}),l.createEl("div",{cls:"memochron-event-title",text:o.title}),o.location){let m=o.location.startsWith("http://")||o.location.startsWith("https://")||o.location.startsWith("www."),c=o.location.toLowerCase().includes("zoom")||o.location.toLowerCase().includes("meet.")||o.location.toLowerCase().includes("teams")||o.location.toLowerCase().includes("webex"),d=m?"\u{1F517}":c?"\u{1F4BB}":"\u{1F4CD}";l.createEl("div",{cls:"memochron-event-location",text:`${d} ${o.location}`})}l.addEventListener("touchstart",m=>{m.preventDefault()},{passive:!1}),l.addEventListener("click",async m=>{m.preventDefault(),m.stopPropagation();try{await this.showEventDetails(o)}catch(c){console.error("Failed to create note:",c),new J.Notice("Failed to create note. Check the console for details.")}})})}async showEventDetails(t){try{if(!this.plugin.settings.noteLocation){new J.Notice("Please set a note location in settings first");return}let i=await this.plugin.noteService.createEventNote(t);if(!i)throw new Error("Failed to create or update note");let r=this.app.workspace.getLeaf("tab");r?await r.openFile(i):new J.Notice("Could not open the note in a new tab")}catch(i){throw console.error("Error showing event details:",i),i}}};var z=require("obsidian"),G=class extends z.PluginSettingTab{constructor(t,i){super(t,i);this.plugin=i}display(){let{containerEl:t}=this;t.empty(),t.createEl("h2",{text:"MemoChron Settings"}),new z.Setting(t).setName("Calendar Sources").setDesc("Add and manage your iCalendar URLs").addButton(o=>o.setButtonText("Add Calendar").onClick(async()=>{this.plugin.settings.calendarUrls.push({url:"",name:"New Calendar",enabled:!0,tags:[]}),await this.plugin.saveSettings(),this.display()}));let i=t.createEl("div",{cls:"memochron-calendar-list"});this.plugin.settings.calendarUrls.forEach((o,l)=>{let m=new z.Setting(i).addText(c=>c.setPlaceholder("Calendar URL").setValue(o.url).onChange(async d=>{this.plugin.settings.calendarUrls[l].url=d,await this.plugin.saveSettings()})).addText(c=>c.setPlaceholder("Calendar name").setValue(o.name).onChange(async d=>{this.plugin.settings.calendarUrls[l].name=d,await this.plugin.saveSettings()})).addText(c=>{var d;return c.setPlaceholder("Tags (comma-separated)").setValue(((d=o.tags)==null?void 0:d.join(", "))||"").onChange(async f=>{this.plugin.settings.calendarUrls[l].tags=f.split(",").map(p=>p.trim()).filter(p=>p.length>0),await this.plugin.saveSettings()})}).addToggle(c=>c.setValue(o.enabled).onChange(async d=>{this.plugin.settings.calendarUrls[l].enabled=d,await this.plugin.saveSettings(),await this.plugin.refreshCalendarView()})).addButton(c=>c.setButtonText("Remove").onClick(async()=>{this.plugin.settings.calendarUrls.splice(l,1),await this.plugin.saveSettings(),await this.plugin.refreshCalendarView(),this.display()}))}),t.createEl("h3",{text:"Note Settings"});let r=new z.Setting(t).setName("Note Location").setDesc("Where to save new event notes"),n=new z.TextComponent(r.controlEl);n.setPlaceholder("calendar-notes/").setValue(this.plugin.settings.noteLocation);let a=r.controlEl.createDiv({cls:"suggestion-container"});a.style.display="none",this.setupPathSuggestions(n,a,async()=>await this.plugin.noteService.getAllFolders(),async o=>{this.plugin.settings.noteLocation=o,await this.plugin.saveSettings()}),new z.Setting(t).setName("Note Title Format").setDesc("Format for new note titles. Available variables: {{event_title}}, {{date}}, {{source}}").addText(o=>o.setPlaceholder("{{event_title}} - {{date}}").setValue(this.plugin.settings.noteTitleFormat).onChange(async l=>{this.plugin.settings.noteTitleFormat=l,await this.plugin.saveSettings()})),new z.Setting(t).setName("Note Date Format").setDesc("Choose how dates appear in event notes").addDropdown(o=>o.addOption("ISO","ISO (YYYY-MM-DD)").addOption("US","US (MM/DD/YYYY)").addOption("UK","UK (DD/MM/YYYY)").addOption("Long","Long (Month DD, YYYY)").setValue(this.plugin.settings.noteDateFormat).onChange(async l=>{this.plugin.settings.noteDateFormat=l,await this.plugin.saveSettings()})),new z.Setting(t).setName("Default Frontmatter").setDesc("YAML frontmatter to add at the top of each event note").addTextArea(o=>{o.setPlaceholder(`---
type: event
date: {{date}}
---`).setValue(this.plugin.settings.defaultFrontmatter).onChange(async l=>{this.plugin.settings.defaultFrontmatter=l,await this.plugin.saveSettings()}),o.inputEl.rows=4,o.inputEl.cols=50}),new z.Setting(t).setName("Note Template").setDesc("Template for the note content. Available variables: {{event_title}}, {{date}}, {{start_time}}, {{end_time}}, {{source}}, {{location}}, {{description}}").addTextArea(o=>{o.setValue(this.plugin.settings.noteTemplate).onChange(async l=>{this.plugin.settings.noteTemplate=l,await this.plugin.saveSettings()}),o.inputEl.rows=10,o.inputEl.cols=50}),new z.Setting(t).setName("Default Tags").setDesc("Default tags for all event notes (comma-separated)").addText(o=>o.setPlaceholder("event, meeting").setValue(this.plugin.settings.defaultTags.join(", ")).onChange(async l=>{this.plugin.settings.defaultTags=l.split(",").map(m=>m.trim()).filter(m=>m.length>0),await this.plugin.saveSettings()})),t.createEl("h3",{text:"View Settings"}),new z.Setting(t).setName("First Day of Week").setDesc("Choose which day the week starts on").addDropdown(o=>o.addOption("0","Sunday").addOption("1","Monday").addOption("2","Tuesday").addOption("3","Wednesday").addOption("4","Thursday").addOption("5","Friday").addOption("6","Saturday").setValue(String(this.plugin.settings.firstDayOfWeek)).onChange(async l=>{this.plugin.settings.firstDayOfWeek=parseInt(l),await this.plugin.saveSettings(),await this.plugin.refreshCalendarView()})),new z.Setting(t).setName("Refresh Interval").setDesc("How often to refresh calendar data (in minutes)").addText(o=>o.setValue(String(this.plugin.settings.refreshInterval)).onChange(async l=>{let m=parseInt(l);!isNaN(m)&&m>0&&(this.plugin.settings.refreshInterval=m,await this.plugin.saveSettings())}))}setupPathSuggestions(t,i,r,n){t.inputEl.addEventListener("focus",async()=>{let a=await r();this.showSuggestions(t,i,a,t.getValue(),n)}),t.inputEl.addEventListener("input",async()=>{let a=await r();this.showSuggestions(t,i,a,t.getValue(),n)}),t.inputEl.addEventListener("blur",()=>{setTimeout(()=>{i.style.display="none"},200)})}showSuggestions(t,i,r,n,a){i.empty();let o=r.filter(m=>m.toLowerCase().includes(n.toLowerCase()));if(o.length===0){i.style.display="none";return}i.style.display="block";let l=i.createEl("ul",{cls:"suggestion-list"});o.slice(0,5).forEach(m=>{l.createEl("li",{text:m}).addEventListener("mousedown",async d=>{d.preventDefault(),t.setValue(m),await a(m),i.style.display="none"})})}};var it={calendarUrls:[],noteLocation:"/",noteTitleFormat:"{{date}} - {{event_title}}",refreshInterval:30,noteDateFormat:"ISO",defaultFrontmatter:`---
type: event
date: {{date}}
---`,defaultTags:["event","meeting"],noteTemplate:`# {{event_title}}

## \u{1F4DD} Event Details
\u{1F4C5} {{date}}
\u23F0 {{start_time}} - {{end_time}}
\u{1F4C6} {{source}}
{{location}}

## \u{1F4CB} Description
{{description}}

## \u{1F4DD} Notes
`,firstDayOfWeek:1};var Q=class extends nt.Plugin{async onload(){await this.loadSettings(),this.calendarService=new Z(this.settings.refreshInterval),this.noteService=new X(this.app,this.settings),this.registerView("memochron-calendar",t=>this.calendarView=new $(t,this)),this.addSettingTab(new G(this.app,this)),this.app.workspace.onLayoutReady(()=>{this.activateView()}),this.setupAutoRefresh()}onunload(){this.refreshTimer&&window.clearInterval(this.refreshTimer)}async loadSettings(){this.settings=Object.assign({},it,await this.loadData())}async saveSettings(){await this.saveData(this.settings),this.calendarService&&this.setupAutoRefresh()}async activateView(){if(this.app.workspace.getLeavesOfType("memochron-calendar").length===0){let i=this.app.workspace.getRightLeaf(!1);i||(i=this.app.workspace.getLeaf("split","vertical")),i&&await i.setViewState({type:"memochron-calendar",active:!0})}await this.refreshCalendarView()}async refreshCalendarView(){this.calendarView&&await this.calendarView.refreshEvents()}setupAutoRefresh(){this.refreshTimer&&window.clearInterval(this.refreshTimer),this.refreshTimer=window.setInterval(()=>this.refreshCalendarView(),this.settings.refreshInterval*60*1e3)}};
